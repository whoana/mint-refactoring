<!--
	Screen ID : SU-99-99-002
	Screen NM : 화면 라벨 관리
	[변경 이력]
	* 20170123-001
-->
<div class="row wrapper border-bottom white-bg page-heading menu dhkim">
	<div id="oldPath"  class="col-lg-5">
	    <h2><lb class="">화면 라벨 관리</lb></h2>
		<ol class="breadcrumb">
	        <li><lb class="lb-636"></lb></li>
	        <li><lb class="lb-25"></lb></li>
	        <li class="active"><strong><lb class="">화면 라벨 관리</lb></strong></li>
 		</ol>
	</div>
	<div id="menuPath" class="col-lg-5">
    </div>
    <div class="col-lg-7">
        <div class="title-action" >
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
        	<div class="ibox float-e-margins">
        		<div class="ibox-title">
	                <h5><lb class="lb-78"></lb></h5>
	                <div class="ibox-tools">
	                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
	                </div>
					<div style="float: right; padding: 0px 20px 0px 0px;">
			        	<a id="btnListSearch" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-search "></i> <lb class="lb-10"></lb> </a>
			            <a id="btnCreate" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-plus-circle"></i> <lb class="lb-428"></lb> </a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row">
		                <div class="col-sm-4">
							<span class="label-tag-4"><lb class="lb-830"></lb></span>
							<span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
                            	<input id="searchId" type="text" class="k-input" placeholder="">
	                        </span>
						</div>
                        <div class="col-sm-4">
                            <span class="label-tag-4"><lb class="lb-829"></lb></span>
	                        <span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
	                            <input id="searchNm" type="text" class="k-input" placeholder="">
	                        </span>
                        </div>
                        <div class="col-sm-4">
                            <span class="label-tag-4"><lb class=""> Lang ( ko, en, cn )</lb></span>
	                        <span class="k-widget k-header k-state-default input-tag-4">
	                            <input id="searchLangId" type="text">
	                        </span>
                        </div>
					</div>
				</div>
			</div>
       	</div>
   	</div>

   	<div class="row">
		<div class="col-lg-12">
   		<div class="ibox float-e-margins">
       		<div class="ibox-title">
                <h5><lb class="lb-91"></lb></h5>
                <div class="ibox-tools">
                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </div>
			</div>
				<div class="ibox-content">
					<div class="panel-body">
						<div id="list-grid"></div>
					</div>
				</div>
			</div>
   		</div>
   	</div>

   	<div id="detail">
   		<div style="float: right; padding: 0px 20px 10px 0px;">
            <a id="btnDelete" class="btn btn-danger btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-trash-o"></i> <lb class="lb-343"></lb> </a>
			<a id="btnSave" class="btn btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-save"></i> <lb class="lb-310"></lb> </a>
            <a id="btnModify" class="btn btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-pencil"></i> <lb class="lb-342"></lb> </a>
		</div>
		<div class="ibox-content">
			<div class="row">
				<div class="col-sm-6" id="radioArea">
					<div class="form-group">
						<span class="label-tag-4"><lb class="">코드분리</lb></span>
						<span>
			            	<div class="radio radio-inline" style="padding-top:5px;">
								<span class="radio-danger" style="padding-right: 20px;">
									<input id="radio0" type="radio" name="rd-msg" value="0" checked="true">
									<label for="radio0">
										<lb class="">기존</lb>
									</label>
								</span>
								<span class="radio-info" style="padding:0px 20px;">
									<input id="radio1" type="radio" name="rd-msg" value="1">
									<label for="radio1">
										<lb class="">전문</lb>
									</label>
								</span>
								<span class="radio-info" style="padding:0px 20px;">
									<input id="radio2" type="radio" name="rd-msg" value="2">
									<label for="radio2">
										<lb class="lb-889"></lb>
									</label>
								</span>
							</div>
                        </span>
					</div>
				</div>

				<hr class="hr-space">

				<div class="col-sm-6">
                	<span class="label-tag-4"><lb class=""> Lang ( ko, en, cn )</lb></span>
                	<span class="k-widget k-header k-state-default input-tag-4">
                    	<input id="langId" type="text">
                	</span>
               </div>
               <div class="col-sm-6">
                    <span class="label-tag-4"><lb class="lb-830"></lb></span>
                   	<input id="msgId" class="input-tag-4" min="0" step="1" max="999999999" placeholder="0" tabIndex="4">
                   	<input id="orgMsgId" type="hidden">
               </div>

				<hr class="hr-space">

				<div class="col-sm-6">
                	<span class="label-tag-4"><lb class="lb-829"></lb></span>
                	<span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
                   		<input id="msg" type="text" class="k-input" placeholder="">
                	</span>
                </div>
                <div class="col-sm-6">
               		<span class="label-tag-4"><lb class="lb-527"></lb></span>
               		<span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
                   		<input id="tag" type="text" class="k-input" placeholder="">
               		</span>
              	</div>
			</div>
		</div>
   	</div>
</div>

<script>
	$(document).ready(function() {
		//=======================================================================
		//(1) function 및 variable scope 설정 :: (메인은 main, 팝업 및 서브는 sub)
		//=======================================================================
		screenName = "SU-99-99-002";
		$.extend({
			main : {
				//=======================================================================
				// (2) Screen 에서 사용할 variable 정의
				//=======================================================================
				callScrnNm : screenName,
				//=======================================================================
				// (3) Screen 에서 사용할 function 정의
				//=======================================================================

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화
				//-----------------------------------------------------------------------
				fn_init : function() {
					try {
						mint.init('$.main.fn_initCallback');
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_init"});
					}
				},//end fn_init()

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화 콜백
				//-----------------------------------------------------------------------
				fn_initCallback : function() {
					try {
						$.main.fn_initGrid();

						$("#detail").kendoWindow({
							actions: ["Minimize", "Close"],
							width: "1000px",
							pinned: true,
							resizable: false,
							modal: true,
							title: mint.label.getLabel('lb-353'),
							visible: false
						});

						mint.ui.setNumericWithoutMax('msgId', 0, 1, 'n0');

						var srcYn = [
							{text: "ko", value: "ko"},
							{text: "en", value: "en"},
							{text: "cn", value: "cn"}
				    	 ];

			 			mint.ui.setDropDownList('searchLangId', srcYn, 0, "text", "value");
			 			mint.ui.setDropDownList('langId', srcYn, 0, "text", "value");

						$.main.fn_editorClear();

						mint.callService(
								null
						 		, screenName
								, 'REST-R01-SU-10-01'
								, function(jsonData) {
							 		var dataSource = new kendo.data.DataSource({
										  data: jsonData
									    , page:1
									    , pageSize: mint.ui.getPageSizesS({'currentPage' : true})
									});
									//데이터 재설정
									$("#list-grid").data("kendoGrid").setDataSource(dataSource);
								}
								, {errorCall : true}
						);
						// 권한 적용
						{
							var roleId = mint.session.getRoleId();
							//if (roleId == "URID001" || roleId == "URID003") {
							if( mint.session.isInterfaceAdmin() == 'Y' ){
								$.main.isAdmin = "Y";
								$(".btnCreate").show();
							}
							else {
								$(".btnCreate").hide();
							}
						}
						mint.common.siteMenuPath(screenName);
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initCallback"});
					}
				},//end fn_initCallback()

				//-----------------------------------------------------------------------
				// Description :: grid 초기화
				//-----------------------------------------------------------------------
				fn_initGrid : function() {
					try{
						$("#list-grid").kendoGrid({
							dataSource : {
				 				  data: ""
				 				, pageSize : mint.ui.getPageSizesS({'currentPage' : true})
							}
						    , sortable : true
							, selectable: "row"
							, resizable: true
							, filterable:true
							, pageable : {
								  refresh 		: false
								, pageSizes		: mint.ui.getPageSizesS()
						    	, buttonCount 	: 10
						    	, input : true
							}
						    , columns : [
							    	{
										  title 	: mint.label.getLabel('lb-439')
										, field 	: "langId"
										, width		: "100px"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap; text-align: center;'
							            }
							            , template: "<div class='flagImg' style='background-image: url(../../img/flag/#:data.langId#.png);'></div>"
			   							, filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-830')
										, field 	: "msgId"
										, width		: "250px"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap; text-align: center;'
							            },
							            filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-829')
										, field 	: "msg"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap; text-align: center;'
							            },
							            filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-527')
										, field 	: "tag"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap; text-align: center;'
							            },
			   							filterable: { multi: true, search: true }
									}
							]
						    , dataBound: function (e) {
						    	if(0 == $("#list-grid").data().kendoGrid.dataSource.view().length) {
						    		var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

						    		$("#list-grid").children(".k-grid-content").height(gridHeight /2.5);
						    		$("#list-grid").children(".k-grid-content-locked").height(gridHeight / 2.5);
						    	} else {
						    		$("#list-grid").children(".k-grid-content").height('auto');
							    	$("#list-grid").children(".k-grid-content-locked").height('auto');
						    	}
						    }
						}).data("kendoGrid");
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initGrid"});
					};
				},//end fn_initGrid

				//-----------------------------------------------------------------------
	            // Description :: 초기화
	            //-----------------------------------------------------------------------
				fn_editorClear : function() {
					$('#btnModify').hide();
					$('#btnDelete').hide();

					$('#langId').data("kendoDropDownList").select(0);
					$("#msgId").data("kendoNumericTextBox").value("");
					$('#msg').val('');
					$('#tag').val('');
					$("#orgMsgId").val("");

					$("#list-grid").data("kendoGrid").clearSelection();
				},//end fn_editorClear

			 	//-----------------------------------------------------------------------
	            // Description :: 조회
	            //-----------------------------------------------------------------------
				fn_searchGridLabelList : function() {
					try{
						var tempScreenLabel = new Object();
	    				tempScreenLabel.msgId = $('#searchId').val();
	    				tempScreenLabel.msg = $('#searchNm').val();
						tempScreenLabel.langId =  $('#searchLangId').data("kendoDropDownList").dataItem().value;

						mint.callService(
								tempScreenLabel
						 		, screenName
								, 'REST-R01-SU-10-01'
								, function(jsonData) {
							 		var dataSource = new kendo.data.DataSource({
										  data: jsonData
									    , page:1
									    , pageSize: mint.ui.getPageSizesS({'currentPage' : true})
									});
									//데이터 재설정
									$("#list-grid").data("kendoGrid").setDataSource(dataSource);
								}
								, {errorCall : true}
						);
					} catch( e ){
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_searchGridLabelList"});
					}
				}, // end fn_searchGridLabelList

				//-----------------------------------------------------------------------
	            // Description :: 상세 조회
	            //-----------------------------------------------------------------------
				fn_getScreenLabelDetail : function() {
					try{
						var entityGrid = $("#list-grid").data("kendoGrid");
				        var selectedItem = entityGrid.dataItem(entityGrid.select());

				        mint.callService(selectedItem, screenName, 'REST-R02-SU-10-01'
				        	, function(jsonData){
								if(null != jsonData) {
									$('#btnModify').show();
									$('#btnDelete').show();

									$('#langId').data("kendoDropDownList").value(jsonData.langId);
									$('#msgId').data("kendoNumericTextBox").value(jsonData.msgId);
									$('#msg').val(jsonData.msg);
									$('#tag').val(jsonData.tag);
									$('#orgMsgId').val(jsonData.msgId);
								}
							}
							,{
								  errorCall : true
								, params : {
										langId  : selectedItem.langId
									, msgId : selectedItem.msgId
								}
							}
						);
					} catch( e ){
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getScreenLabelDetail"});
					}
				}, // end fn_getScreenLabelDetail

				//-----------------------------------------------------------------------
				// Description :: 활성화 or 비활성화
				//-----------------------------------------------------------------------
				fn_detailEditorEvent : function(disabled) {
					if(disabled){ // 비활성화
						$('#langId').data("kendoDropDownList").enable(false);
						$('#msgId').data("kendoNumericTextBox").enable(false);
						$('#msg').prop("disabled", true).addClass("k-state-disabled");
						$('#tag').prop("disabled", true).addClass("k-state-disabled");
					} else{ // 활성화
 						var entityGrid = $("#list-grid").data("kendoGrid");
				        var selectedItem = entityGrid.dataItem(entityGrid.select());

				        if(mint.common.isEmpty(selectedItem)){ //생성
				        	$('#msgId').data("kendoNumericTextBox").enable(false);
							$('#langId').data("kendoDropDownList").enable(true);
				        } else{ //수정
							$('#msgId').data("kendoNumericTextBox").enable(true);
				        	$('#langId').data("kendoDropDownList").enable(false);
				        }
						$('#msg').prop("disabled", false).removeClass("k-state-disabled");
						$('#tag').prop("disabled", false).removeClass("k-state-disabled");
					}
				}//end fn_detailEditorEvent
			}// end main
		}); // end extends

		//=======================================================================
		// (4) 이벤트 핸들러 정의
		//=======================================================================

		//조회
		$("#btnListSearch").click(function () {
			$.main.fn_searchGridLabelList();
        });

		//생성
		$('#btnCreate').click(function(e){
			$('#btnSave').show();
			$('#radioArea').show();
			$.main.fn_editorClear();
			$.main.fn_detailEditorEvent(false);
			$("#detail").data("kendoWindow").center().open();
		});

		//저장
		$('#btnSave').click(function(e) {
			if('' == $('#msg').val()) { //라벨명 비었을 때
				mint.common.alert('CW00001', mint.label.getLabel('lb-829'));
			} else {
				var confirmId = "";
				var alertId = "";
				var restUrl = "";
				var entityGrid = $("#list-grid").data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());

				var screenlabel = new Object();
				screenlabel.objectType 	= 'ScreenLabel';
				screenlabel.langId	= $('#langId').data("kendoDropDownList").dataItem().value;
				screenlabel.msg		= $('#msg').val();
				screenlabel.tag 	= $('#tag').val();

				var success = false;

				if(mint.common.isEmpty(selectedItem)){ //생성(라벨ID 비활성화)
					success = true;
					screenlabel.labelType = $('input:radio[name=rd-msg]:checked').val();
					confirmId = "CI00005";
					alertId = "CI00105";
					restUrl = "REST-C01-SU-10-01";
				} else { //수정(라벨ID 활성화)
					if('' == $('#msgId').val()) { //라벨ID 비어있을 때
						mint.common.alert('CW00001', mint.label.getLabel('lb-830'));
					} else{
						success = true;
						screenlabel.msgId  	= $('#msgId').data("kendoNumericTextBox").value();
						screenlabel.orgMsgId= $('#orgMsgId').val();
						confirmId = "CI00002";
						alertId = "CI00102";
						restUrl = "REST-U01-SU-10-01";
					}
				}

				if(success){
					var confirmCheck = mint.common.confirm(confirmId, null);
					if(confirmCheck == true) {
						mint.callService(screenlabel, screenName, restUrl, function(jsonData){
							if(null != jsonData) {
								mint.common.alert(alertId, null);
								$.main.fn_searchGridLabelList();
								$.main.fn_editorClear();
								$("#detail").data("kendoWindow").close();
							}
						}, {errorCall : true });
					}
				}

			}
		});

		//수정
		$('#btnModify').click(function(e) {
			$('#btnModify').hide();
			$('#btnSave').show();
			$.main.fn_detailEditorEvent(false);
		});

		//삭제
		$('#btnDelete').click(function(e) {
			var confirmCheck = mint.common.confirm('CI00003', null);

		    if (confirmCheck == true) {
				var entityGrid = $("#list-grid").data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());

				mint.callService(selectedItem, screenName,'REST-D01-SU-10-01', function(jsonData){
						mint.common.alert('CI00103', null);
						$.main.fn_searchGridLabelList();
						$.main.fn_editorClear();
						$("#detail").data("kendoWindow").close();
				}, {errorCall : true
					, params : {
					  	  langId  : selectedItem.langId
						, msgId : selectedItem.msgId
					}
				});
		    }
		});

		//더블클릭 이벤트
		$('#list-grid').on('dblclick', "tr.k-state-selected", function(){
			$('#btnSave').hide();
			$('#btnModify').show();
			$('#radioArea').hide();
			$.main.fn_detailEditorEvent(true)
			$.main.fn_getScreenLabelDetail();
			$("#detail").data("kendoWindow").center().open();
		});

		//-----------------------------------------------------------------------
		// (5) Description :: 조회기간 KeyDown 이벤트 설정 (상단)
		//-----------------------------------------------------------------------
		$('#searchId').keydown(function(event) {
			if(event.keyCode == 13) {
				$.main.fn_searchGridLabelList();
	     	}
		});

		$('#searchNm').keydown(function(event) {
			if(event.keyCode == 13) {
				$.main.fn_searchGridLabelList();
	     	}
		});

		//=======================================================================
		// (6) 화면 로딩시 실행할 항목 기술
		//=======================================================================
		$.main.fn_init();
		mint.label.attachLabel(null);
	});

</script>

<style>
	.k-grid-header
	{
	   padding: 0 !important;
	}

	.k-grid-content
	{
	   overflow-y: visible;
	}

	.k-grid tr td {
	    border-bottom: 1px solid #C0C0C0;
	}

	.k-grid .k-dirty {
	  display: none;
	}

	.note-editor {
    	border : 1px solid #a9a9a9 !important;
	}

	.flagImg {
        display: inline-block;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-position: center center;
        vertical-align: middle;
        margin-left: 5px;
    }
</style>

</body>
</html>