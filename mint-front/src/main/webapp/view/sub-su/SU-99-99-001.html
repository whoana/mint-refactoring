<!--
	Screen ID : SU-99-99-001
	Screen NM : 도움말 편집.
	[변경 이력]
	* YYYYMMDD-001
-->
<div class="row wrapper border-bottom white-bg page-heading menu dhkim">
	<div  id="oldPath" class="col-lg-5">
	    <h2><lb class="lb-28"></lb></h2>
		<ol class="breadcrumb">
	        <li><lb class="lb-636"></lb></li>
	        <li><lb class="lb-25"></lb></li>
	        <li class="active"><strong><lb class="lb-28"></lb></strong></li>
 		</ol>
	</div>
	<div id="menuPath" class="col-lg-5">
    </div>
    <div class="col-lg-7">
        <div class="title-action" >

        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
        	<div class="ibox float-e-margins">
        		<div class="ibox-title">
	                <h5>List</h5>
	                <div class="ibox-tools">
	                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
	                </div>
					<div style="float: right; padding: 0px 20px 0px 0px;">
			        	<a id="btnHelpListSearch" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-search "></i> <lb class="lb-10"></lb></a>
			            <a id="btnCreate" class="btn btn-w-m btn-primary btn-outline"><i class="fa fa-check"></i> <lb class="lb-421"></lb></a>
			            <a id="btnModify" class="btn btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-pencil"></i><lb class="lb-342"></lb></a>
			            <a id="btnSave" class="btn btn-w-m btn-primary btn-outline" style="display: none;"><i class="fa fa-save"></i> <lb class="lb-310"></lb> </a>
			            <a id="btnDelete" class="btn btn-w-m btn-danger btn-outline" style="display:none;"><i class="fa fa-trash-o"></i> <lb class="lb-343"></lb></a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row">
                        <div class="col-sm-6">
                            <span class="label-tag-4"><lb class="lb-436"></lb></span>
	                        <span>
	                            <input id="helpNm" class="input-tag-4" type="text" placeholder="Search...">
	                        </span>
                        </div>
                      	<hr class="hr-space">
                      	<div class="col-sm-12">
							<div id="help-list-grid"></div>
						</div>
					</div>
				</div>
			</div>
       	</div>
   	</div>
    <div class="row">
        <div class="col-lg-12">
        	<div class="ibox float-e-margins">
        		<div class="ibox-title">
	                <h5>Editor</h5>
	                <div class="ibox-tools">
	                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
	                </div>
	                <div style="float:right; padding: 0px 20px 0px 0px;">
  	               		<a id="btnClear" href="#" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-eraser"></i><lb class="lb-79"></lb></a>
			            <a id="btnTest" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-eye"></i> <lb class="lb-430"></lb> </a>
			        </div>
				</div>
				<div class="ibox-content">
					<div class="row">
                        <div class="col-sm-6">
                            <span class="label-tag-4"><lb class="lb-432"></lb></span>
                            <span>
                            	<input id="appId" class="input-tag-4" type="text" placeholder="Search..."  tabIndex="4">
                            </span>
                        </div>
                        <div class="col-sm-6">
                            <span class="label-tag-4"><lb class="lb-433"></lb></span>
	                        <span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
	                            <input id="helpId" type="text" class="k-input" placeholder="">
	                        </span>
                        </div>
                      		<hr class="hr-space">
                        <div class="col-sm-6">
	                        <span class="label-tag-4"><lb class="lb-68"></lb></span>
	                        <span class="k-widget k-autocomplete k-header k-state-default input-tag-4">
	                            <input id="subject" type="text" class="k-input" placeholder="">
	                        </span>
                        </div>
                        <div class="col-sm-6">
                            <span class="label-tag-4"><lb class="lb-434"></lb> ( ko, en, cn )</span>
	                        <span class="k-widget k-state-default input-tag-4">
	                            <input id="langId" type="text">
	                        </span>
                        </div>
                        <hr class="hr-space">
                      	<div class="col-sm-12">
							<textarea id="contents" rows="5" cols="30" style="height:300px"></textarea>
						</div>
					</div>
				</div>
	       	</div>
	   	</div>
   	</div>
    <div class="row">
        <div class="col-lg-12">
        	<div class="ibox float-e-margins">
        		<div class="ibox-title">
	                <h5><lb class="lb-435"></lb></h5>
	                <div class="ibox-tools">
	                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
	                </div>
				</div>
				<div class="ibox-content">
					<div class="row">
						<div class="col-sm-12">
            				<textarea id="html-contents" class="well" style="padding: 10px 10px 10px 10px; width:100%; height: 200px; overflow-y:auto;" readonly></textarea>
            			</div>
            		</div>
				</div>
			</div>
		</div>
	</div>
</div>



<script>
	$(document).ready(function() {
	    //=======================================================================
	    //(1) function 및 variable scope 설정 :: (메인은 main/main_detail, 팝업 및 서브는 sub)
	    //=======================================================================
		screenName = "SU-99-99-001";

	    $.extend({
	    	main : {
	    		//=======================================================================
	            // (2) Screen 에서 사용할 variable 정의
	            //=======================================================================

	            //=======================================================================
	            // (3) Screen 에서 사용할 function 정의
	            //=======================================================================

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화
				//-----------------------------------------------------------------------
	    		fn_init : function() {
					try {
						mint.init('$.main.fn_initCallback');
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_init"});
					}
				},//end fn_init()

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화 콜백
				//-----------------------------------------------------------------------
				fn_initCallback : function() {
					try {
						$.main.fn_initGrid();

						$('#contents').kendoEditor({});

						var srcYn = [	{text: "ko", value: "ko"},
							{text: "en", value: "en"},
							{text: "cn", value: "cn"}
				    	];
						mint.ui.setDropDownList('langId', srcYn, 0, "text", "value");

						//Application 정보 설정
						$.main.fn_applicationInfo();

						//도움말 리스트 조회
						$.main.fn_searchGridList();

						mint.common.siteMenuPath(screenName);
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initCallback"});
					}
				},//end fn_initCallback()

				//-----------------------------------------------------------------------
				// Description :: Application 정보
				//-----------------------------------------------------------------------
				fn_applicationInfo : function(){
					try{
						mint.callService(
							  null
							, screenName
							, 'REST-R01-SU-99-99-001'
							, function(jsonData) {
								mint.ui.setComboBoxWithValue('appId', jsonData, 0, 'appNm', 'appId');
								mint.ui.setComboBoxWithValue('helpNm', jsonData, 0, 'appNm', 'helpNm');
								//KeyDown 이벤트 설정
								$('#helpNm').data("kendoComboBox").input.keydown(function(event) {
									if(event.keyCode == 13) {
										$.main.fn_searchGridList();
							     	}
								});
							}
							, {errorCall : true}
						);
					} catch( e ){
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_applicationInfo"});
					}
				},

				//-----------------------------------------------------------------------
				// Description :: Grid 초기화
				//-----------------------------------------------------------------------
				fn_initGrid : function() {
					try {
						$("#help-list-grid").kendoGrid({
							dataSource : {
				 				  data: ""
				 				, pageSize : mint.ui.getPageSizesXXS({'currentPage' : true})
							}
						    , sortable : true
							, selectable: "row"
							, resizable: true
							, filterable: true
							, pageable : {
								  refresh 		: false
								, pageSizes		: mint.ui.getPageSizesXXS()
						    	, buttonCount 	: 5
						    	, input : true
							}
						    , columns : [
									{
										  title 	: mint.label.getLabel('lb-432') + ' ' + mint.label.getLabel('lb-422')
										, field 	: "appId"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            },
							            filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-436')
										, field 	: "appNm"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            },
							            filterable: { multi: true, search: true }
									}
									/*
 									, {
										  title 	: mint.label.getLabel('lb-437')
										, field 	: "appComments"
										, template	: "<span title='${appComments}'>${appComments}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            }
									}
									 */
									, {
										  title 	: mint.label.getLabel('lb-438') + ' ' + mint.label.getLabel('lb-422')
										, field 	: "helpId"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            },
							            filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-68')
										, field 	: "subject"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            },
							            filterable: { multi: true, search: true }
									}
									, {
										  title 	: mint.label.getLabel('lb-439')
										, field 	: "langId"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            },
							            filterable: { multi: true, search: true }
									}
							]
						    , dataBound: function (e) {
						    	if(0 == $("#help-list-grid").data().kendoGrid.dataSource.view().length) {
						    		var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

						    		$("#help-list-grid").children(".k-grid-content").height(gridHeight /2.5);
						    		$("#help-list-grid").children(".k-grid-content-locked").height(gridHeight / 2.5);
						    	} else {
						    		$("#help-list-grid").children(".k-grid-content").height('auto');
							    	$("#help-list-grid").children(".k-grid-content-locked").height('auto');
						    	}
						    }
						}).data("kendoGrid");
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initGrid"});
					}
				},//end fn_initGrid

				//-----------------------------------------------------------------------
	            // Description :: 에디터 초기화(input 활성화)
	            //-----------------------------------------------------------------------
				fn_editorClear : function(){
					try{
						$('#btnModify').hide();
						$('#btnDelete').hide();
						$('#btnCreate').show();

						$('#appId').data("kendoComboBox").enable(true);
						$('#appId').data("kendoComboBox").value('');

						$('#helpId').val('');
						$('#helpId').prop('readonly', false);
						$('#helpId').prop('disabled', false);
						$('#helpId').css('background-color', '');

						$('#subject').val('');
						$('#subject').prop('readonly', false);
						$('#subject').prop('disabled', false);
						$('#subject').css('background-color', '');

						$('#langId').data("kendoDropDownList").select(0);
						$('#langId').data("kendoDropDownList").enable(true);

						$("#contents").data("kendoEditor").value('');
						$('#html-contents').val('');

						$($('#contents').data().kendoEditor.body).prop('contenteditable', true);
						$($('#contents').data().kendoEditor.body).prop('disabled', false);

						$("#help-list-grid").data("kendoGrid").clearSelection();
					} catch( e ){
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_editorClear"});
					}
				},//end fn_editorClear

				//-----------------------------------------------------------------------
	            // Description :: 조회
	            //-----------------------------------------------------------------------
	            fn_searchGridList : function(){
	            	var tempHelp = new Object();
	    			tempHelp.helpNm = $('#helpNm').val();

	    			mint.callService(
	    					 tempHelp
	    			 		, screenName
	    					, 'REST-R02-SU-02-15-000'
	    					, function(jsonData) {
	    				 		var dataSource = new kendo.data.DataSource({
	    							  data: jsonData
	    						    , page:1
	    						    , pageSize: mint.ui.getPageSizesXXS({'currentPage' : true})
	    						});

	    						//데이터 재설정
	    						$("#help-list-grid").data("kendoGrid").setDataSource(dataSource);
	    					}
	    					, {errorCall : true}
	    			);
	            },//end fn_searchGridList

				//-----------------------------------------------------------------------
	            // Description :: 상세 조회
	            //-----------------------------------------------------------------------
	            fn_getScreenHelpDetail : function(){
     				var entityGrid = $("#help-list-grid").data("kendoGrid");
     		        var selectedItem = entityGrid.dataItem(entityGrid.select());

     		        mint.callService(null, screenName, 'REST-R01-SU-02-15-000'
        		        	, function(jsonData){
         						if(null != jsonData) {
         							$('#btnSave').hide();
         							$('#btnModify').show();
         							$('#btnDelete').show();

         							$('#appId').data("kendoComboBox").enable(false);
         							$('#appId').data("kendoComboBox").value(jsonData.appId);

         							$('#helpId').val(jsonData.helpId);
         							$('#helpId').prop('readonly', 'readonly');
         							$('#helpId').prop('disabled', 'disabled');
         							$('#helpId').css('background-color', '#eee');

         							$('#subject').val(jsonData.subject);
         							$('#subject').prop('readonly', 'readonly');
         							$('#subject').prop('disabled', 'disabled');
         							$('#subject').css('background-color', '#eee');

         							$('#langId').data("kendoDropDownList").value(jsonData.langId);
         							$('#langId').data("kendoDropDownList").enable(false);

         							$("#contents").data("kendoEditor").value(jsonData.contents);
         							$('#html-contents').val(jsonData.contents);

         							$($('#contents').data().kendoEditor.body).prop('contenteditable', false);
         							$($('#contents').data().kendoEditor.body).prop('disabled', true);

         							var tempScollWidth = 0;
         						}
         					}
         					,{
         						  errorCall : true
         						, params : {
         						  	  appId  : selectedItem.appId
         							, helpId : selectedItem.helpId
         							, langId : selectedItem.langId
         						}
         					}
         				);
	            }, //end fn_getScreenHelpDetail
	    	}//end main
	    });//end extends

		//=======================================================================
		// (4) 이벤트 핸들러 정의(Click)
		//=======================================================================

		//초기화
		$("#btnClear").click(function (all) {
			var entityGrid = $("#help-list-grid").data("kendoGrid");
			var selectedItem = entityGrid.dataItem(entityGrid.select());

			if(!mint.common.isEmpty(selectedItem)){
				$('#btnSave').hide();
			}
			$.main.fn_editorClear();
        });

		//조회
		$("#btnHelpListSearch").click(function () {
			$.main.fn_searchGridList();
			$.main.fn_editorClear();
        });

		//등록
		$('#btnCreate').click(function(e) {
 			var contents = $("#contents").data("kendoEditor").value();
			$('#html-contents').val('');
			$('#html-contents').val(contents);

			if('undefined' ==  typeof $('#appId').data("kendoComboBox").dataItem()) {
				mint.common.alert('CW00003', 'Application');
			} else if('' == $('#helpId').val()) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-433'));
			} else if('' == $('#subject').val()) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-68'));
			} else if('' == contents) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-69'));
			} else {
				var confirmCheck = mint.common.confirm('BI00018', null);

			    if (confirmCheck == true) {
			    	var help = new Object();
					help.objectType = 'Help';
					help.appId      = $('#appId').data("kendoComboBox").dataItem().appId;
					help.helpId     = $('#helpId').val();
					help.langId     = $('#langId').val();
					help.subject    = $('#subject').val();
					help.contents   = contents;

					mint.callService(help, screenName, 'REST-C01-SU-02-15-000', function(jsonData){
						if(null != jsonData) {
							mint.common.alert('CI00105', null);
							$.main.fn_searchGridList();
							$.main.fn_editorClear();
						}
					}, {errorCall : true });
			    }
			}
		});

		//수정
		$('#btnModify').click(function(e) {
			$('#btnModify').hide();
			$('#btnSave').show();
			$('#btnClear').show();
			$('#btnDelete').hide();

			$('#appId').data("kendoComboBox").enable(true);

			$('#subject').prop('readonly', false);
    		$('#subject').prop('disabled', false);
    		$('#subject').css('background-color', '');

    		$('#helpId').prop('readonly', 'readonly');
    		$('#helpId').prop('disabled', 'disabled');
    		$('#helpId').css('background-color', '#eee');

			$('#langId').data("kendoDropDownList").enable(false);

     		$($('#contents').data().kendoEditor.body).prop('contenteditable', true);
 			$($('#contents').data().kendoEditor.body).prop('disabled', false);
		});

		//저장
		$('#btnSave').click(function(e) {
 			var contents = $("#contents").data("kendoEditor").value();
			$('#html-contents').val('');
			$('#html-contents').val(contents);

			if('undefined' ==  typeof $('#appId').data("kendoComboBox").dataItem()) {
				mint.common.alert('CW00003', mint.label.getLabel('lb-432'));
			} else if('' == $('#helpId').val()) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-433'));
			} else if('' == $('#subject').val()) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-68'));
			} else if('' == contents) {
				mint.common.alert('CW00001', mint.label.getLabel('lb-69'));
			} else {
				var confirmCheck = mint.common.confirm('BW00046', null);

			    if (confirmCheck == true) {
			    	var help = new Object();
					help.objectType = 'Help';
					help.appId      = $('#appId').data("kendoComboBox").dataItem().appId;
					help.helpId     = $('#helpId').val();
					help.langId     = $('#langId').val();
					help.subject    = $('#subject').val();
					help.contents   = contents;

					mint.callService(help, screenName, 'REST-U01-SU-02-15-000', function(jsonData){
						if(null != jsonData) {
							mint.common.alert('CI00102', null);
							$.main.fn_searchGridList();
							$.main.fn_editorClear();
							$('#btnDelete').hide();
							$('#btnSave').hide();
							$('#btnCreate').show();
						}
					}, {errorCall : true });
			    }
			}
		});

		//삭제
		$('#btnDelete').click(function(e){
			var confirmCheck = mint.common.confirm('CI00003', null); //삭제 메시지

			if(confirmCheck == true) {
				var entityGrid = $('#help-list-grid').data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());

				mint.callService(selectedItem, 'SU-99-99-001','REST-D01-SU-02-15-000', function(jsonData){
					mint.common.alert('CI00103', null);
					$.main.fn_searchGridList();
					$.main.fn_editorClear();
					$('#btnDelete').hide();
					$('#btnModify').hide();
					$('#btnCreate').show();
					$('#btnClear').show();
				}, {errorCall : true
					, params : {
						  appId : selectedItem.appId
					  	, langId  : selectedItem.langId
					}
				});
			} else{
				$('#btnModify').show();
			}
		});

		//미리보기
		$('#btnTest').click(function(e) {
 			var contents = $("#contents").data("kendoEditor").value();
			$('#html-contents').val('');
			$('#html-contents').val(contents);
			mint.ui.help(this, 'PREVIEW','PREVIEW', {contents : contents});
		});

		//클릭 이벤트 (보기)
		$('#help-list-grid').on('click', "tr.k-state-selected", function () {
			$('#btnCreate').hide();
			$.main.fn_getScreenHelpDetail();
		});

		//=======================================================================
		// (6) 화면 로딩시 실행할 항목 기술
		//=======================================================================
		$.main.fn_init();
		mint.label.attachLabel(null);
	});

</script>

<style>
	.k-grid-header
	{
	   padding: 0 !important;
	}

	.k-grid-content
	{
	   overflow-y: visible;
	}

	.k-grid tr td {
	    border-bottom: 1px solid #C0C0C0;
	}

	.k-grid .k-dirty {
	  display: none;
	}

	.note-editor {
    	border : 1px solid #a9a9a9 !important;
	}
</style>

</body>
</html>
