<!--
	Screen ID : IM-01-01-005
	Screen NM : 사용자 관리
	[변경 이력]
	* YYYYMMDD-001
-->
<div class="row wrapper border-bottom white-bg page-heading menu dhkim">
	<div id="oldPath" class="col-lg-5">
	    <h2><lb class="lb-810"></lb></h2>
		<ol class="breadcrumb">
	        <li><lb class="lb-636"></lb></li>
	        <li><lb class="lb-25"></lb></li>
	        <li class="active"><strong><lb class="lb-810"></lb></strong></li>
 		</ol>
	</div>
	<div id="menuPath" class="col-lg-5">
    </div>
    <div class="col-lg-7">
        <div class="title-action" >
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight" >
    <div class="row">
        <div class="col-lg-12">
        	<div class="ibox float-e-margins">
        		<div class="ibox-title">
	                <h5><lb class="lb-78"></lb></h5>
	                <div class="ibox-tools">
	                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
	                </div>
					<div style="float: right; padding: 0px 20px 0px 0px;">
			        	<a id="btnListSearch" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-search "></i> <lb class="lb-10"></lb> </a>
			            <a id="btnCreate" class="btn btn-w-m btn-default btn-outline"><i class="fa fa-plus-circle"></i> <lb class="lb-11"></lb> </a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row">
                        <div class="col-sm-4">
                            <span class="lable_tag"><lb class="lb-422"></lb></span>
	                        <span class="k-widget k-autocomplete k-header k-state-default input-width" style="width:63%;">
	                            <input id="searchId" type="text" class="k-input" placeholder="" style="width: 100%;">
	                        </span>
                        </div>
                        <div class="col-sm-4">
                            <span class="lable_tag"><lb class="lb-211"></lb></span>
	                        <span class="k-widget k-autocomplete k-header k-state-default input-width" style="width:63%;">
	                            <input id="searchNm" type="text" class="k-input" placeholder="" style="width: 100%;">
	                        </span>
                        </div>
					</div>
				</div>
			</div>
       	</div>
   	</div>

   	<div class="row">
   		<div class="col-lg-12">
   		<div class="ibox float-e-margins">
       		<div class="ibox-title">
                <h5><lb class="lb-91"></lb></h5>
                <div class="ibox-tools">
                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </div>
			</div>
				<div class="ibox-content">
					<div class="panel-body">
						<div id="list-grid"></div>
					</div>
				</div>
			</div>
   		</div>
   	</div>

   	<div id="detail">
    	<div style="float: right; padding: 0px 20px 10px 0px;">
    		<a id="btnUse" class="btn btn-primary btn-w-m btn-primary btn-outline"><i class="fa fa-check"></i> <lb class="lb-519"></lb> </a>
			<a id="btnDelete" class="btn btn-danger btn-w-m btn-default btn-outline"><i class="fa fa-trash-o"></i> <lb class="lb-343"></lb> </a>
			<a id="btnSave" class="btn btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-save"></i> <lb class="lb-310"></lb> </a>
			<a id="btnModify" class="btn btn-w-m btn-default btn-outline" style="display: none;"><i class="fa fa-pencil"></i> <lb class="lb-342"></lb> </a>
		</div>

		<div class="ibox-content">

			<h3><lb class="lb-9999">필수정보</lb></h3>

        	<hr class="hr-space">

			<div class="row">
	            <div class="col-sm-6">
	             	<label class="label-tag-4"><lb class="lb-423"></lb></label>
	                <input id="roleId" type="combobox" class="input-tag-4">
	            </div>

		        <hr class="hr-space">

		        <div class="col-sm-6">
		            <label class="label-tag-4"><lb class="lb-422"></lb></label>
		           	<input id="userId" class="input-tag-4 k-textbox" type="text" maxlength="100" tabIndex="4">
		        </div>
	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-811"></lb></label>
	                <input id="password" type="password" class="input-tag-4 k-textbox" placeholder="">
	            </div>

				<hr class="hr-space">

		        <div class="col-sm-6">
		            <label class="label-tag-4"><lb class="lb-211"></lb></label>
		           	<input id="userNm1" class="input-tag-4 k-textbox" type="text"  placeholder=""  maxlength="100">
		        </div>
		        <div class="col-sm-6" style="display: none;">
		         <label class="label-tag-4"><lb class="lb-473"></lb></label>
		            <input id="delYn" type="combobox" class="input-tag-4">
		        </div>
	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-812"></lb></label>
	                <input id="password1" type="password" class="input-tag-4 k-textbox" placeholder="">
	            </div>
		        <div class="col-sm-6" style="display:none;">
		            <span style="width:63%;">
		            	<a id="btnCheckDup" class="btn btn-w-m btn-default btn-outline" ><i class="fa fa-search"></i> <lb class="lb-813"></lb> </a>
		            </span>
		        </div>

	            <hr class="hr-space">

	            <div class="col-sm-6" id="ipListDiv" style="display:none;">
	                <label class="label-tag-4">허용 IP</label>
	               	<input id="ipList" class="input-tag-4 k-textbox" type="text" maxlength="100">
	            </div>
	            <div class="col-sm-6" id="accountLockDiv" style="display:none;">
	                <label class="label-tag-4">계정 잠김</lb></label>
	                <div class="checkbox checkbox-warning checkbox-inline" style="padding-left:20px; padding-top:5px;">
	                	<input id="accountLock" type="checkbox">
	                	<label for="accountLock"></label>
	                </div>
	            </div>
			</div>
		</div>

		<div class="ibox-content">

			<h3><lb class="lb-9999">부가정보</lb></h3>

        	<hr class="hr-space">

			<div class="row">
	            <div class="col-sm-6">
	            	<label class="label-tag-4"><lb class="lb-371"></lb></label>
	                <input id="companyNm" type="text" class="input-tag-4 k-textbox" placeholder=""">
	            </div>
	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-214"></lb></label>
	               	<input id="email" class="input-tag-4 k-textbox" type="text" maxlength="100">
	            </div>

	            <hr class="hr-space">

	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-407"></lb></label>
	                <input id="departmentNm" type="text" class="input-tag-4 k-textbox" placeholder="" maxlength="50"  >
	            </div>
	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-212"></lb></label>
	                <input id="cellPhone" type="text" class="input-tag-4 k-textbox" placeholder="" maxlength="50" >
	            </div>

				<hr class="hr-space">

	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-373"></lb></label>
	                <input id="positionNm" type="text" class="input-tag-4 k-textbox" placeholder="" maxlength="50"  ">
	            </div>
	            <div class="col-sm-6">
	                <label class="label-tag-4"><lb class="lb-213"></lb></label>
	                <input id="phone" type="text" class="input-tag-4 k-textbox" placeholder="" maxlength="50" >
	            </div>
			</div>
		</div>
   	</div>
</div>

<script type="text/x-kendo-template" id="template-userDetail">
	<div class="col-sm-6">
		<div class="panel-body mint-panel-content">
			<div class="table-responsive">
				<table class="table table-hover no-margins">
		        	<tbody>
			    		<tr>
				        	<td class="mint-td-m-right no-borders" style="width:15%;padding:5px;">#= mint.label.getLabel('lb-214') # : </td>
			        		<td class="no-borders" style="float:left;padding:5px;"><i>#= email #</i></td>
						</tr>
			    		<tr>
				        	<td class="mint-td-m-right no-borders" style="width:15%;padding:5px;">#= mint.label.getLabel('lb-212') # : </td>
			        		<td class="no-borders" style="float:left;padding:5px;"><i>#= cellPhone #</i></td>
						</tr>
			    		<tr>
				        	<td class="mint-td-m-right no-borders" style="width:15%;padding:5px;">#= mint.label.getLabel('lb-213') # : </td>
			        		<td class="no-borders" style="float:left;padding:5px;"><i>#= phone #</i></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</script>

<script>
	$(document).ready(function() {
		//=======================================================================
		//(1) function 및 variable scope 설정 :: (메인은 main, 팝업 및 서브는 sub)
		//=======================================================================
		screenName = "IM-01-01-005";

		$.extend({
			main : {
				//=======================================================================
				// (2) Screen 에서 사용할 variable 정의
				//=======================================================================
				callScrnNm : screenName,
				//=======================================================================
				// (3) Screen 에서 사용할 function 정의
				//=======================================================================

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화
				//-----------------------------------------------------------------------
				fn_init : function() {
					try {
						mint.init('$.main.fn_initCallback');
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_init"});
					}
				},//end fn_init()

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화 콜백
				//-----------------------------------------------------------------------
				fn_initCallback : function() {
					try {
						$.main.fn_initGrid();

						$("#detail").kendoWindow({
							actions: ["Minimize", "Close"],
							width: "1000px",
							pinned: true,
							resizable: false,
							modal: true,
							title: mint.label.getLabel('lb-353'),
							visible: false
						});
 						//콤보초기화
						{
							// 용도  설정
		                	$.main.fn_getComboList();
						}

						// 권한 적용
						{
							var roleId = mint.session.getRoleId();
							if( mint.session.isInterfaceAdmin() == 'Y' ) {
								$.main.isAdmin = "Y";
								$(".btnCreate").show();
							}
							else {
								$(".btnCreate").hide();
							}
						}

						//(아시아나) ip, accountLock 보이기
						{
							if(mint.session.useIpCheck()){
								$('#ipListDiv').show();
							}else{
								$('#ipListDiv').hide();
							}
							if(mint.session.usePasswordFailCheck()){
								$('#accountLockDiv').show();
							}else{
								$('#accountLockDiv').hide();
							}
						}

						$.main.fn_searchGridUserList();

						mint.common.siteMenuPath(screenName);
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initCallback"});
					}
				},//end fn_initCallback()

				//-----------------------------------------------------------------------
				// Description :: 용도 조회 및 초기화
				//-----------------------------------------------------------------------
			 	fn_getComboList : function() {
			 		try{
						mint.callService(
								  null
								, screenName
								, 'REST-R04-IM-01-05'
								, function(jsonData) {
									mint.ui.setDropDownList('roleId',jsonData, 0, 'roleNm', 'roleId');
								}
								, {errorCall : true}
							);
			 		} catch( e ){
			 			mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getComboList"});
			 		}
				}, // end fn_getComboList()

				//-----------------------------------------------------------------------
				// Description :: grid 초기화
				//-----------------------------------------------------------------------
				fn_initGrid : function() {
					try{
						$("#list-grid").kendoGrid({
							dataSource : {
				 				  data: ""
				 				, pageSize : mint.ui.getPageSizesS({'currentPage' : true})
							}
							, filterable: true
						    , sortable : true
							, selectable: "row"
							, resizable: true
							, pageable : {
								  refresh 		: false
								, pageSizes		: mint.ui.getPageSizesS()
						    	, buttonCount 	: 5
						    	, input : true
							}
						    , detailTemplate: kendo.template($("#template-userDetail").html())
						    , columns : [
											{
												field : "userId",
												title : mint.label.getLabel('lb-422'),
												headerAttributes : {
													style : "text-align: center; vertical-align:middle;"
												},
												attributes : {
													style : "text-align: center; white-space: nowrap;"
												},
												filterable: { multi: true, search: true }

											},
											{
												field : "userNm",
												title : mint.label.getLabel('lb-211'),
												headerAttributes : {
												    style : "text-align: center; vertical-align:middle;"
												},
												attributes : {
												    style : "text-align: center; white-space: nowrap;"
												},
												filterable: { multi: true, search: true }
											},
											{
											    field : "companyNm",
											    title : mint.label.getLabel('lb-371'),
											    headerAttributes : {
											        style : "text-align: center; vertical-align:middle;"
											    },
											    attributes : {
											        style : "text-align: center; white-space: nowrap;"
											    },
											    filterable: { multi: true, search: true }
											},
											{
											    field : "departmentNm",
											    title : mint.label.getLabel('lb-407'),
											    headerAttributes : {
											        style : "text-align: center; vertical-align:middle;"
											    },
											    attributes : {
											        style : "text-align: center; white-space: nowrap;"
											    },
											    filterable: { multi: true, search: true }
											},
											{
											    field : "positionNm",
											    title : mint.label.getLabel('lb-373'),
											    headerAttributes : {
											        style : "text-align: center; vertical-align:middle;"
											    },
											    attributes : {
											        style : "text-align: center; white-space: nowrap;"
											    },
											    filterable: { multi: true, search: true }
											},
											{
											    field : "role.roleNm",
											    title : mint.label.getLabel('lb-423'),
											    width : "150px",
											    headerAttributes : {
											        style : "text-align: center; vertical-align:middle;"
											    },
											    attributes : {
											        style : "text-align: center; white-space: nowrap;"
											    },
											    filterable: { multi: true, search: true }
											},
											{
											    field : "delYn",
											    title : mint.label.getLabel('lb-473'),
											    template  : "#= $.main.fn_gridDelYnTemplate(delYn) #",
											    width : "150px",
											    headerAttributes : {
											        style : "text-align: center; vertical-align:middle;"
											    },
											    attributes : {
											        style : "text-align: center; white-space: nowrap;"
											    },
											    filterable: { multi: true, search: true }
											}
					                    ]
						    , dataBound: function (e) {
						    	if(0 == $("#list-grid").data().kendoGrid.dataSource.view().length) {
						    		var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

						    		$("#list-grid").children(".k-grid-content").height(gridHeight /2.5);
						    		$("#list-grid").children(".k-grid-content-locked").height(gridHeight / 2.5);
						    	} else {
						    		$("#list-grid").children(".k-grid-content").height('auto');
							    	$("#list-grid").children(".k-grid-content-locked").height('auto');
						    	}

						    	//-----------------------------------------------------------------------
								// ROW / COL CSS 처리
								//-----------------------------------------------------------------------
								var items = e.sender.dataItems();
								if( items.length > 0 ) {
									for(var i = 0; i < items.length; i++ ) {
										var tr = e.sender.wrapper.find("tr[data-uid='" + items[i].uid + "']:first");
										var len = tr[0].cells.length;
										if( items[i].delYn === 'Y' ) {
											tr.css('text-decoration', 'line-through');
											tr[0].cells[len - 1].style.fontWeight = "bold";
											tr[0].cells[len - 1].style.color="red";
										}
									}
								}
						    }
						}).data("kendoGrid");
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initGrid"});
					};
				},//end fn_initGrid

				//-----------------------------------------------------------------------
	            // Description :: 초기화
	            //-----------------------------------------------------------------------
				fn_editorClear : function() {
					$('#btnCreate').show();
					$('#btnModify').hide();
					//$('#btnCheckDup').show();
					$('#btnUse').hide();

					$('#userId').val('');

					$('#userNm1').val('');
					$('#companyNm').val('');
					$('#departmentNm').val('');
					$('#positionNm').val('');

					$('#roleId').data("kendoDropDownList").select(0);
					$('#password').val('');
					$('#password1').val('');
					$('#email').val('');
					$('#cellPhone').val('');
					$('#phone').val('');

					$('#ipList').val('');
					$('#accountLock').prop('checked', false);

					$("#list-grid").data("kendoGrid").clearSelection();
				},//	end fn_editorClear

			 	//-----------------------------------------------------------------------
	            // Description :: 조회
	            //-----------------------------------------------------------------------
				fn_searchGridUserList : function() {
					try {
						var tempUser = new Object();
						tempUser.userNm = $('#searchNm').val();
						tempUser.userId = $('#searchId').val();

						mint.callService(
								tempUser
						 		, screenName
								, 'REST-R01-IM-01-05'
								, function(jsonData) {
							 		var dataSource = new kendo.data.DataSource({
										  data: jsonData
									    , page:1
									    , pageSize: mint.ui.getPageSizesS({'currentPage' : true})
									});
									//데이터 재설정
									$("#list-grid").data("kendoGrid").setDataSource(dataSource);
								}
								, {errorCall : true}
						);
					} catch ( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_searchGridUserList"});
					}
				}, // end fn_searchGridUserList

				//-----------------------------------------------------------------------
	            // Description :: 상세 조회
	            //-----------------------------------------------------------------------
				 fn_getUserDetail : function() {
					 try {
						var entityGrid = $("#list-grid").data("kendoGrid");
				        var selectedItem = entityGrid.dataItem(entityGrid.select());

				        mint.callService(selectedItem, screenName, 'REST-R02-IM-01-05'
				        	, function(jsonData){
				        	 	if(null != jsonData) {

									$('#userId').val(jsonData.userId);
									$('#userNm1').val(jsonData.userNm);

									$('#password').val('');
									$('#password1').val('');

									if(jsonData.delYn === 'Y'){
										$("#btnUse").show();
										$("#btnDelete").hide();
									} else{
										$("#btnUse").hide();
										$("#btnDelete").show();
									}

									$('#companyNm').val(jsonData.companyNm);
									$('#departmentNm').val(jsonData.departmentNm);
									$('#positionNm').val(jsonData.positionNm);

									$('#roleId').data("kendoDropDownList").value(jsonData.role.roleId);
									$('#email').val(jsonData.email);
									$('#cellPhone').val(jsonData.cellPhone);
									$('#phone').val(jsonData.phone);

									var userSecurity = jsonData.userSecurityProperty;
									if(!mint.common.isEmpty(userSecurity)){
										$('#ipList').val(userSecurity.ipList);
										if(userSecurity.isAccountLock=='N'){
											$('#accountLock').prop('checked',false);
										}else{
											$('#accountLock').prop('checked',true);
										}
									}else{
										$('#ipList').val('');
										$('#accountLock').prop('checked',true);
									}
								}
							}
							,{
								  errorCall : true
								, params : {
								  	  userId  : selectedItem.userId
									, userNm : selectedItem.userNm
								}
							}
						);
					 } catch ( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getUserDetail"});
					 }
				}, // end fn_getUserDetail

				//-----------------------------------------------------------------------
				// Description :: fn_gridDelYnTemplate
				//-----------------------------------------------------------------------
				fn_gridDelYnTemplate : function( value ) {
					try {
						if( mint.common.isEmpty(value) ) {
							return '사용';
						} else {
							var returnVal = '';
							if( value == 'Y' ) {
								returnVal = '미사용';
							} else {
								returnVal = '사용';
							}
							return "<span title='"+ returnVal +"'>"+ returnVal +"</span>";
						}
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_gridDelYnTemplate"});
					}
				},//end fn_gridColumnValueTemplate()

				//-----------------------------------------------------------------------
				// Description :: 활성화 or 비활성화
				//-----------------------------------------------------------------------
				fn_detailEditorEvent : function(disabled) {
					if(disabled){ // 비활성화
						$('#userId').prop("disabled", true).addClass("k-state-disabled");
						$('#userId').attr("style", "background-color:#eee;");
						$('#userNm1').prop("disabled", true).addClass("k-state-disabled");
						$('#userNm1').attr("style", "background-color:#eee;");
						$('#roleId').data("kendoDropDownList").enable(false);
						$('#password').prop("disabled", true).addClass("k-state-disabled");
						$('#password1').prop("disabled", true).addClass("k-state-disabled");
						$('#companyNm').prop("disabled", true).addClass("k-state-disabled");
						$('#email').prop("disabled", true).addClass("k-state-disabled");
						$('#departmentNm').prop("disabled", true).addClass("k-state-disabled");
						$('#cellPhone').prop("disabled", true).addClass("k-state-disabled");
						$('#positionNm').prop("disabled", true).addClass("k-state-disabled");
						$('#phone').prop("disabled", true).addClass("k-state-disabled");
					} else{ // 활성화
						var entityGrid = $("#list-grid").data("kendoGrid");
				        var selectedItem = entityGrid.dataItem(entityGrid.select());

				        if(mint.common.isEmpty(selectedItem)){ //생성
				        	$('#userId').prop("disabled", false).removeClass("k-state-disabled");
				        	$('#userId').attr("style", "background-color:#ffffff;");
							$('#userNm1').prop("disabled", false).removeClass("k-state-disabled");
				        	$('#userNm1').attr("style", "background-color:#ffffff;");
				        }
						$('#roleId').data("kendoDropDownList").enable(true);
						$('#password').prop("disabled", false).removeClass("k-state-disabled");
						$('#password1').prop("disabled", false).removeClass("k-state-disabled");
						$('#companyNm').prop("disabled", false).removeClass("k-state-disabled");
						$('#email').prop("disabled", false).removeClass("k-state-disabled");
						$('#departmentNm').prop("disabled", false).removeClass("k-state-disabled");
						$('#cellPhone').prop("disabled", false).removeClass("k-state-disabled");
						$('#positionNm').prop("disabled", false).removeClass("k-state-disabled");
						$('#phone').prop("disabled", false).removeClass("k-state-disabled");
					}
				}//end fn_detailEditorEvent
			}// end main
		}); // end extends

		//=======================================================================
		// (4) 이벤트 핸들러 정의
		//=======================================================================

		//조회
		$("#btnListSearch").click(function () {
			$.main.fn_searchGridUserList();
        });

		//생성
		$('#btnCreate').click(function(e){
			$('#btnSave').show();
			$('#btnDelete').hide();
			$.main.fn_editorClear();
			$.main.fn_detailEditorEvent(false);
			$("#detail").data("kendoWindow").center().open();
		})

		//수정
		$('#btnModify').click(function(e) {
			$('#btnModify').hide();
			$('#btnSave').show();
			$.main.fn_detailEditorEvent(false);
		});

 		//저장
		$('#btnSave').click(function(e){
			if('' == $('#userNm1').val()) {//이름이 비었을 때
				mint.common.alert('CW00001', mint.label.getLabel('lb-211'));
			} else if('' == $('#userId').val()) {//아이디가 비었을 때
				mint.common.alert('CW00001', mint.label.getLabel('lb-422'));
			} else if($('#password').val() != $('#password1').val()) {//비밀번호 확인이랑 값이 다를 때
				mint.common.alert('CW00017');
			} else {
				var confirmId = "";
				var alertId = "";
				var restUrl = "";
				var entityGrid = $("#list-grid").data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());

				var role = new Object();
		    	role.objectType = 'UserRole';
		    	role.roleId = $('#roleId').data("kendoDropDownList").dataItem().roleId;

		    	var user = new Object();
				user.objectType = 'User';
				user.role = role;
				user.companyNm    = $('#companyNm').val();
				user.departmentNm = $('#departmentNm').val();
				user.positionNm   = $('#positionNm').val();
				user.email   	  = $('#email').val();
				user.phone   	  = $('#phone').val();
				user.cellPhone    = $('#cellPhone').val();

				var userSecurityProperty = new Object();
				userSecurityProperty.objectType='UserSecurityProperty';

				if(mint.session.useIpCheck()){
					userSecurityProperty.ipList = $('#ipList').val();
				}
				if(mint.session.usePasswordFailCheck()){
					if($('#accountLock').is(':checked')){
						userSecurityProperty.isAccountLock='Y';
					}else{
						userSecurityProperty.isAccountLock='N';
					}
				}
				user.userSecurityProperty = userSecurityProperty;

				var success = false;

				if(mint.common.isEmpty(selectedItem)){ //생성
					if('' == $('#password').val() || '' == $('#password1').val()) {//비번, 비번확인이 비어있을 경우
						mint.common.alert('CW00001', mint.label.getLabel('lb-811'));
					} else if(!mint.common.isValidPassword($('#password').val())) {//비밀번호 형식이 맞지 않을 때
						mint.common.alert('CW00016');
					} else {
						success = true;
						user.userId		    = $('#userId').val();
						user.userNm   	    = $('#userNm1').val();
						user.password       = $('#password').val();
						user.delYn			= "N";
						confirmId = "CI00005";
						alertId = "CI00105";
						restUrl = "REST-C01-IM-01-05";
					}
				} else { //수정
					if($('#password').val() != '' && !mint.common.isValidPassword($('#password').val())){
						console.log('password:' + $('#password').val());
						mint.common.alert('CW00016');
					} else{
						success = true;
						user.userId     = selectedItem.userId;
						user.userNm		= selectedItem.userNm;
						user.delYn 		= selectedItem.delYn;
						if ($('#password').val() != ''){
							user.password = $('#password').val();
						}
						confirmId = "CI00002";
						alertId = "CI00102";
						restUrl = "REST-U01-IM-01-05";
					}
				}

				if(success){
					var confirmCheck = mint.common.confirm(confirmId, null);
					if(confirmCheck == true) {
						mint.callService(user, screenName, restUrl, function(jsonData){
							if(null != jsonData) {
								mint.common.alert(alertId, null);
								$.main.fn_searchGridUserList();
								$.main.fn_editorClear();
								$("#detail").data("kendoWindow").close();
							}
						}, {errorCall : true });
					}
				}

			}
		});

		//삭제
		$('#btnDelete').click(function(e) {
			var confirmCheck = mint.common.confirm('CI00003', null);

		    if (confirmCheck == true) {
				var entityGrid = $("#list-grid").data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());

				mint.callService(selectedItem, screenName,'REST-D01-IM-01-05', function(jsonData){
						mint.common.alert('CI00103', null);
						$.main.fn_searchGridUserList();
						$.main.fn_editorClear();
						$("#detail").data("kendoWindow").close();
				}, {errorCall : true
					, params : {
					  	  userId  : selectedItem.userId
						, userNm : selectedItem.userNm
					}
				});
		    }
		});

		//사용
		$('#btnUse').click(function(e){
			var confirmCheck = mint.common.confirm('CI00002', null);

			if(confirmCheck == true){
				var entityGrid = $("#list-grid").data("kendoGrid");
				var selectedItem = entityGrid.dataItem(entityGrid.select());
				selectedItem.delYn = "N";

				mint.callService(selectedItem, screenName, "REST-U01-IM-01-05", function(jsonData){
					if(null != jsonData) {
						mint.common.alert("CI00102", null);
						$.main.fn_searchGridUserList();
						$.main.fn_editorClear();
						$("#detail").data("kendoWindow").close();
					}
				}, {errorCall : true });
			}
		});

		//더블클릭 이벤트 (보기)
		$('#list-grid').on('dblclick', "tr.k-state-selected", function () {
			$('#btnSave').hide();
			$('#btnModify').show();
			$.main.fn_detailEditorEvent(true);
			$.main.fn_getUserDetail();
			$("#detail").data("kendoWindow").center().open();
		});

		//-----------------------------------------------------------------------
		// (5) Description :: 조회기간 KeyDown 이벤트 설정 (상단)
		//-----------------------------------------------------------------------
		$('#searchNm').keydown(function(event) {
			if(event.keyCode == 13) {
				$.main.fn_searchGridUserList();
	     	}
		});

		$('#searchId').keydown(function(event) {
			if(event.keyCode == 13) {
				$.main.fn_searchGridUserList();
	     	}
		});

		//=======================================================================
		// (6) 화면 로딩시 실행할 항목 기술
		//=======================================================================
		$.main.fn_init();
		mint.label.attachLabel(null);
	});
</script>
