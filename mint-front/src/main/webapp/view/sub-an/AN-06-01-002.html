<!--
	Screen ID : AN-06-01-002
	Screen NM : 레이아웃맵핑 등록/수정
	[변경 이력]
	* 20200225-001 : New
-->

<!--location -->
<div class="row wrapper border-bottom white-bg page-heading">
	<div id="oldPath" class="col-lg-5">
 		<h2 class="lb-change"><lb class="lb-1066">전문I/O 맵핑 등록</lb></h2>
		<ol class="breadcrumb">
			<li><lb class="lb-1026">전문I/O 맵핑 관리</lb></li>
	        <li class="active"><strong class="lb-change"><lb class="lb-1066">전문I/O 맵핑 등록</lb></strong></li>
		</ol>
	</div>
	<div id="menuPath" class="col-lg-5">
    </div>
</div>
<!--location end-->

<!--wrapper wrapper-content-->
<div class="wrapper wrapper-content animated fadeInRight" >
	<div class="row">
		<div class="col-lg-12">
			<div class='ibox'>
				<div class='ibox-title'>
					<h5><lb class="lb-1069">전문I/O 맵핑</lb></h5>
                    <div class="ibox-tools" id="xxx-help">
                    	<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
					</div>
					<div style="float: right; padding: 0px 20px 0px 0px;">
			            <a class="btn btn-w-m btn-default btn-outline btn-save"><i class="fa fa-save"></i> <lb class="lb-310"></lb></a>
						<a class="btn btn-w-m btn-default btn-outline btn-cancel" style="display:none;"><i class="fa fa-times"></i> <lb class="lb-143"></lb></a>
						<a class="btn btn-w-m btn-default btn-outline btn-back" style="display:none;"><i class="fa fa-reply"></i> <lb class="lb-311"></lb></a>
					</div>
				</div>
				<div class='ibox-content'>
					<div class="row">
						<div class="col-sm-4" style="display:none;">
							<div class="form-horizontal">
								<div class="form-group">
									<label class="label-tag-4"><lb class="lb-9999">맵핑ID</lb></label>
									<input id="tf-mapId" name="mapId" type="text" class="input-tag-4 k-textbox input-tag-view" placeholder="" readonly="readonly" disabled="disabled">
								</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-horizontal">
								<div class="form-group">
									<label class="label-tag-4"><lb class="lb-1063">맵핑명</lb></label>
									<input id="tf-mapNm" name="mapNm" type="text" class="input-tag-4 k-textbox" placeholder="">
								</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-horizontal">
								<div class="form-group">
									<label class="label-tag-4"><lb class="lb-1006">코드(CD)</lb></label>
									<input id="tf-mapCd" name="mapCd" type="text" class="input-tag-4 k-textbox" placeholder="">
                              		<input id="hd-mapCd" name="hd-mapCd" type="hidden">
								</div>
							</div>
						</div>

						<hr class="hr-space">
						<div class="col-sm-12">
							<div class="b-col"></div>
						</div>
						<hr class="hr-space">

						<div class="col-sm-4">
							<div class="form-horizontal">
	                            <div class="form-group">
									<label class="label-tag-4"><lb class="lb-9999">권한그룹</lb></label>
									<input id="cb-authGroup" name="authGroup" type="combobox" placeholder="Select..." class="input-tag-4" data-bind="value: value, events: {select: select}">
                              	</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-horizontal">
	                            <div class="form-group">
	                            	<label class="label-tag-4"><lb class="lb-71">등록일</lb></label>
                                	<input id="tf-regDate" name="regDate" type="dates" class="input-tag-4 k-textbox input-tag-view mint-readonly" placeholder="" readonly="readonly" disabled="disabled">
                              	</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-horizontal">
								<div class="form-group">
									<label class="label-tag-4"><lb class="lb-582">수정일</lb></label>
									<input id="tf-modDate" name="modDate" type="dates" class="input-tag-4 k-textbox input-tag-view mint-readonly" placeholder="" readonly="readonly" disabled="disabled">
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class='ibox'>
<!-- 				<div class='ibox-title'> -->
<!-- 					<h5><lb class="lb-9999">상세정보</lb></h5> -->
<!-- 					<div class="ibox-tools" id="xxx-help"> -->
<!-- 						<a class="collapse-link"><i class="fa fa-chevron-up"></i></a> -->
<!-- 					</div> -->
<!-- 					<div style="float: right; padding: 0px 20px 0px 0px;"> -->
<!-- 					</div> -->
<!-- 				</div> -->
				<div class='ibox-content'>
					<div class="row">
						<div class="col-sm-12">
							<div id="mappingToolBar" class="k-content wide" style="background-color: white; border: 0px;"></div>
						</div>
						<hr class="hr-space">
						<div class="col-sm-12">
							<div class="col-sm-5 mint-col-0">
								<div class="panel panel-default mint-panel">
									<div class="panel-heading mint-panel-title mint-align-center">
										<h5><lb class="lb-1039">전문I/O</lb>(<lb class="lb-1064">Source</lb>)</h5>
				                        <div class="mint-panel-tools-nw">
				                            <a id="detail-source" class="detail-source"><i class="fa fa-expand"></i></a>
				                        </div>
									</div>
									<div class="panel-body mint-panel-content mint-align-center">
										<div>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1006">코드(CD)</lb></span>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1037">한글명</lb></span>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1038">영문명</lb></span>
										</div>
										<hr class="hr-space-2">
										<div>
											<input class="k-textbox mint-align-center mint-readonly layout-source-dataSetId" type="hidden">
											<input class="k-textbox mint-align-center mint-readonly layout-source-dataSetCd" style="width:32.7777%">
											<input class="k-textbox mint-align-center mint-readonly layout-source-dataSetNm1" style="width:32.7777%">
											<input class="k-textbox mint-align-center mint-readonly layout-source-dataSetNm2" style="width:32.7777%">
										</div>
									</div>
								</div>
							</div>

							<div class="col-sm-2 mint-col-default"></div>

							<div class="col-sm-5 mint-col-0">
								<div class="panel panel-default mint-panel">
									<div class="panel-heading mint-panel-title mint-align-center">
										<h5><lb class="lb-1039">전문I/O</lb>(<lb class="lb-1065">Target</lb>)</h5>
				                        <div class="mint-panel-tools-nw">
				                            <a id="detail-target" class="detail-target"><i class="fa fa-expand"></i></a>
				                        </div>
									</div>
									<div class="panel-body mint-panel-content">
										<div>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1006">코드(CD)</lb></span>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1037">한글명</lb></span>
											<span class="k-textbox label-tag" style="width:32.7777%"><lb class="lb-1038">영문명</lb></span>
										</div>
										<hr class="hr-space-2">
										<div>
											<input class="k-textbox mint-align-center mint-readonly layout-target-dataSetId" type="hidden">
											<input class="k-textbox mint-align-center mint-readonly layout-target-dataSetCd" style="width:32.7777%">
											<input class="k-textbox mint-align-center mint-readonly layout-target-dataSetNm1" style="width:32.7777%">
											<input class="k-textbox mint-align-center mint-readonly layout-target-dataSetNm2" style="width:32.7777%">
										</div>
									</div>
								</div>
							</div>

							<hr class="hr-space">

							<div class="col-sm-12 mint-col-0">
								<div class="mapping">
									<div class="mappingContainer">
										<div class="col-lg-5" style="padding-right:0px; padding-left:0px; margin-right:0px; margin-left:0px;">
											<div class="mappingSource"></div>
										</div>
										<div class="col-lg-2" style="padding:0px;margin:0px;">
											<div class="mappingDiv"></div>
										</div>
										<div class="col-lg-5" style="padding-right:0px; padding-left:0px; margin-right:0px; margin-left:0px;">
						                    <div class="mappingTarget"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>



		</div>
	</div>
</div><!-- end wrapper -->

<ul class="context-menu"></ul>

<script type="text/x-kendo-template" id="template-map-function">
	<li class="fn-add"><i class="fa fa-check"></i> Function Add
		<ul>
			# for ( var i = 0; i < data.length; i++ ) { #
            <li data-action='fn-add' data-id='#= data[i].mapFnId #' data-nm='#= data[i].mapFnNm #'><i class="fa fa-dot-circle-o"></i> #= data[i].mapFnNm #</li>
			# } #
		</ul>
	</li>
	<li class='k-separator'></li>
	<li data-action='fn-clear'><i class="fa fa-times"></i> Function Remove</li>
</script>

<script type="text/x-kendo-template" id="template-map-fn-label">
<span
	id='#= "fn-" + uid #'
	class='label label-success label-flag'
	style='float:right;'>#= fnNm #
</span>
</script>

<script>
$(document).ready(function(){
	//=======================================================================
	//(1) function 및 variable scope 설정 :: (메인은 main, 팝업 및 서브는 sub)
	//=======================================================================
	screenName = "AN-06-01-002";
	$.extend({
		main_detail : {
			//=======================================================================
			// (2) Screen 에서 사용할 variable 정의
			//=======================================================================
			//=======================================================================
			// (3) Screen 에서 사용할 function 정의
			//=======================================================================

			//-----------------------------------------------------------------------
			// Description :: 화면 초기화
			//-----------------------------------------------------------------------
			fn_init : function() {
				try {
					mint.init('$.main_detail.fn_initCallback');
					//mint.common.siteMenuPath(screenName);
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_init"});
				}
			},//end fn_init()

			//-----------------------------------------------------------------------
			// Description :: 화면 초기화 콜백
			//-----------------------------------------------------------------------
			fn_initCallback : function() {
				try {
					//-----------------------------------------------------------------------
					// 화면 초기화
					//-----------------------------------------------------------------------
					$.main_detail.isModify = mint.common.getScreenParam('isModify');
					$.main_detail.fn_initComponent(null);
					$.main_detail.fn_enableComponent($.main_detail.isModify);

					//-----------------------------------------------------------------------
					// 상세/수정 체크
					//-----------------------------------------------------------------------
					if( !mint.common.isEmpty($.main_detail.isModify) && $.main_detail.isModify === true ) {
						{
							$('.lb-change').text( mint.label.getLabel('lb-1067') ); //전문I/O 맵핑수정
						}
						$.main_detail.mapId = mint.common.getScreenParam('mapId');
			      		if( ! mint.common.isEmpty( $.main_detail.mapId ) ) {
							mint.callService(null, 'AN-06-01-002', 'REST-R02-AN-06-01', function(responseData) {
								$.main_detail.fn_setLayoutBinding(responseData, null);
							},
								{
							    	  errorCall : true
							    	, params : {mapId : $.main_detail.mapId}
							    }
							);

							//-----------------------------------------------------------------------
							//authGroup
							//-----------------------------------------------------------------------
							{
								var requestObject = new Object();
								{
									requestObject.categoryCd = 'DATA';
									requestObject.dataType = '3';
									requestObject.dataId = $.main_detail.mapId;
								}
								mint.callService(requestObject, 'AN-06-01-002', 'REST-R01-AU-01-03',
									function(responseData) {
										if( !mint.common.isEmpty(responseData) ) {
											var authGroupComponent = $('#cb-authGroup').data('kendoDropDownList');
											authGroupComponent.value(responseData.groupId);
										}
									},
									{
										errorCall : true,
										notificationView : false
								    }
								);
							}
			      		}
					}

					//-----------------------------------------------------------------------
					// Screen Parameter Clear
					//-----------------------------------------------------------------------
					{
						mint.common.removeScreenParam('isModify');
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initCallback"});
				}
			},//end fn_initCallback()

			//-----------------------------------------------------------------------
			// Description :: component enable/disable
			//-----------------------------------------------------------------------
			fn_enableComponent : function(isModify) {
				try {
					if(isModify) {
						$('.btn-cancel').show();
						$('.btn-back').show();
						$('.btn-tmp-save').show();
						$('.btn-tmp-read').show();
					} else {  // create
						$('.btn-cancel').hide();
						$('.btn-back').show();
						$('.btn-tmp-save').show();
						$('.btn-tmp-read').show();
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_enableComponent"});
				}
			},//end fn_enableComponent()

			//-----------------------------------------------------------------------
			// Description :: component 초기화
			//-----------------------------------------------------------------------
			fn_initComponent : function(options) {
				try {
					//-----------------------------------------------------------------------
					// readOnly Input Field
					//-----------------------------------------------------------------------
					{
						$(':input[class*="mint-readonly"]').each(function(){
							$(this).prop("readonly", true);
							$(this).prop("disabled", true);
						});
					}

					//-----------------------------------------------------------------------
					// Mapping Toolbar
					//-----------------------------------------------------------------------
					{
						$('#mappingToolBar').kendoToolBar({
							items: [
	                            { type: 'separator' },
	                            { type: 'separator' },

								{ type: 'button', id: 'layout-loadType-1', text: mint.label.getLabel('lb-1070'), click: $.main_detail.fn_loadLayout, icon: "search" },

	                            { type: 'separator' },
	                            { type: 'separator' },

	                            { type: 'button', id: 'layout-loadType-1', text: mint.label.getLabel('lb-1071'), click: $.main_detail.fn_initMapping, icon: "checkmark" },
	                            { type: 'button', id: 'layout-loadType-1', text: mint.label.getLabel('lb-1072'), click: $.main_detail.fn_autoMappingByOneToOne, icon: "hyperlink" },
	                            { type: 'button', id: 'layout-loadType-1', text: mint.label.getLabel('lb-1073'), click: $.main_detail.fn_autoMappingByName, icon: "hyperlink" },
							]

						});
					}

					//-----------------------------------------------------------------------
					// TreeList
					//-----------------------------------------------------------------------
					$.main_detail.fn_mapFunction()
					.done( function() {
						$.main_detail.fn_initLayoutTreeList();
					})
					.fail( function() {
						$.main_detail.fn_initLayoutTreeList();
					});

					//-----------------------------------------------------------------------
					// Style
					//-----------------------------------------------------------------------
					$('input[type=number]').css("text-align", 'right');

					//-----------------------------------------------------------------------
					// 권한그룹조회
					//-----------------------------------------------------------------------
					{
						//Init
						var authGroup = [{ name: '', groupId: '' }];
						mint.ui.setDropDownList('cb-authGroup', authGroup, 0, 'name', 'groupId');
						//CallService
						mint.callService(null, 'AN-06-00-002', 'REST-R01-AU-01-02',
							function(responseData) {
								if( !mint.common.isEmpty(responseData) ) {
									mint.ui.setDropDownList('cb-authGroup', responseData, 0, 'name', 'groupId');
									var authGroupComponent = $('#cb-authGroup').data('kendoDropDownList');
									if(responseData.length > 1) {
										var selectedItem = '';
										for(var i = 0; i < responseData.length; i++) {
											if( responseData[i].defaultGroup === 'Y' ) {
												selectedItem = responseData[i].groupId;
												break;
											}
										}
										authGroupComponent.value(selectedItem);
									} else {
										authGroupComponent.select(0);
									}
								}
							},
							{
						    	errorCall : true,
						    	notificationView : false
							}
						);
					}

				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initComponent"});
				}
			},//end fn_initComponent()


			//-----------------------------------------------------------------------
			// Description :: fn_mapFunction
			//-----------------------------------------------------------------------
			fn_mapFunction : function() {
				try {

					var sample = [
						{
							mapFnId: '1',
							mapFnNm: 'concat'
						},
						{
							mapFnId: '2',
							mapFnNm: 'trim'
						},
						{
							mapFnId: '2',
							mapFnNm: 'sysdate'
						},
					];

					var deferred = $.Deferred();
					mint.callService(null, 'AN-06-01-002', 'REST-R05-AN-06-01', function(responseData) {
						if(responseData) {
							var htmlTemplate = kendo.template($('#template-map-function').html());
							$('.context-menu').append( htmlTemplate(responseData) );
							deferred.resolve();
						} else {
							deferred.reject();
						}
					},
						{
					    	errorCall : true,
					    	notificationView : false
					    }
					);
					return deferred.promise();
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_mapFunction"});
				}
			},//end fn_mapFunction()


			//-----------------------------------------------------------------------
			// Description :: fn_initLayoutTreeList
			//-----------------------------------------------------------------------
			fn_initLayoutTreeList : function(jsonData) {
				try {

					var hCSSCenter = {style: 'text-align: center; vertical-align:middle;'};
					var aCSSCenter = {style: 'text-align: center; white-space: nowrap;'};
					var aCSSLeft = {style: 'text-align: left; white-space: nowrap;'};
					var locked = false;
					var scrollable = false;

					var treeListTemplate = function(layer) {
						var gridEl = (layer == 'source' ? $('.mappingSource') : $('.mappingTarget'))
						return {
							dataSource : $.main_detail.fn_getTreeListDataSource([]),
							filterable: false,
							resizable: true,
				            sortable: false,
				            selectable: true,
				            scrollable: scrollable,
				            editable: {
				            	move: true
				            },
				            height: mint.ui.gridInitHeight(gridEl, scrollable),
							columns: [
								{
									field: "name1",
									title: mint.label.getLabel('lb-1014'),
									headerAttributes: hCSSCenter, attributes: aCSSLeft,
									width: "130px", expandable: true, locked: locked,
								},
								{
									field: "name2",
									title: mint.label.getLabel('lb-1015'),
									headerAttributes: hCSSCenter, attributes : aCSSCenter,
									width: "130px", locked: locked,
								},
								{
									field: "typeNm",
									title:  mint.label.getLabel('lb-48'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									editor : function(container, options) {
										mint.ui.gridEditorFieldTypeComboBox(container, options, '$.main_detail.fn_fieldTypeCheck');
									},
									width: "120px", locked: locked,
								},
								{
									field: "length",
									title: mint.label.getLabel('lb-1012'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "100px",
								},
								{
									field: "clear",
									title: " ",
									template: "<span class='unlink'><i class='fa fa-undo'></i></span>",
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									editable: function(dataItem) { return false; },
									width: "30px", locked: locked,
									hidden : (layer == 'source' ? false : true)
								},
								{
									field: "move",
									title: " ",
									template: "<span class='move'><i class='fa fa-arrows-alt'></i></span>",
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									editable: function(dataItem) { return false; },
									width: "30px", locked: locked,
									hidden : (layer == 'source' ? false : true)
								},

								//{ field : "seq", hidden : true },
								//{ field : "type", hidden : true },
								//{ field : "typeCd", hidden : true },
								//{ field : "encryptType", hidden : true },
								//{ field : "justify", hidden : true },
								//{ field : "dataFieldId", hidden : true },
								//{ field : "fieldSetId", hidden : true },
								//{ field : "dataSetId", hidden : true },
								//{ field : "id", hidden : true },

							],
							beforeEdit: function(e) {
							},
							edit: function(e) {
								e.container.find("button[class*='k-button']").each(function(){
									var command = $(this).data('command');
									if( command === 'update' || command === 'canceledit' ) {
										var span = $(this).find('span')[0];
										$(this).addClass('mint-i-btn');
										$(this).html(span);
									}
								});
							},
 							change: function(e) {
							},
							dataBound: function (e) {
								//-----------------------------------------------------------------------
								// ROW / COL CSS 처리
								//-----------------------------------------------------------------------
								var items = e.sender.dataItems();
								if( items.length > 0 ) {
									for(var i = 0; i < items.length; i++ ) {
										var trTotal = e.sender.wrapper.find("tr[data-uid='" + items[i].uid + "']");
										trTotal.removeClass('k-alt');

										var tr = e.sender.wrapper.find("tr[data-uid='" + items[i].uid + "']:first");
										tr.attr('data-offset', items[i].id);
										tr.attr('data-name', items[i].dataFieldId);

										var ioType = (layer == 'source') ? '0' : '1';
										$(tr).data('item', $.main_detail.fn_getTreeListItemObject(items[i], ioType));

									}
								}

								mint.ui.gridVerticalScrollBar(e);
 							},
 							dataBinding: function(e) {
 							},
							collapse: function(e) {
								e.preventDefault();
							},
							beforeEdit: function(e) {
							},
							save: function(e) {
							},
							saveChanges: function(e) {
							},
							remove: function(e) {
							},
							cancel: function(e) {
							},
							dragstart: function(e) {
								e.preventDefault();
							},
							drag: function(e) {
							},
							dragend: function(e) {
							}
						};

					};

					//-----------------------------------------------------------------------
					// treeList create
					//-----------------------------------------------------------------------
					$(".mappingSource").kendoTreeList(treeListTemplate('source'));
					$(".mappingTarget").kendoTreeList(treeListTemplate('target'));

					//-----------------------------------------------------------------------
					// contextMenu create
					//-----------------------------------------------------------------------
					{
						$(".context-menu").kendoContextMenu({
							target: '.mappingTarget',
							filter: 'tbody>tr.k-state-selected',
							select: function(e) {
								var node = $(e.target);

								var fnAc = e.item.dataset.action;
								var fnId = e.item.dataset.id;
								var fnNm = e.item.dataset.nm;

								if( !mint.common.isEmpty(fnAc) ) {
									var entityTree = $('.mappingTarget').data('kendoTreeList');
									var selectedItem = entityTree.dataItem(node);

									if(fnAc == 'fn-clear') {

										$('.mapping').data('mintMapper').clearFunction(selectedItem.id);
										$('#fn-' + selectedItem.uid).remove();

									} else if(fnAc == 'fn-add') {

										$('.mapping').data('mintMapper').setFunction(selectedItem.id, fnId);

										var fnLabeled = $('#fn-' + selectedItem.uid);
										if(fnLabeled.length == 0) {
											var tr = entityTree.itemFor(selectedItem);
											var td = tr.find("td:eq(0)");

											var htmlTemplate = kendo.template($('#template-map-fn-label').html());
											td.append( htmlTemplate( {uid: selectedItem.uid, fnNm: fnNm} ) );

										}
									}

									$('.mapping').data('mintMapper').refresh();
								}

							}
						});
					}


				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initLayoutTreeList"});
				}
			},//end fn_initLayoutTreeList()

			//-----------------------------------------------------------------------
			// Description :: fn_layoutDetailTreeList
			//-----------------------------------------------------------------------
			fn_layoutDetailTreeList : function(dataSource) {
				try {

					var hCSSCenter = {style: 'text-align: center; vertical-align:middle;'};
					var aCSSCenter = {style: 'text-align: center; white-space: nowrap;'};
					var aCSSLeft = {style: 'text-align: left; white-space: nowrap;'};
					var locked = false;

					var treeListTemplate = function() {
						return {
				          	dataSource : dataSource,
							filterable: false,
							resizable: true,
				            sortable: false,
				            selectable: true,
				            scrollable: true,
				            height: "500px",
							columns: [

								{
									field: "name1",
									title: mint.label.getLabel('lb-1014'),
									headerAttributes: hCSSCenter, attributes : aCSSLeft,
									width: "130px", locked: locked, expandable: true,
								},
								{
									field: "parentNmKo",
									title: mint.label.getLabel('lb-1049'), //부모식별자(한)
									headerAttributes: hCSSCenter, attributes : aCSSLeft,
									width: "130px", locked: locked,
								},
								{
									field: "requiredYn",
									title:  mint.label.getLabel('lb-1050'), //필수
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "80px", locked: locked,
								},
								{
									field: "metaYn",
									title: mint.label.getLabel('lb-1043'), //메타체크
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "80px", locked: locked,
								},
								{
									field: "name2",
									title: mint.label.getLabel('lb-1015'),
									headerAttributes: hCSSCenter, attributes: aCSSLeft,
									width: "130px", locked: locked
								},
								{
									field: "parentNmEn",
									title: mint.label.getLabel('lb-1051'), //부모식별자(영)
									headerAttributes: hCSSCenter, attributes : aCSSLeft,
									width: "130px", locked: locked,
								},
								{
									field: "type",
									title:  mint.label.getLabel('lb-48'),
									template: '#=typeNm#',
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px", locked: locked,
								},
								{
									field: "userKeyYn",
									title: mint.label.getLabel('lb-1052'), //이용자식별번호여부
									template: '#=userKeyYn#',
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "130px", locked: false,
								},
								{
									field: "personalInfoUseYn",
									title: mint.label.getLabel('lb-1053'), //개인정보대상여부
									template: '#=personalInfoUseYn#',
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px", locked: false,
								},
								{
									field: "pk",
									title: mint.label.getLabel('lb-1058'), //PK
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "80px", locked: false,
								},
								{
									field: "length",
									title: mint.label.getLabel('lb-1012'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter, format: '{0:#}',
									width: "100px",
								},
								{
									field: "scale",
									title: mint.label.getLabel('lb-1059'), //SCALE
									headerAttributes: hCSSCenter, attributes: aCSSCenter, format: '{0:#}',
									width: "100px",
								},
								{
									field: "offset",
									title: mint.label.getLabel('lb-1016'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter, format: '{0:#}',
									width: "100px",
									hidden: true,
								},
								{
									field: "defaultValue",
									title: mint.label.getLabel('lb-1017'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "100px",
								},
								{
									field: "justify",
									title: mint.label.getLabel('lb-1023'),
									template: '#=justifyNm#',
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px",
								},
								{
									field: "padding",
									title: mint.label.getLabel('lb-1024'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "95px",
								},
								{
									field: "encryptType",
									title: mint.label.getLabel('lb-1018'),
									template: '#=encryptTypeNm#',
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px",
								},
								{
									field: "koreanYn",
									title: mint.label.getLabel('lb-1054'), //한글여부
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "100px",
								},
								{
									field: "decimalPointYn",
									title: mint.label.getLabel('lb-1055'), //소수점포함여부
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px",
								},

								{
									field: "maskingYn",
									title: mint.label.getLabel('lb-1056'), //마스킹여부
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									editor: mint.ui.gridEditorYesOrNoComboBox,
									width: "100px",
								},
								{
									field: "maskingPatternCd",
									title: mint.label.getLabel('lb-1057'), //마스킹패턴코드
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "150px",
								},
								{
									field: "comments",
									title: mint.label.getLabel('lb-527'), //비고
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "200px",
								},

								{
									field: "isLengthField",
									title: mint.label.getLabel('lb-1019'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "100px",
									hidden: true,
								},
								{
									field: "hasRepeatCountField",
									title: mint.label.getLabel('lb-1020'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "100px",
									hidden: true,
								},
								{
									field: "repeatFieldId",
									title: mint.label.getLabel('lb-1021'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter,
									width: "120px",
									hidden: true,
								},
								{
									field: "repeatCount",
									title: mint.label.getLabel('lb-1022'),
									headerAttributes: hCSSCenter, attributes: aCSSCenter, format: '{0:#}',
									width: "100px",
									hidden: true,
								},
								{ field : "id", hidden : true },
							],
							dataBound: function (e) {
								//TODO :: Workalound
								mint.common.setTimeout(function(){
									mint.ui.gridVerticalScrollBar(e);
								}, 10);

								//-----------------------------------------------------------------------
								// ROW / COL CSS 처리
								//-----------------------------------------------------------------------
								var items = e.sender.dataItems();
								if( items.length > 0 ) {
									for(var i = 0; i < items.length; i++ ) {
										var tr = e.sender.wrapper.find("tr[data-uid='" + items[i].uid + "']");
										tr.removeClass('k-alt');
									}
								}
 							},
						};

					};

					$(".layout-detail").kendoTreeList(treeListTemplate());
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_layoutDetailTreeList"});
				}
			},//end fn_layoutTreeListTemplate()

			//-----------------------------------------------------------------------
			// Description :: fn_gridTemplateMove
			//-----------------------------------------------------------------------
			fn_gridTemplateMove : function(item, ioType) {
				try {
					var unlink = "<span style='cursor: pointer;'><i class='fa fa-undo'></i></span>";
					var link   = "<span style='cursor: pointer;'><i class='fa fa-arrows-alt'></i></span>";

					return "<span style='color:#aaaaa9;'>" + unlink + link + "</span>";
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_gridTemplateMove"});
				}
			},//end fn_gridTemplateMove()

			//-----------------------------------------------------------------------
			// Description :: fn_getTreeListItemObject
			//-----------------------------------------------------------------------
			fn_getTreeListItemObject : function(item, ioType) {
				try {
					var itemObject = {
						objectType: 'DataMapItemField',
						dataSetId: item.dataSetId,
						dataFieldId: item.dataFieldId,
						dataFieldSeq: item.seq,
						mapId: '',
						mapItemId: '',
						ioType: ioType
					};

					return itemObject;
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getTreeListItemObject"});
				}
			},//end fn_getTreeListItemObject()

			//-----------------------------------------------------------------------
			// Description :: fn_getTreeListDataSource
			//-----------------------------------------------------------------------
			fn_getTreeListDataSource : function(jsonData) {
				try {
					var	dataSource = new kendo.data.TreeListDataSource({
							data: jsonData,
						    schema: {
						    	model: $.main_detail.fn_getTreeListModel()
						    },
					});
					return dataSource;
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getTreeListDataSource"});
				}
			},//end fn_getTreeListDataSource()

			//-----------------------------------------------------------------------
			// Description :: fn_getTreeListModel
			//-----------------------------------------------------------------------
			fn_getTreeListModel : function() {
				try {
					var model = {
						id: "id",
						parentId: "parentId",
	            		fields: {
	            			objectType: {type: "string", editable:false, nullable:false, defaultValue: "DataField"},
	            			id: {type: "string", editable:true, nullable: false},
	            			parentId: {type: "string", editable:true, nullable: true},
	            			dataSetId:   {type: "string", editable:false, nullable: false, defaultValue: ""},
	            			dataFieldId: {type: "string", editable:false, nullable: false, defaultValue: ""},
	            			fieldSetId:  {type: "string", editable:false, nullable: true, defaultValue: ""},
	            			seq:         {type: "string", editable: false, nullable: false, defaultValue: ""},
		            		name1:       {type: "string", editable: true, nullable: false, defaultValue: ""},
		            		name2:       {type: "string", editable: true, nullable: false, defaultValue: ""},
		            		cd:          {type: "string", editable: false, nullable: true, defaultValue: ""},
		            		type:        {type: "string", editable: true, nullable: false, defaultValue: ""},
		            		typeCd:      {type: "string", editable: true, nullable: false, defaultValue: ""},
		            		typeNm:      {type: "string", editable: true, nullable: false, defaultValue: ""},
		            		offset:      {type: "number", validation: { required: true, min: 0, step: 1, format: 'n0', decimals: 1 } , editable: true, nullable: false, defaultValue: 0},
	            			length:      {type: "number", validation: { required: true, min: 0} , editable: true, nullable: false, defaultValue: 0},
	            			encryptType : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			encryptTypeNm : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			isLengthField : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			repeatCount : {type: "number", validation: { required: true, min: 0} , editable: true, nullable: false, defaultValue: 0},
	            			hasRepeatCountField : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			repeatDataSetId : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			repeatFieldId : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			defaultValue: {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			justify : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			justifyNm : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			padding : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			regDate : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			regId : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			modDate : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            			modId : {type: "string", editable: true, nullable: false, defaultValue: ""},
	            		},
	            		expanded: true
					};

					var TreeListModel = new kendo.data.TreeListModel.define(model);
					return TreeListModel;
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getTreeListModel"});
				}
			}, //end fn_getTreeListModel()

			//-----------------------------------------------------------------------
			// Description ::  Validation 체크
			//-----------------------------------------------------------------------
			fn_validationCheck : function() {
				try {


					// 맵핑명
					if( mint.common.isEmpty($('#tf-mapNm').val()) ) {
						mint.common.alert('CW00001', mint.label.getLabel('lb-1063'));
						$('#tf-mapNm').focus();
						return false;
					}

					// 맵핑코드
					if( mint.common.isEmpty($('#tf-mapCd').val()) ) {
						mint.common.alert('CW00001', mint.label.getLabel('lb-1006'));
						$('#tf-mapCd').focus();
						return false;
					}

					// 맵핑
					{
						var mappingObject = $('.mapping').data('mintMapper');

						var mappingInfo = mint.common.isEmpty(mappingObject) ? null : mappingObject.getMappingInfo();
						if( mint.common.isEmpty(mappingInfo) || mint.common.isEmpty(mappingInfo.links) || mappingInfo.links == 0 ) {
							mint.common.alert('CW00019', 'Mapping');
							return false;
						}
					}

					return true;

				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_validationCheck"});
				}
			},//end fn_validationCheck()

			//-----------------------------------------------------------------------
			// Description :: 저장
			//-----------------------------------------------------------------------
			fn_save : function() {
				try {
					if( $.main_detail.fn_validationCheck() ) {
						$.main_detail.fn_saveMapping();
					} else {
						// doSomething
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_save"});
				}
			},//end fn_save()

			//-----------------------------------------------------------------------
			// Description :: fn_getMappingObject
			//-----------------------------------------------------------------------
			fn_getMappingObject : function() {
				try {

					//-----------------------------------------------------------------------
					// Mappping Master
					//-----------------------------------------------------------------------
					var source = $('.mappingSource');
					var target = $('.mappingTarget');

					var mapperObject = $('.mapping').data('mintMapper');
					var mappingInfo = mapperObject.getMappingInfo();

					//-----------------------------------------------------------------------
					// Mappping Master
					//-----------------------------------------------------------------------
					var mappingObject = new Object();
					mappingObject.objectType      = 'DataMap';
					mappingObject.mapId			  = $("#tf-mapId").val();
					mappingObject.cd			  = $("#tf-mapCd").val();
					mappingObject.name			  = $("#tf-mapNm").val();
					mappingObject.srcDataSetId	  = $('.layout-source-dataSetId').val();
					mappingObject.tagDataSetId	  = $('.layout-target-dataSetId').val();
					mappingObject.delYn           = 'N';
					mappingObject.dataMapItemList = mappingInfo.links;

					return mappingObject;

				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getMappingObject"});
				}
			},//end fn_getMappingObject()

			//-----------------------------------------------------------------------
			// Description :: fn_saveMappingt
			//-----------------------------------------------------------------------
			fn_saveMapping : function() {
				try {
					var mappingObject = $.main_detail.fn_getMappingObject();

					if( !mint.common.isEmpty($('#tf-mapId').val()) && $.main_detail.isModify == true ) {
						// 수정일 경우
						if( !mint.common.isEmpty($('#hd-mapCd').val()) && $('#hd-mapCd').val() != $('#tf-mapCd').val() ) {
							$.main_detail.fn_mapCdCheck(function() {
								$.main_detail.fn_updateMapping(mappingObject);
							});
						} else {
							$.main_detail.fn_updateMapping(mappingObject);
						}

					} else {
						// 등록일 경우, MAP_CD 중복체크
						$.main_detail.fn_mapCdCheck(function() {
							$.main_detail.fn_createMapping(mappingObject);
						});
					}

				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_saveMapping"});
				}
			},//end fn_saveMapping()


			//-----------------------------------------------------------------------
			// Description :: fn_mapCdCheck
			//-----------------------------------------------------------------------
			fn_mapCdCheck : function(func) {
				try {
					mint.callService(null, screenName, 'REST-R03-AN-06-01', function(responseData) {
						if( !mint.common.isEmpty(responseData) && responseData == 0 ) {
							func();
						} else {
							mint.common.alert('CW00024', $("#tf-mapCd").val());
							return;
						}
					},
					{
						  errorCall : true
						, notificationView : false
						, params 	: {mapCd : $("#tf-mapCd").val()}
					});
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_mapCdCheck"});
				}
			},//end fn_mapCdCheck()

			//-----------------------------------------------------------------------
			// Description :: fn_updateMapping
			//-----------------------------------------------------------------------
			fn_updateMapping : function(mappingObject) {
				try {
					mint.callService(mappingObject, screenName, 'REST-U01-AN-06-01', '$.main_detail.fn_saveComplete',
						{
							  errorCall : true
							, notificationView : false
							, params 	: {mapId : $("#hd-mapId").val()}
						}
					);
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_updateMapping"});
				}
			},//end fn_updateMapping()

			//-----------------------------------------------------------------------
			// Description :: fn_createMapping
			//-----------------------------------------------------------------------
			fn_createMapping : function(mappingObject) {
				try {
					mint.callService(mappingObject, screenName, 'REST-C01-AN-06-01', '$.main_detail.fn_saveComplete',
						{
							  errorCall : true
							, notificationView : false
						}
					);
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_createMapping"});
				}
			},//end fn_createMapping()

			//-----------------------------------------------------------------------
			// Description :: 저장 콜백
			//-----------------------------------------------------------------------
			fn_saveComplete : function(jsonObject) {
				try {
					if( !mint.common.isEmpty(jsonObject) ) {
						//-----------------------------------------------------------------------
						// - Alert Message 를 Display 한다.
						//-----------------------------------------------------------------------
						var msgCode = null;
						if( mint.common.isEmpty($('#tf-mapId').val()) ) {
							msgCode = 'CI00101';
						} else {
							msgCode = 'CI00102';
						}
						mint.common.alert(msgCode, null);

						{
							mint.setDetailView('Y');
							mint.common.setScreenParam("mapId", jsonObject.mapId);
							mint.move('../sub-an/AN-06-01-003');
						}
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_saveComplete"});
				}
			},//end fn_saveComplete()

			//-----------------------------------------------------------------------
			// Description :: fn_loadLayout
			// - source/target 레이아웃만 설정시
			//-----------------------------------------------------------------------
			fn_loadLayout : function(caller) {
				try {
					mint.common.setScreenParam("caller", caller);
					//mint.common.setScreenParam('applyType', 'normal');
					mint.common.setScreenParam('callback', '$.main_detail.fn_loadLayoutCallback');
					mint.common.searchPopup('../sub-an/AN-06-02-001.html','AN-06-02-001');
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_btnDataSetSearchClickEvent"});
				}
			},//end fn_loadLayout()

			//-----------------------------------------------------------------------
			// Description :: fn_loadLayoutCallback( callback )
			//-----------------------------------------------------------------------
			fn_loadLayoutCallback : function(selectedItem) {
				try {
					if( !mint.common.isEmpty(selectedItem) ) {
						var caller = mint.common.getScreenParam('caller');
						mint.common.removeScreenParam('caller');

						var responseData = {
							mapData: {mapId: '', name: '', cd: '', dataMapItemList: []},
							srcDataSet: caller === 'both' ? selectedItem : (caller === 'source' ? selectedItem : null),
							tagDataSet: caller === 'both' ? selectedItem : (caller === 'target' ? selectedItem : null)
						};

						$.main_detail.fn_setLayoutBinding(responseData, (caller === 'both' ? null : caller));
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_loadLayoutCallback"});
				}
			},//end fn_loadLayoutCallback()

			//-----------------------------------------------------------------------
			// Description :: (1) fn_setLayoutBinding
			// - 레이이웃 선처리
			//-----------------------------------------------------------------------
			fn_setLayoutBinding : function(responseData, caller) {
				try {
		      		if( !mint.common.isEmpty(responseData) ) {
		      			{
			      			responseData.mapData = mint.common.isEmpty(responseData.mapData) ? $.main_detail.fn_getLayoutModel('map') : responseData.mapData;
			      			responseData.srcDataSet = mint.common.isEmpty(responseData.srcDataSet) ? $.main_detail.fn_getLayoutModel('layout') : responseData.srcDataSet;
			      			responseData.tagDataSet = mint.common.isEmpty(responseData.tagDataSet) ? $.main_detail.fn_getLayoutModel('layout') : responseData.tagDataSet;
		      			}

						$.main_detail.fn_setLayoutMapping(caller, responseData);
		      		}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setLayoutBinding"});
				}
			},//end fn_setLayoutBinding()

			//-----------------------------------------------------------------------
			// Description :: (2) fn_setLayoutMapping
			// - Layout Layer :: 맵핑 정보 binding
			//-----------------------------------------------------------------------
			fn_setLayoutMapping : function(caller, responseData) {
				try {

					if( !mint.common.isEmpty(responseData) ) {
						//-----------------------------------------------------------------------
						// init
						//-----------------------------------------------------------------------
						var mapData = responseData.mapData;
						var srcDataSet = responseData.srcDataSet;
						var tagDataSet = responseData.tagDataSet;

						var srcDiv = $('.mappingSource');
						var tagDiv = $('.mappingTarget');

						var srcTreeList = srcDiv.data('kendoTreeList');
						var tagTreeList = tagDiv.data('kendoTreeList');

						//-----------------------------------------------------------------------
						// Source/Target Layout
						//-----------------------------------------------------------------------
						if( caller ) {
							$.main_detail.fn_setLayout(caller, caller == 'source' ? srcDataSet : tagDataSet);
						} else {
							$.main_detail.fn_setLayout('source', srcDataSet);
							$.main_detail.fn_setLayout('target', tagDataSet);
						}

						//-----------------------------------------------------------------------
						// Mapping Basic Info
						//-----------------------------------------------------------------------
						{
							if( !mint.common.isEmpty( mapData.mapId) ){
								$('#tf-mapId').val( mapData.mapId );
							}

							if( mint.common.isEmpty( $('#tf-mapNm').val() ) ) {
								$('#tf-mapNm').val( mapData.name );
							}

							if( mint.common.isEmpty( $('#tf-mapCd').val() ) ) {
								$('#tf-mapCd').val( mapData.cd );
								$('#hd-mapCd').val( mapData.cd );
							}

							var regUserNm = mint.common.isEmpty(mapData.regUser) ? '' : '(' + mapData.regUser.userNm + ')';
							var modUserNm = mint.common.isEmpty(mapData.modUser) ? '' : '(' + mapData.modUser.userNm + ')';

							var regInfo = (mint.common.isEmpty( mapData.regDate ) ? '' : mint.common.formatDate(mapData.regDate)) + regUserNm;
							var modInfo = (mint.common.isEmpty( mapData.modDate ) ? '' : mint.common.formatDate(mapData.modDate)) + modUserNm;

							$('#tf-regDate').val( regInfo );
							$('#tf-modDate').val( modInfo );

						}

						//-----------------------------------------------------------------------
						// Mapping Item Setting(TODO: 공통모듈 처리)
						//-----------------------------------------------------------------------
						var mappingObject = mapData.dataMapItemList;
						mappingObject.forEach(function(value, index, array) {
							value.items.filter(function(v, i, a) {
								if( v.ioType === "0" ) {
									value.src = v.dataFieldId;
								} else if( v.ioType === "1") {
									value.tag = v.dataFieldId;
								}
							});
						});

						$(".mapping").mintMapper($.main_detail.fn_setMapperInput(mappingObject), $.main_detail.fn_getMapperOptions());
						$.main_detail.fn_labelAttachFunction();
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setLayoutMapping"});
				}
			},//end fn_setLayoutMapping()

			//-----------------------------------------------------------------------
			// Description :: fn_setLayout(callBack)
			//-----------------------------------------------------------------------
			fn_setLayout : function(caller, dataSetItem) {
				try {

					if(caller == 'source') {
						var bindingTreeList = $('.mappingSource').data("kendoTreeList");
					} else {
						var bindingTreeList = $('.mappingTarget').data("kendoTreeList");
					}

					//-----------------------------------------------------------------------
					// Layout(DataSet) 기본 정보
					//-----------------------------------------------------------------------
					$('.layout-' + caller + '-dataSetId').val(dataSetItem.dataSetId);
					$('.layout-' + caller + '-dataSetCd').val(dataSetItem.cd);
					$('.layout-' + caller + '-dataSetNm1').val(dataSetItem.name1);
					$('.layout-' + caller + '-dataSetNm2').val(dataSetItem.name2);

					//-----------------------------------------------------------------------
					// Layout(DataField) List
					//-----------------------------------------------------------------------
					bindingTreeList.setDataSource($.main_detail.fn_getTreeListDataSource(dataSetItem.dataFieldList));
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setLayout"});
				}
			},//end fn_setLayout()


			//-----------------------------------------------------------------------
			// Description :: fn_labelAttachFunction
			//-----------------------------------------------------------------------
			fn_labelAttachFunction : function() {
				try {
					var entityTree = $('.mappingTarget').data('kendoTreeList');
					var mappingInfo = $('.mapping').data('mintMapper').view();

					if( !mint.common.isEmpty(mappingInfo) && mappingInfo.length > 0 ) {
						mappingInfo.forEach(function(v, i, a) {
							if( v.mapCtrlType === '3' && !mint.common.isEmpty(v.mapFnId) ) {
								var node = entityTree.dataSource.get(v.tag)
								var selectedItem = entityTree.dataItem(node);

								var fnLabeled = $('#fn-' + selectedItem.uid);
								if(fnLabeled.length == 0) {
									var tr = entityTree.itemFor(selectedItem);
									var td = tr.find("td:eq(0)");

									var htmlTemplate = kendo.template($('#template-map-fn-label').html());
									td.append( htmlTemplate( {uid: selectedItem.uid, fnNm: v.mapFnNm} ) );

								}

							}
						});

						$('.mapping').data('mintMapper').refresh();
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_labelAttachFunction"});
				}
			},//end fn_labelAttachFunction()





			//-----------------------------------------------------------------------
			// Description :: fn_getLayoutModel
			//-----------------------------------------------------------------------
			fn_getLayoutModel : function(layoutType) {
				try {

					var MapModel = {
						mapId: '',
						name: '',
						cd: '',
						dataMapItemList: []
					};

					var DataSetModel = {
						dataSetId: '',
						cd: '',
						name1: '',
						name2: '',
						dataFieldList: []
					};

					var LayoutModel = {
						mapData: MapModel,
						srcDataSet: DataSetModel,
						tagDataSet: DataSetModel
					};

					if(layoutType == 'map') {
						return MapModel;
					} if(layoutType == 'layout') {
						return DataSetModel;
					} else {
						return LayoutModel;
					}


				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getLayoutModel"});
				}
			},//end fn_getLayoutModel()

			//-----------------------------------------------------------------------
			// Description :: fn_saveCancel
			//-----------------------------------------------------------------------
			fn_saveCancel : function(layoutType) {
				try {
					mint.setDetailView('Y');
					mint.common.setScreenParam("mapId", $("#tf-mapId").val());
					mint.move('../sub-an/AN-06-01-003');
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_saveCancel"});
				}
			},//end fn_saveCancel()

			//-----------------------------------------------------------------------
			// Description :: fn_initMapping
			//-----------------------------------------------------------------------
			fn_initMapping : function() {
				try {
					var mappingObject = $('.mapping').data('mintMapper');
					if( !mint.common.isEmpty(mappingObject) ) {
						mappingObject.initMapping();
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initMapping"});
				}
			},//end fn_initMapping()

			//-----------------------------------------------------------------------
			// Description :: fn_autoMappingByOneToOne
			//-----------------------------------------------------------------------
			fn_autoMappingByOneToOne : function() {
				try {
					var srcDiv = $('.mappingSource');
					var tagDiv = $('.mappingTarget');

					var srcTreeList = srcDiv.data('kendoTreeList');
					var tagTreeList = tagDiv.data('kendoTreeList');

					var srcDataView = srcTreeList.dataSource.view();
					var tagDataView = tagTreeList.dataSource.view();

					var mappingObject = [];
					for(var i = 0; i < srcDataView.length; i++ ) {
						//if( srcDataView[i].hasChildren === true )
						//	continue;
						if( i > (tagDataView.length - 1) )
							break;

						var items = [];
						items.push( srcTreeList.itemFor(srcDataView[i]).data('item') );
						items.push( tagTreeList.itemFor(tagDataView[i]).data('item') );

						var mapItem = {
								src: srcDataView[i].id,
								tag: tagDataView[i].id,
								items: items
						};

						$.extend(mapItem, $.main_detail.fn_getMapperOptions().addAttributes);
						mappingObject.push(mapItem);
					}

					$(".mapping").mintMapper($.main_detail.fn_setMapperInput(mappingObject), $.main_detail.fn_getMapperOptions());


				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_autoMappingByOneToOne"});
				}
			},//end fn_autoMappingByOneToOne()


			//-----------------------------------------------------------------------
			// Description :: fn_autoMappingByName
			//-----------------------------------------------------------------------
			fn_autoMappingByName : function() {
				try {
					var srcDiv = $('.mappingSource');
					var tagDiv = $('.mappingTarget');

					var srcTreeList = srcDiv.data('kendoTreeList');
					var tagTreeList = tagDiv.data('kendoTreeList');

					var srcDataView = srcTreeList.dataSource.view();
					var tagDataView = tagTreeList.dataSource.view();

					var mappingObject = [];
					for(var i = 0; i < srcDataView.length; i++ ) {
						//if( srcDataView[i].hasChildren === true )
						//	continue;

						tagDataView.forEach(function(v, ii, a) {

							if( srcDataView[i].name2 == v.name2 ) {
								var items = [];
								items.push( srcTreeList.itemFor(srcDataView[i]).data('item') );
								items.push( tagTreeList.itemFor(v).data('item') );

								var mapItem = {
										src: srcDataView[i].id,
										tag: v.id,
										items: items
								};

								$.extend(mapItem, $.main_detail.fn_getMapperOptions().addAttributes);
								mappingObject.push(mapItem);
							}
						});
					}

					$(".mapping").mintMapper($.main_detail.fn_setMapperInput(mappingObject), $.main_detail.fn_getMapperOptions());


				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_autoMappingByName"});
				}
			},//end fn_autoMappingByName()

			//-----------------------------------------------------------------------
			// Description :: fn_getMapperOptions
			//-----------------------------------------------------------------------
			fn_getMapperOptions : function() {
				try {
					var mapperOptions = {
							//associationMode: 'manyToMany', // oneToOne, manyToMany
							associationMode: 'manyToMany',
							lineStyle: 'square-ends',
							buttonErase: 'Erase Links',
							addAttributes: $.main_detail.fn_getAddAttributes()
					}

					return mapperOptions;
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getMapperOptions"});
				}
			},//end fn_getMapperOptions()

			//-----------------------------------------------------------------------
			// Description :: fn_getAddAttributes
			//-----------------------------------------------------------------------
			fn_getAddAttributes : function() {
				try {
					var attributes = {
						mapId: '',
						mapItemId: '',
						seq: 0,
						mapCtrlType: '0',
						mapFnId: '',
						mapFnNm: ''
					}

					return attributes;
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_getAddAttributes"});
				}
			},//end fn_getAddAttributes()

			//-----------------------------------------------------------------------
			// Description :: fn_setMapperInput
			//-----------------------------------------------------------------------
			fn_setMapperInput : function(mappingObject) {
				try {
					//-----------------------------------------------------------------------
					// Mapping Draw(TODO: 공통모듈 처리)
					//-----------------------------------------------------------------------
					return {
						list: [
							{
								"name": "Source Fields",
								"list" : []
							},
							{
								"name": "Target Fields",
								"list" : [],
								"mandatories" :[]
							}
						],
						existingLinks: mappingObject
					};

				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setMapingInput"});
				}
			},//end fn_setMapingInput()

			//-----------------------------------------------------------------------
			// Description :: fn_detailWindowOpen
			//-----------------------------------------------------------------------
			fn_detailWindowOpen : function(target, options) {
				try {
					//-----------------------------------------------------------------------
					// sub window 를 attach 할 division select
					//-----------------------------------------------------------------------
					var subWindow = $('.mint-sub-window');
					if( mint.common.isEmpty(subWindow) || subWindow.size() == 0 ) {
						$('body').append($('<div class="mint-sub-window"><div class="layout-detail"></div></div>'));
					}

					//-----------------------------------------------------------------------
					// 선택된 디비전에 컨텐츠를 붙인다
					//-----------------------------------------------------------------------
					$.main_detail.fn_layoutDetailTreeList([]);

					if(target == 'source') {
						var dataSource = $('.mappingSource').data('kendoTreeList').dataSource;
					} else {
						var dataSource = $('.mappingTarget').data('kendoTreeList').dataSource;
					}

					var dataLength = dataSource.total();
					var isDefault = dataLength > 100 ? true : false;
					var treeList = $(".layout-detail").data('kendoTreeList');

					if(isDefault) {
						var	ds = {
							data: dataSource.data(),
						    pageSize : mint.ui.getPageSizesM({'currentPage' : true})
						};

						treeList.options.pageable = {
							input : true
						};
						treeList.setDataSource(ds);
					} else {
						var	ds = {
							data: dataSource.data()
						};
						treeList.setDataSource(ds);
					}

					//-----------------------------------------------------------------------
					// subWindow Open
					//-----------------------------------------------------------------------
					$('.mint-sub-window').kendoWindow({
						title: mint.label.getLabel('lb-833'), //전문I/O 상세
			            modal: true,
			            draggable: true,
			            scrollable: false,
			            width: '1400px',
			            close: function(e) {
			            	this.destroy();
			            }
					}).data('kendoWindow').center().open();



				} catch (e) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_detailWindowOpen"});
				}
			}, //end fn_detailWindowOpen


		}// end main
	});// end extends

	//=======================================================================
	// (4) 이벤트 핸들러 정의
	//=======================================================================

	//-----------------------------------------------------------------------
	// Description :: 저장 버튼 Click 이벤트
	//-----------------------------------------------------------------------
	$('.btn-save').on('click', function() {
		$.main_detail.fn_save();
	});

	//-----------------------------------------------------------------------
	// Description :: 이전 버튼 Click 이벤트
	//-----------------------------------------------------------------------
	$('.btn-back').on('click', function(e) {
		mint.back(null);
	});

	//-----------------------------------------------------------------------
	// Description :: 취소 버튼 Click 이벤트
	//-----------------------------------------------------------------------
	$('.btn-cancel').click(function(e) {
		$.main_detail.fn_saveCancel();
	});

	//-----------------------------------------------------------------------
	// Description :: Layout Detail
	//-----------------------------------------------------------------------
	$('.detail-source').on('click', function(e) {
		$.main_detail.fn_detailWindowOpen('source');
	});

	//-----------------------------------------------------------------------
	// Description :: Layout Detail
	//-----------------------------------------------------------------------
	$('.detail-target').on('click', function(e) {
		$.main_detail.fn_detailWindowOpen('target');
	});

	//=======================================================================
	// (5) 기타 Function 정의
	//=======================================================================

	//=======================================================================
	// (6) 화면 로딩시 실행할 항목 기술
	//=======================================================================
	$.main_detail.fn_init();
	mint.label.attachLabel(null);

});
</script>