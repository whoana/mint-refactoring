<!--
	Screen ID : OP-04-01-003
	Screen NM : 인터페이스 배포 이력  조회
		[변경 이력]
	* YYYYMMDD-###
	  - xx
	* 201700222-001
-->

<!--location -->
<div class="row wrapper border-bottom white-bg page-heading">
	<div id="oldPath" class="col-lg-5">
		<h2><lb class="lb-843"></lb></h2>
		<ol class="breadcrumb">
	        <li><lb class="lb-8"></lb></li>
	        <li><lb class="lb-838"></lb></li>
	        <li class="active"><strong><lb class="lb-843"></lb></strong></li>
 		</ol>
	</div>

	<div id="menuPath" class="col-lg-5">
    </div>
</div>
<!--location end-->

<!--wrapper wrapper-content-->
<div class="wrapper wrapper-content animated fadeInRight">
	<!--row-->
	<div class="row">
		<!--col-lg-12-->
		<div class="col-lg-12">
			<!--ibox float-e-margins-->
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5><lb class="lb-78"></h5>&nbsp;&nbsp;&nbsp;
					<div class="ibox-tools">
						<a class="help-over-pannel" onclick="mint.ui.help(this, 'AP00000005','H002')"></a>
                   		<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
					</div>
					<div style="float: right; padding: 0px 20px 0px 0px;">
						<a class="btn btn-w-m btn-default btn-outline btn-clear"><i class="fa fa-check "></i> <lb class="lb-79"></lb></a>
						<a class="btn btn-w-m btn-default btn-outline btn-ifsearch"><i class="fa fa-search "></i> <lb class="lb-10"></lb></a>
					</div>
				</div>
				<!--ibox-content-->
             	<div class="ibox-content">
             		<!--row-->
               		<div class="row">

               			<!--col-sm-4 2-->
						<div class="col-sm-4">
                            <div class="form-group">
                            	<span class="lable_tag"><lb class="lb-841">배포</lb><a class="help-over-label" onclick="mint.ui.help(this, 'AP00000005','H003')"></a></span>
                               	<input id="cb-target" type="text" placeholder="Search..." style="width: 63%;">
                           	</div>
						</div>
						<!--col-sm-4 2end -->

						<!--col-sm-4 3-->
						<div class="col-sm-4">
							<div class="form-group">
								<div class="form-group">
									<span class="lable_tag"><lb class="lb-154"></lb></span>
									<input id="cb-integrationId" type="text" placeholder="Search..." style="width: 63%;">
									<input id="hd-interfaceId" type="hidden">
								</div>
							</div>
						</div>
						<!--col-sm-4 3end -->

						<!--col-sm-4 2-->
						<div class="col-sm-4">
							<!--form-group -->
							<div class="form-group">
								<span class="lable_tag"><lb class="lb-662"></lb></span>
								<span class="k-widget k-autocomplete k-header k-state-default input-width" style="width: 63%;">
									<input id="tf-version" type="text" style="width: 100%;" >
								</span>
							</div>
                            <!--form-group end-->
						</div>
						<!--col-sm-4 2end -->

                        <hr class="hr-space">

                   		<!--col-sm-4 2-->
						<div class="col-sm-4">
							<div class="form-group">
								<span class="lable_tag"><lb class="lb-576"></lb><a class="help-over-label" onclick="mint.ui.help(this, 'AP00000005','H005')"></a></span>
								<span id="sc-op0401003-period" >
									<input id="sc-op0401003-period-fromdate" value="2015/04/20" class="input-width"  style="text-align:center; width: 25.1%" />
									<span style="padding: 0px 5px;"> ~ </span>
									<input id="sc-op0401003-period-todate" value="2015/04/20" class="input-width"  style="text-align:center; width: 25.1%" />
								</span>
							</div>
						</div>
						<div class="col-sm-4">
						</div>

						<div class="col-sm-4">
							<div class="form-group">
							<!--
								<span class="lable_tag"><lb class="lb-88"></lb></span>
								<span style="padding: 0px 0px 0px 0px;">
					            	<div class="radio radio-inline" style="padding-left:20px; padding-top:5px;">
										<span class="radio-danger" style="padding-right: 20px;"><input id="radio0" type="radio" name="rd-search-range" value="N" checked="checked"><label for="radio0"><lb class="lb-89"></label></span>
		                                <span class="radio-info"   style="padding:0px 20px;"><input id="radio1" type="radio" name="rd-search-range" value="Y"><label for="radio1"><lb class="lb-90"></label></span>
                                	</div>
                                </span>
                            -->
							</div>
						</div>
                   	</div>
				 	<!--row end-->
                </div>
				<!--ibox-content end-->
           	</div>
			<!--ibox float-e-margins end-->
		</div>
		<!--col-lg-12 end-->
	</div>
	<!--row end-->


	<!--row start-->
	<div class="row">
		<!--col-lg-12-->
 		<div class="col-lg-12">
			<!--ibox float-e-margins-->
            <div class="ibox float-e-margins">
				<!--ibox-title-->
                <div class="ibox-title">
					<h5><lb class="lb-91"></h5>
                    <div class="ibox-tools">
                   		<a class="help-over-pannel" onclick="mint.ui.help(this, 'AP00000005','H001')"></a>
                   		<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
					</div>
               	</div>
				<!--ibox-title end-->
				<!--ibox-content-->
                <div class="ibox-content">
                	<div id="example">
       	     			<div id="grid"></div>
					</div>
               	</div>
				<!--ibox-content end-->
            </div>
			<!--ibox float-e-margins end-->
       	</div>
		<!--col-lg-12 end-->
	</div>
	<!--row end-->
</div>

<script>
	$(document).ready(function() {
		//=======================================================================
		//(1) function 및 variable scope 설정 :: (메인은 main, 팝업 및 서브는 sub)
		//=======================================================================
		screenName = "OP-04-01-003";
		$.extend({
			main : {
				//=======================================================================
				// (2) Screen 에서 사용할 variable 정의
				//=======================================================================
				searchNode : "",
				//=======================================================================
				// (3) Screen 에서 사용할 function 정의
				//=======================================================================

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화
				//-----------------------------------------------------------------------
				fn_init : function() {
					try {
						//mint.back(null);
						//mint.ui.initScreen();
						mint.init('$.main.fn_initCallback');

					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_init"});
					}
				},//end fn_init()

				//-----------------------------------------------------------------------
				// Description :: 화면 초기화 콜백
				//-----------------------------------------------------------------------
				fn_initCallback : function() {
					try {
						$.main.fn_initSearchNode();
						$.main.fn_setSearchComboBox();
						$.main.fn_setSearchResultGrid();
						$.main.fn_initSC_Period();

						mint.common.siteMenuPath(screenName);
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initCallback"});
					}
				},//end fn_initCallback()

				//-----------------------------------------------------------------------
	            // Description :: 날짜 초기화 함수
	            //-----------------------------------------------------------------------
	            fn_initSC_Period : function() {
					try {
						var pastDate = new Date();
						pastDate.setDate(pastDate.getDate() - 7);

						$("#sc-op0401003-period-fromdate").kendoDatePicker({
				            format : "yyyy/MM/dd",
				            culture: "ko-KR",
				            value : pastDate
				        });

						$("#sc-op0401003-period-todate").kendoDatePicker({
				            format : "yyyy/MM/dd",
				            culture: "ko-KR",
				            value : new Date()
				        });
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initSC_Period"});
					}
				}, // end fn_initSC_Period()
	            //-----------------------------------------------------------------------
	            // Description :: 검색 조건 초기화 함수
	            //-----------------------------------------------------------------------
	            fn_clearSearchArea : function() {
	                try {


	                    $('#cb-target').data("kendoDropDownList").value('');

	                  	//인터페이스 ID 초기화
	                    var combobox = $("#cb-integrationId").data("kendoComboBox");
	                    combobox.enable(true);
	                    combobox.value('');
	                    mint.ui.setComboBoxWithValue ('cb-integrationId', mint.common.commonCodeMap.get("interfaceCdList"), 0, 'integrationId', 'interfaceId', '');

	                    $("#tf-version").data("kendoNumericTextBox").value("");

	                    $.main.fn_initSearchNode();
	                } catch( e ) {
	                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_clearSearchArea"});
	                }
	            },

				//-----------------------------------------------------------------------
	            // Description :: searchNode 초기화 함수
	            //-----------------------------------------------------------------------
	            fn_initSearchNode : function() {
	                try {
	                    $.main.searchNode = new Object();

	                    $.main.searchNode.previous = null;
	                    $.main.searchNode.current = null;
	                    $.main.searchNode.previousType = null;
	                    $.main.searchNode.currentType = null;
	                } catch( e ) {
	                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_initSearchNode"});
	                }
	            },

	            //-----------------------------------------------------------------------
	            // Description :: searchNode 데이터 세팅
	            //-----------------------------------------------------------------------
	            fn_setSearchNode : function(currentId, type) {
	                try {
	                	if($.main.searchNode.current != currentId) {
	                        $.main.searchNode.previous = $.main.searchNode.current;
	                        $.main.searchNode.previousType = $.main.searchNode.currentType;

	                        $.main.searchNode.current = currentId;
	                        $.main.searchNode.currentType = type;

	                        if($.main.searchNode.previousType == 'combo') {
	                        	if($.main.searchNode.previous != null) {
	                                var combobox = $("#" + $.main.searchNode.previous).data("kendoComboBox");
	                                combobox.enable(false);
	                            }
	                        } else {
	                        	if( ! mint.common.isEmpty( $.main.searchNode ) && ! mint.common.isEmpty( $.main.searchNode.previous ) ) {
		                        	$("#" + $.main.searchNode.previous).prop("disabled", true);
		                        	$("#" + $.main.searchNode.previous).css("background-color", "#F9F8F8");
	                        	}
	                        }
	                    }
	                } catch( e ) {
	                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_setSearchNode"});
	                }
	            },


				//-----------------------------------------------------------------------
				// Description ::  검색 조건 - ComboBox 설정
				//-----------------------------------------------------------------------
				fn_setSearchComboBox : function() {
					try {
	                	mint.ui.setNumericWithoutMax('tf-version', 0, 1, 'n0'        );
	                	mint.ui.setDropDownList('cb-target', mint.common.commonCodeMap.get("cds").IM10   , -1, 'nm'       , 'cd'       );

						mint.ui.setComboBoxWithValue('cb-integrationId', mint.common.commonCodeMap.get("interfaceCdList"), 0, 'integrationId', 'interfaceId');
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_setSearchComboBox"});
					}
				},//end fn_setSearchComboBox()

				//-----------------------------------------------------------------------
				// Description ::  검색 결과 - Grid 설정
				//-----------------------------------------------------------------------
				fn_setSearchResultGrid : function() {
					try {
						var fixLeftGridWidth = ($('#grid')[0].clientWidth / 10) * 7;
						var fixLeftCoulmnWidth = fixLeftGridWidth / 4;

						//컬럼 레이블 아이디 세팅
						var labelCoulmn = $.main.fn_setGridColumnLabel();

						var grid = $("#grid").kendoGrid({
							dataSource : {
				 				  data: ""
				 				, pageSize : mint.ui.getPageSizesS({'currentPage' : true})
							}
							, filterable: true
						    , sortable : true
							, selectable: true
							, resizable: true
							, pageable : {
								  refresh 		: false
								, pageSizes		: mint.ui.getPageSizesS()
						    	, buttonCount 	: 5

							}
						    , columns : [
									{
										  title 	: labelCoulmn['#lbl-interfaceNm']
										, field 	: "interface.interfaceNm"
										, width 	: fixLeftCoulmnWidth / 1.25
										, template	: "<span title='${interface.interfaceNm}'>${interface.interfaceNm}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;'
							            }
										//, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-integrationId']
										, field 	: "interface.integrationId"
				 						, width 	: fixLeftCoulmnWidth / 1.5
				 						, template	: "<span title='${interface.integrationId}'>${interface.integrationId}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'white-space: nowrap;  text-align: center;'
							            }
										, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-version']
										, field 	: "version"
										, width 	: fixLeftCoulmnWidth / 2
										, template: "<span title='${version}'>${version}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            }
										, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-targetType']
										, field 	: "targetTypeNm"
										, width 	: fixLeftCoulmnWidth / 2
										, template: "<span title='${targetTypeNm}'>${targetTypeNm}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            }
										, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-requesterNm']
										, field 	: "requesterNm"
										, width 	: fixLeftCoulmnWidth / 2
										, template: "<span title='${requesterNm}'>${requesterNm}</span>"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            }
										, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-reqDate']
										, field 	: "reqDate"
										, width 	: fixLeftCoulmnWidth / 2
										, template: "#=kendo.toString(kendo.parseDate(reqDate, 'yyyyMMddHHmmss'), 'yyyy/MM/dd HH:mm:ss')#"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            }
										, filterable: { multi: true, search: true }
									}
									, {
										  title 	: labelCoulmn['#lbl-resDate']
										, field 	: "resDate"
										, width 	: fixLeftCoulmnWidth / 2
										, template: "#=kendo.toString(kendo.parseDate(resDate, 'yyyyMMddHHmmss'), 'yyyy/MM/dd HH:mm:ss')#"
										, headerAttributes: {
											 style: "text-align: center; vertical-align:middle;"
										}
										, attributes: {
								              style: 'text-align: center; white-space: nowrap;'
							            }
										, filterable: { multi: true, search: true }
									}
									,{
										  title 	: labelCoulmn['#lbl-resultMsg']
										, field 	: "resultMsg"
										, width 	: fixLeftCoulmnWidth / 2
										, template	: "<span title='${resultMsg}'>${resultMsg}</span>"
										, headerAttributes: {
											 style: "text-align:center; vertical-align:middle;"
										}
										, attributes: {
											 style: "text-align: center; white-space: nowrap;"
										}
										, filterable: { multi: true, search: true }
									}

							]
						    , dataBound: function (e) {
						    	if(0 == $("#grid").data().kendoGrid.dataSource.view().length) {
						    		var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

						    		$("#grid").children(".k-grid-content").height(gridHeight /3.5);
						    		$("#grid").children(".k-grid-content-locked").height(gridHeight / 3.5);
						    	} else {
						    		$("#grid").children(".k-grid-content").height('auto');
							    	$("#grid").children(".k-grid-content-locked").height('auto');
						    	}
						    }
						}).data("kendoGrid");

					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_setSearchResultGrid"});
					}
				},//end fn_setSearchResultGrid()

				//-----------------------------------------------------------------------
				// Description :: 검색 결과 - Grid 컬럼 Label 설정
				//-----------------------------------------------------------------------
				fn_setGridColumnLabel : function() {
					try {
						var returnObject = {
								 '#lbl-interfaceNm': mint.label.getLabel('lb-153')
								, '#lbl-integrationId': mint.label.getLabel('lb-154')
								, '#lbl-stat'			: mint.label.getLabel('lb-106')
								, '#lbl-reqDate'		: mint.label.getLabel('lb-576')
								, '#lbl-resDate'		: mint.label.getLabel('lb-577')
								, '#lbl-resultMsg'		: mint.label.getLabel('lb-532')
								, '#lbl-version'		: mint.label.getLabel('lb-662')
								, '#lbl-targetType'		: mint.label.getLabel('lb-841')
								, '#lbl-requesterNm'	: mint.label.getLabel('lb-844')
						};
						return returnObject;
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_setGridColumnLabel"});
					}
				},//end fn_setGridColumnLabel()


				//-----------------------------------------------------------------------
				// Description :: 조회 버튼 Click 이벤트
				//-----------------------------------------------------------------------
				fn_searchRequirementList : function() {
					try {
						var requirements = new Object();
				    	// 대상환경

				    	if(!$('#cb-target').data("kendoDropDownList").value() ==''){
				    		requirements.targetType =  $('#cb-target').data("kendoDropDownList").value();
				    	}

				    	//인터페이스 ID
				    	if(!$("#cb-integrationId").val() == ''){
						    requirements.interfaceId = $("#cb-integrationId").data("kendoComboBox").value();
				    	}

				    	if(!$('#tf-version').data("kendoNumericTextBox").value() == ''){
				    		requirements.version = $('#tf-version').data("kendoNumericTextBox").value();
				    	}

				     	requirements.fromDate =
									kendo.toString($("#sc-op0401003-period-fromdate").data("kendoDatePicker").value(), 'yyyyMMdd');
				    	requirements.toDate =
									kendo.toString($("#sc-op0401003-period-todate").data("kendoDatePicker").value(), 'yyyyMMdd');

				    	if(!(mint.session.getRoleId() == "UR00000001" || mint.session.isChannelAdmin() === 'Y') ) {
				    		requirements.reqUserId = mint.session.getUserId();
				    	}
//						if('Y' == $('input[name=rd-search-range]:checked').val()){
//						}
					    //데이터 조회
					    mint.callService(requirements, screenName, 'REST-R01-OP-04-01', '$.main.fn_setGridData', {errorCall : true});
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "fn_searchRequirementList"});
					}
				},//end fn_searchRequirementList()

				//-----------------------------------------------------------------------
				// Description :: 조회 버튼 Click 이벤트 - Grid Data 설정
				//-----------------------------------------------------------------------
				fn_setGridData : function(jsonData) {
					try {

						var dataSource = new kendo.data.DataSource({
							  data: jsonData
						    , page:1
						    , pageSize:mint.ui.getPageSizesS({'currentPage' : true})
						});

						//데이터 재설정
						$("#grid").data("kendoGrid").setDataSource(dataSource);
					} catch( e ) {
						mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_setGridData"});
					}
				},//end fn_setGridData()


			}// end main
		});// end extends

		//=======================================================================
		// (4) 이벤트 핸들러 정의
		//=======================================================================

		//-----------------------------------------------------------------------
		// Description :: 검색조건 초기화 클릭
		//-----------------------------------------------------------------------
		$('.btn-clear').on('click', function() {
        	$.main.fn_clearSearchArea();
    	});

		//-----------------------------------------------------------------------
		// Description :: 조회 버튼에 Click 이벤트 설정
		//-----------------------------------------------------------------------
		$(".btn-ifsearch").click(function () {
			$.main.fn_searchRequirementList();
        });

		//=======================================================================
		// (5) 기타 Function 정의
		//=======================================================================

		//=======================================================================
		// (6) 화면 로딩시 실행할 항목 기술
		//=======================================================================
		$.main.fn_init();
		mint.label.attachLabel(null);

	});


</script>

<style>

#grid .k-grid-header
{
   padding: 0 !important;
}

#grid .k-grid-content
{
   overflow-y: visible;
}

.k-grid tr {
    cursor : pointer;
}
</style>

