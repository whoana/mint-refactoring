<!--
	Screen ID : OP-03-02-002
	Screen NM : 오류/장애 대장 - 등록 및 상세.
-->
<div class="row wrapper border-bottom white-bg page-heading">
	<div class="col-lg-5">
	    <h2><span id="headerTitle"></span></h2>
	    <ol class="breadcrumb">
            <li><lb class="lb-490"></lb></li>
	        <li class="active"><strong><span id="headerLocation"></span></strong></li>
	    </ol>
	</div>
    <div class="col-lg-7">
        <div class="title-action" >
            <a href="#" class="btn btn-primary btn-approval" style="display:none"><i class="fa fa-pencil-square-o" ></i> <lb class="lb-32"></lb> <lb class="lb-496"></lb> </a>
            <a href="#" class="btn btn-white btn-modify"     style="display:none"><i class="fa fa-pencil"></i> <lb class="lb-342"></lb> </a>
            <a href="#" class="btn btn-white btn-save" 	     style="display:none"><i class="fa fa-save"></i> <lb class="lb-310"></lb> </a>
            <a href="#" class="btn btn-white btn-delete"     style="display:none"><i class="fa fa-trash-o" ></i> <lb class="lb-343"></lb> </a>
            <a href="#" class="btn btn-white btn-list"	     style="display:none"><i class="fa fa-reply "></i> <lb class="lb-311"></lb> </a>
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight" >
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                	<h5><lb class="lb-152"></lb></h5>
                    <div class="ibox-tools">
                    	<a class="help-over-pannel" onclick="mint.ui.help(this, 'AP00000022','H001')"></a>
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-4">
                            <span class="lable_tag"><lb class="lb-479"></lb> </span>
                            <input id="detail-endDate" class="input-width detail-endDate" tabIndex="7" style="text-align:center; width: 44%">
                            <input id="detail-endDateTime" class="input-width detail-endDateTime"  tabIndex="8" style="text-align:center; width: 18.5%;">
                        </div>
                        <div class="col-sm-4">
                            <span class="lable_tag"><lb class="lb-494"></lb></span>
                            <div style="padding: 3px 0px 0px 15px;">
                                <label style="padding-left:10px;"><input type="radio" name="type" value="0" checked="checked"> <lb class="lb-476"></lb> </label>
                                <label style="padding-left:10px;"><input type="radio" name="type" value="1"> <lb class="lb-467"></lb> </label>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <span class="lable_tag"><lb class="lb-495"></lb> <lb class="lb-473"></lb></span>
                            <input id="detail-status" class="detail-status required" type="text" placeholder="Search..."  tabIndex="4" style="width: 63%;">
                        </div>
                        <hr class="hr-space">
                        <div class="col-sm-8 template-div" style="display: none;">
                            <span class="lable_tag" style="width: 17%;"><lb class="lb-626">일괄조치</lb></span>
                            <input id="cb-template-channelId" type="text" placeholder="Category" style="width: 20%;">
                            <input id="cb-template-title" type="text" placeholder=""  tabIndex="4" style="width: 30.666%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">

                    <div id="tab-02" class="tab-pane active">
                    	<div class="panel-body">
	                        <ul class="category-list" style="padding: 0">
	                        	<li><i class="fa fa-circle text-primary" style="color: #1c84c6;"></i> <lb class="lb-499"></lb><lb class="lb-500"></lb></li>
	                        </ul>
	                        <textarea id="causeContents" class="" message="원인분석을 입력해 주시기 바랍니다." rows="2" cols="30" style="height:60px"></textarea>
                        </div>
                    </div>

                    <div id="tab-03" class="tab-pane active">

                        <div class="panel-body">
	                        <ul class="category-list" style="padding: 0">
	                        	<li><i class="fa fa-circle text-primary" style="color: #1c84c6;"></i> <lb class="lb-468"></lb></li>
	                        </ul>
                            <textarea id="resultContents" class="" message="조치결과를 입력해 주시기 바랍니다." rows="2" cols="30" style="height:60px"></textarea>
                        </div>
                    </div>

                    <div id="tab-04" class="tab-pane active">

                        <div class="panel-body">
	                        <ul class="category-list" style="padding: 0">
	                        	<li><i class="fa fa-circle text-primary" style="color: #1c84c6;"></i> <lb class="lb-501"></lb><lb class="lb-502"></lb></li>
	                        </ul>
                            <textarea id="planContents" class="" message="향후계획을 입력해 주시기 바랍니다." rows="2" cols="30" style="height:60px"></textarea>
                        </div>
                    </div>

                    <div id="tab-05" class="tab-pane active">
                        <div class="panel-body">
                            <ul class="category-list" style="padding: 0">
                                <li><i class="fa fa-circle text-primary" style="color: #1c84c6;"></i> <lb class="lb-219"></lb></li>
                            </ul>

		                    <!-- 첨부파일row -->
		                    <div class="row">
		                        <!-- col-sm-12 -->
		                        <div class="col-sm-12">
		                            <input name="file" id="file" type="file" />
		                        </div>
		                        <!-- col-sm-12 end -->
		                    </div>
            			</div>
                    </div>
                </div>
            </div>
        </div><!--  end col-lg-12 -->
    </div>
    <br>
    <div class="row interfaceInfo">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5><lb class="lb-32"></lb> <lb class="lb-348"></lb></h5>
                    <div class="ibox-tools">
                    	<button class="btn btn-success btn-inteface-add" style="display:none"><i class="fa fa-search "></i> <lb class="lb-395"></lb> <lb class="lb-370"></lb> </button>
                    	<button class="btn btn-danger btn-inteface-del" style="display:none"><i class="fa fa-trash-o "></i> <lb class="lb-395"></lb> <lb class="lb-343"></lb> </button>
                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </div>
                </div>
	            <div class="ibox-content" style="border-style: none none none;">
	                <div>
	                	<div id="problemInterfaceGrid" ></div>
	                </div>
	            </div>
            </div>
        </div>
    </div>
</div>

<!-- modal contents START -->
<div class="modal inmodal" id="modalProblemInterfacePopupForAddDel" tabindex="-1" role="dialog" aria-hidden="false">
	<div class="modal-dialog">
		<div class="modal-content animated fadeIn">
			<!--modal-header-->
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" style="padding: 15px;">
					<span aria-hidden="true">&times;</span> <span class="sr-only"><lb class="lb-298"></lb></span>
				</button>
				<div>
					<h2><span id="modal-header-title"><lb class="lb-32"></lb> <lb class="lb-395"></lb> <lb class="lb-365"></lb></span></h2>
				</div>
			</div>
			<!--modal-header END-->
			<!--modal-body-->
			<div class="modal-body">
				<div class="ibox-content">
					<!-- kendo table-->
					<div id="example">
						<div id="problemInterfacePopupGridForAddDel"></div>
					</div>
					<!--kendo table end-->
				</div>
			</div>
			<!--modal-body END-->
			<!--modal-footer-->
			<div class="modal-footer" style="clear: both">
				<button type="button" class="btn btn-primary select-interface-add"><lb class="lb-370"></lb></button>
				<button type="button" class="btn btn-primary select-interface-del"><lb class="lb-343"></lb></button>
				<button type="button" class="btn btn-white" data-dismiss="modal"><lb class="lb-298"></lb></button>
			</div>
			<!--modal-footer END-->
		</div>
	</div>
</div>
<!-- modal contents END -->

<script>
$(document).ready(function() {
    //=======================================================================
    //(1) function 및 variable scope 설정 :: (메인은 main, 팝업 및 서브는 sub)
    //=======================================================================
    screenName = "OP-03-02-002";

    $.extend({
        main_detail : {
            //=======================================================================
            // (2) Screen 에서 사용할 variable 정의
            //=======================================================================
            //업로드 관련 카운트
            fileUploadSucess : 0,
            fileUploadError : 0,
            fileUploadTotal : 0,
            kendoUploadButton : "",

            uploadAttatchFileList : [],
            orgAttachFileList : [],
            searchInterfaceId : "",

            //2015/10/02 추가 :: UI 표준 패턴에 맞추기 위해 전역변수에서 로컬변수로 변경
            updateCheck : false,
            problemId   : "",
            channelId   : "",
            isApproval  : false,

            // 미등록 오류/장애 인터페이스 리스트
            problemInterfaceList : [],
            problemInterfacePopupMode : "",

            //=======================================================================
            // (3) Screen 에서 사용할 function 정의
            //=======================================================================

            //-----------------------------------------------------------------------
            // Description :: 화면 초기화
            //-----------------------------------------------------------------------
            fn_init : function() {
                try {
                    mint.init('$.main_detail.fn_initCallback');
                } catch( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_init"});
                }
            },//end fn_init()

            //-----------------------------------------------------------------------
            // Description :: 화면 초기화 콜백
            //-----------------------------------------------------------------------
            fn_initCallback : function() {
                try{

                	//템플릿 콤보 초기화.
                	mint.ui.setComboBoxWithValue('cb-template-title', [], 0, 'PROBLEM_SUBJECT', 'TEMPLATE_ID', '');
                	mint.ui.setComboBoxWithValue('cb-template-channelId', mint.common.commonCodeMap.get("channelList"), 0, 'channelNm', 'channelId');


                	//화면에서 사용할 Parameter
                	{
                		$.main_detail.updateCheck = mint.common.getScreenParam("updateCheck");
                		$.main_detail.problemId   = mint.common.getScreenParam("problemId");
                		$.main_detail.channelId   = mint.common.getScreenParam("channelId");
                		$.main_detail.isApproval  = mint.common.getScreenParam("isApproval");
                	}

                    if( ! mint.common.isEmpty( $.main_detail.updateCheck ) && $.main_detail.updateCheck ) {
                    	$('#headerTitle').text( mint.label.getLabel('lb-353') );
                    	$('#headerLocation').text( mint.label.getLabel('lb-353') );
                    } else {
                    	$('#headerTitle').text( mint.label.getLabel('lb-421') );
                    	$('#headerLocation').text( mint.label.getLabel('lb-421') );
                    }

                    mint.ui.setDropDownList('detail-status', mint.common.commonCodeMap.get("cds").OP02, 0, 'nm', 'cd');

                    $("#detail-endDate").kendoDatePicker({
                        format : "yyyy/MM/dd",
                        culture: "ko-KR",
                        value: new Date()
                    });

                    $("#detail-endDateTime").kendoTimePicker({
                        interval : 1,
                        format: "HH:mm",
                        value:new Date()
                    });

                    $.main_detail.fn_setEditor('problemContents');
                    $.main_detail.fn_setEditor('causeContents');
                    $.main_detail.fn_setEditor('resultContents');
                    $.main_detail.fn_setEditor('planContents');

                    // 그리드 초기화
                    {
                    	// 오류/장애 인터페이스 목록 그리드 초기화
                        $.main_detail.fn_initProblemInterfaceGrid();

                        // 인터페이스 추가 팝업 그리드 초기화
                        $.main_detail.fn_initProblemInterfacePopupGrid();
                    }


                    if($.main_detail.updateCheck) {
                    	$.main_detail.fn_changeEnableStatus(true);
                    } else {
                    	$.main_detail.fn_changeEnableStatus(false);
                    }

					// 데이터 조회/초기화
                    $.main_detail.fn_getProblemInfo();

                } catch( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initCallback"});
                }
            },// end fn_initCallback

            //-----------------------------------------------------------------------
            // Description :: 그리드 템플릿 설정
            //-----------------------------------------------------------------------
            fn_initProblemInterfaceGrid : function() {
                try{
                    $("#problemInterfaceGrid").kendoGrid({
                        dataSource : {
	                        data : [],
	                        pageSize : mint.ui.getPageSizesS({'currentPage' : true})
                        },
                        sortable : true,
                        resizable: true,
                        selectable : "row",
                        pageable : {
                        	refresh : false,
                        	pageSizes : mint.ui.getPageSizesS(),
                        	buttonCount : 5
                        },
                        //selectable : "row",
                        columns : [
                                   	/* {
     									title : "<input type='checkbox' id='op0302002-list-checkbox-checkAll'>",
    									template : "<input type='checkbox' readonly='readonly' name='op0302002-list-checkbox' class='op0302002-list-checkbox' onclick='$.main_detail.fn_checkProblemInterfaceGridRow(this)' >",
    									width : "60px",
    									headerAttributes : {
    										style : "text-align: center; vertical-align:middle;"
    									},
    									attributes : {
    										style : "text-align: center; white-space: nowrap;"
    									}
    									, width : "5%"
    								}, */
    								/* {
    									field : "systemId",
    		                            hidden : true
    								},
    		                        {
    		                            //field : "nodeName",
    		                            field : "systemNm",
    		                            title : "시스템",
    		                            width : "150px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(systemNm)#'
    		                        },  */
    		                        {
    		                            field : "channelNm",
    		                            title : mint.label.getLabel('lb-80'),
    		                            width : "160px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center; white-space: nowrap;"
    		                            },
    		                        },
    		                        {
    		                            field : "integrationId",
    		                            title : mint.label.getLabel('lb-154'),
    		                            width : "160px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(integrationId)#'

    		                        },
    		                        {
    		                        	field : "interfaceId",
    		                        	hidden : true
    		                        },
    		                        {
    		                            field : "interfaceNm",
    		                            title : mint.label.getLabel('lb-153'),
    		                            width : "280px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: left"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(interfaceNm)#'

    		                        },
    		                        {
    		                        	field : "seq",
    		                        	hidden : true
    		                        },
    		                        {
    		                            field : "errorMsg",
    		                            title : mint.label.getLabel('lb-463') + " " + mint.label.getLabel('lb-462'),
    		                            //width : "40%",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: left; white-space: nowrap;"
    		                            },
    		                            template : '<span title="${errorMsg}">#=$.main.fn_replaceNull(errorMsg)#</span>'
    		                        },
    		                        {
    		                            field : "startDate",
    		                            title : mint.label.getLabel('lb-50'),
    		                            width : "200px",
    		                            template : '#=$.main.fn_changeTime(startDate)#',
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            }
    		                        },
    		                        /* {
    		                            field : "statusNm",
    		                            title : "상태",
    		                            width : "70px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            }
    		                        } */
    		                        /*
    		                        {
    		                            field : "crudpsType",
    		                            title : mint.label.getLabel('lb-527'),
    		                            width : "120px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            }
    		                        },
    		                        */
    		                        {
    		                        	field : "flag",
    		                        	hidden : true
    		                        }
                        ],
                        dataBound: function (e) {
							if(1 > $("#problemInterfaceGrid").data().kendoGrid.dataSource.view().length) {
								var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

								$("#problemInterfaceGrid").children(".k-grid-content").height(gridHeight /2.5);
								//$("#problemInterfaceGrid").children(".k-grid-content-locked").height(gridHeight / 2.5);
							} else {
								$("#problemInterfaceGrid").children(".k-grid-content").height('auto');
								//$("#problemInterfaceGrid").children(".k-grid-content-locked").height('auto');
							}
						}
                    });

                } catch ( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initProblemInterfaceGrid"});
                }
            },
            /*
            fn_checkProblemInterfaceGridRow : function(rowObj) {
            	try {
            		var row = $(rowObj).closest("tr");
            		var grid = $("#problemInterfaceGrid").data("kendoGrid");
            		var checkedDataItem = grid.dataItem(row);

            		//console.log("uid>>>" + checkedDataItem.uid);
            		//console.log("main-uid>>>" + checkedDataItem.rowKey);

            		if (rowObj.checked) {
				        //-select the row
				        row.addClass("k-state-selected");
				    } else {
				        //-remove selection
				        row.removeClass("k-state-selected");
				    }
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_checkProblemInterfaceGridRow"});
            	}
            },
             */
            fn_setProblemInterfaceGrid : function(jsonData) {
            	try {
					var gridData = $.main_detail.fn_getProblemInterfaceGridData_custom(jsonData);

            		var dataSource = new kendo.data.DataSource({
						  data: gridData
					    , page:1
					    , pageSize: mint.ui.getPageSizesS({'currentPage' : true})
					});

					//데이터 재설정
					$("#problemInterfaceGrid").data("kendoGrid").setDataSource(dataSource);
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setProblemInterfaceGrid"});
            	}
            },

            fn_getProblemInterfaceGridData_custom : function (jsonData) {
            	try {
            		var gridData = [];

					var selectedNoRegProblemData = {};
            		for (var i in jsonData) {

            			//if (jsonData[i].checked) {
            				selectedNoRegProblemData = {};

            				//selectedNoRegProblemData.systemId = jsonData[i].dataItem.systemId;
                			//selectedNoRegProblemData.systemNm = jsonData[i].dataItem.systemNm;
                			selectedNoRegProblemData.channelNm = jsonData[i].dataItem.channelNm;
                			selectedNoRegProblemData.interfaceId = jsonData[i].dataItem.interfaceId;
                			selectedNoRegProblemData.integrationId = jsonData[i].dataItem.integrationId;
                			selectedNoRegProblemData.interfaceNm = jsonData[i].dataItem.interfaceNm;
                			selectedNoRegProblemData.seq = jsonData[i].dataItem.seq;
                			selectedNoRegProblemData.startDate = jsonData[i].dataItem.startDate;
                			selectedNoRegProblemData.errorMsg = jsonData[i].dataItem.errorMsg;
                			selectedNoRegProblemData.statusNm = jsonData[i].dataItem.statusNm;
                			selectedNoRegProblemData.crudpsType = (jsonData[i].checked == true)?mint.label.getLabel('lb-370') : mint.label.getLabel('lb-343');


                			gridData.push(selectedNoRegProblemData);
            			//}

            		}

            		return gridData;
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getProblemInterfaceGridData_custom"});
            	}
            },

            fn_setEditor : function(id) {
            	$("#" + id).kendoEditor({
                    resizable: {
                          content: true
                        , toolbar: true
                        , min :40
                        , max :150
                    }
                });
            },

            fn_returnProblemPopupData : function(problemNm, problemCd) {
                try {
                    //console.log("problemNm : " + problemNm + ", problemCd : " + problemCd);

                    $(".detail-problemType").val(problemNm);
                    $(".detail-classCd").val(mint.common.replaceNull(problemCd));
                } catch(e) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_returnProblemPopupData"});
                }
            },
            /*
            fn_returnSystemPopupData : function(obj) {
            	if(obj == null) {
            		$(".systemNm").val("");
                    $(".systemCd").val("");
            	} else {
            		$(".systemNm").val(obj.systemNm);
                    $(".systemCd").val(obj.systemCd);
            	}
            },
             */
            //-----------------------------------------------------------------------
            // Description :: problem 기본 정보를 가져온다.
            //-----------------------------------------------------------------------
            fn_getProblemInfo : function() {
            	if($.main_detail.updateCheck) {
            		mint.callService($.main_detail.fn_getRequestObject(), screenName, 'REST-R13-OP-03-02', '$.main_detail.fn_setDetailInfo', {errorCall : true });
            	} else {
            		$('.btn-save').show();
            		$('.btn-list').show();

            		//$('.btn-inteface-add').show();
            		//$('.btn-inteface-del').show();
            		$.main_detail.fn_fileUpload();


                 	// 오류/장애 인터페이스 목록 초기 설정
                 	/* $.main_detail.problemInterfaceList = [];
                    for (var i in $.main.noRegProblemList) {
                    	$.main_detail.problemInterfaceList[i] = $.main.noRegProblemList[i];
                    } */
                    var problemInterfaceList_result = [];
                    {
                    	/*
                    	var result = [];
    					for(var x in $.main_detail.problemInterfaceList) {
    						if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
    							result.push($.main_detail.problemInterfaceList[x]);
    						}
    					}
    					//console.log(result);
    					*/
    					var result = [];
    					for(var x in $.main.noRegProblemList) {
    						if (Object.prototype.hasOwnProperty.call($.main.noRegProblemList, x)) {
    							result.push($.main.noRegProblemList[x]);
    						}
    					}
    					//console.log(result);
    					for (var i in result) {
    						if (result[i].checked == true) {
    							$.main_detail.problemInterfaceList[result[i].dataItem.interfaceId + "-" + result[i].dataItem.seq + "-" + result[i].dataItem.startDate] = {
        	 	 						checked : true,
        	 	 						dataItem : {
        	 	 							channelNm : result[i].dataItem.channelNm,
        	 	 							interfaceId : result[i].dataItem.interfaceId,
        	 	 							integrationId : result[i].dataItem.integrationId,
        		 	       					interfaceNm : result[i].dataItem.interfaceNm,
        		 	       					seq : result[i].dataItem.seq,
        		 	       					startDate : result[i].dataItem.startDate,
        		 	       					errorMsg : result[i].dataItem.errorMsg,
        		 	       					statusNm : result[i].dataItem.statusNm,
        		 	       					flag : 'C'
        	 	 						}
        	 	 				};
    						}
    					}


    					for(var x in $.main_detail.problemInterfaceList) {
    						if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
    							problemInterfaceList_result.push($.main_detail.problemInterfaceList[x]);
    						}
    					}

    					// 오류/장애 인터페이스 목록 그리드 Data 설정
                        $.main_detail.fn_setProblemInterfaceGrid(problemInterfaceList_result);
                    }


                    // 에러 메시지 설정
                    {
                    	//console.log(problemInterfaceList_result);
                    	if(mint.common.replaceNull(problemInterfaceList_result[0].dataItem.errorMsg) != "") {
                    		$("#divErrorMsg").show();
                    		$("#errorMsg").val(mint.common.replaceNull(problemInterfaceList_result[0].dataItem.errorMsg));
                    	}
                    }
            	}
            },


            //-----------------------------------------------------------------------
            // Description :: problem 기본정보를 세팅하기 위한 requestObject를 생성한다.
            //-----------------------------------------------------------------------
            fn_getRequestObject : function() {
                try{
                    var searchObject = new Object();

                    searchObject.problemId = $.main_detail.problemId;

                    return searchObject;
                } catch( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getRequestObject"});
                }
            },


            //-----------------------------------------------------------------------
            // Description :: problem 기본정보를 세팅한다.
            //-----------------------------------------------------------------------
            fn_setDetailInfo : function(data) {

            	//console.log(data);

            	tempProblemPopupData = data;

                $.main_detail.fn_setProblemInfo(data);
                $.main_detail.fn_changeEnableStatus(true);

                if(data.problemAttachFile != null) {
                	//첨부파일을 카피한다.
                	$.main_detail.fn_setAttachFile(data.problemAttachFile);
                	$('#file').data("kendoUpload").disable();
                }

                /*
                if(data.interface != null) {
                	//인터페이스 정보가 있다면 인터페이스 정보를 세팅한다.
                	//$(".interfaceInfo").show();

                	//tempInterfacePopupData = data.interface;
                	//$.main_detail.fn_setInterfaceInfo(data.interface);
                } else {
                	//$(".interfaceInfo").hide();
                }
                */

                if (data.problemInterface != null) {

                	//인터페이스 정보가 있다면 인터페이스 정보를 세팅한다.
                	tempInterfacePopupData = data.interface;
                	tempInterfaceCntPopupTitle = (data.interfaceCnt > 1) ? " (" + mint.label.getLabel('lb-503') + " " + (data.interfaceCnt - 1) + " " + mint.label.getLabel('lb-64') + ")" : "";

                	$.main_detail.problemInterfaceList = [];
                	var result = data.problemInterface;
                	//console.log(result);
					for (var i in result) {
						$.main_detail.problemInterfaceList[result[i].interfaceId + "-" + result[i].seq + "-" + result[i].startDate] = {
   	 	 						checked : true,
   	 	 						dataItem : {
   	 	 							channelNm : result[i].channelNm,
   	 	 							interfaceId : result[i].interfaceId,
   	 	 							integrationId : result[i].integrationId,
   		 	       					interfaceNm : result[i].interfaceNm,
   		 	       					seq : result[i].seq,
   		 	       					startDate : result[i].startDate,
   		 	       					errorMsg : result[i].errorMsg,
   		 	       					statusNm : result[i].statusNm,
   		 	       					flag : ''
   	 	 						}
   	 	 				};
					}


					var problemInterfaceList_result = [];
					for(var x in $.main_detail.problemInterfaceList) {
						if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
							problemInterfaceList_result.push($.main_detail.problemInterfaceList[x]);
						}
					}

					// 오류/장애 인터페이스 목록 그리드 Data 설정
                    $.main_detail.fn_setProblemInterfaceGrid(problemInterfaceList_result);
                }
            },


            //-----------------------------------------------------------------------
            // Description :: 첨부파일을 카피한다.
            //-----------------------------------------------------------------------
            fn_setAttachFile : function(problemAttachFile) {

            	var tempArray = [];

                if(0 < problemAttachFile.length) {
                    for(var i=0; i<problemAttachFile.length; i++) {
                        var fileObject = new Object;

                        fileObject.objectType = 'ProblemAttachFile';
                        fileObject.problemId = '';
                        fileObject.fileId = problemAttachFile[i].fileId;
                        fileObject.fileNm = problemAttachFile[i].fileNm;
                        fileObject.filePath = problemAttachFile[i].filePath;
                        fileObject.name = problemAttachFile[i].fileNm;
                        fileObject.flag = '';

                        //첨부파일 카피
                        $.main_detail.orgAttachFileList.push(fileObject);
                        tempArray.push(fileObject);
                    }
                }

                //첨부파일을 세팅한다.
                $.main_detail.fn_fileUpload(tempArray);
            },


            //-----------------------------------------------------------------------
            // Description :: 오류/장애  정보를 세팅한다.
            //-----------------------------------------------------------------------
            fn_setProblemInfo : function(problemInfo) {
            	//오류/장애 구분
            	if(problemInfo.type != null) {
            		$("input[name='type']:radio[value='" + problemInfo.type + "']").attr('checked',true);
            	}

            	//처리상태
            	if(problemInfo.status != null) {
            		$('#detail-status').data('kendoDropDownList').value(problemInfo.status);
            	}

            	//조치일자
            	if(problemInfo.endDate != null) {
                    $("#detail-endDate").data('kendoDatePicker').value($.main_detail.fn_getDate(problemInfo.endDate));
                    $("#detail-endDateTime").data('kendoTimePicker').value($.main_detail.fn_getDateTime(problemInfo.endDate));
                }

            	//원인분석
            	$("#causeContents").data('kendoEditor').value(mint.common.replaceNull(problemInfo.causeContents));

            	//조치결과
            	$("#resultContents").data('kendoEditor').value(mint.common.replaceNull(problemInfo.resultContents));

            	//향후계획
            	$("#planContents").data('kendoEditor').value(mint.common.replaceNull(problemInfo.planContents));

            	mint.common.debugLog("updatecheck : " + $.main_detail.updateCheck + ", isApproval : " + $.main_detail.isApproval + ", channelId : " + $.main_detail.channelId + ", problemId : " + $.main_detail.problemId);

            	//심의요청 버튼 생성
            	if($.main_detail.updateCheck) {

            		if($.main_detail.isApproval === true && $("#detail-status").val() == '2' && $("#detail-endDate").val() != "" && $("#detail-endDateTime").val() != "") {

            			if( mint.common.isEmpty(problemInfo.approvalStatus) || 2 == problemInfo.approvalStatus) {
            				$(".btn-approval").show();
            				$(".btn-modify").show();
            				$(".btn-delete").show();
            				$(".btn-list").show();
            			} else if( 0 == problemInfo.approvalStatus ) {
                			$('.btn-list').show();
                		} else {
                			$('.btn-list').show();
                		}
            		} else if( mint.common.isEmpty(problemInfo.approvalStatus) || 2 == problemInfo.approvalStatus) {
            			$(".btn-modify").show();
        				$(".btn-delete").show();
            			$('.btn-list').show();
            		} else {
            			$('.btn-list').show();
            		}
            	}

            	$.main_detail.searchInterfaceId = problemInfo.problemInterface[0].integrationId;

            	if(mint.common.replaceNull(problemInfo.problemInterface[0].errorMsg) != "") {
            		$("#divErrorMsg").show();
            		$("#errorMsg").val(mint.common.replaceNull(problemInfo.problemInterface[0].errorMsg));
            	}

            },

            //-----------------------------------------------------------------------
            // Description :: 필드 disable 상태 변경
            //-----------------------------------------------------------------------
            fn_changeEnableStatus : function(status) {

            	var disabledColor = '#F9F8F8';

            	//오류/장애 구분
            	$('input:radio[name=type]').prop("disabled", status);

            	//처리상태
            	$('#detail-status').data("kendoDropDownList").enable(!status);

            	//조치일자
            	$('#detail-endDate').data("kendoDatePicker").enable(!status);
            	$('#detail-endDateTime').data("kendoTimePicker").enable(!status);

            	//오류/장애 개요
				$('#errorMsg').prop('readonly', true);
 	    		$('#errorMsg').prop('disabled', true);
				if(status) {
     	    		$('#errorMsg').css('background-color', disabledColor);
            	} else {
    	    		$('#errorMsg').css('background-color', '');
            	}

				//장애내용 템플릿 콤보.
				if( !status ) {
					$('.template-div').show();
				} else {
					$('.template-div').hide();
				}
				$('#cb-template-channelId').data('kendoComboBox').enable(!status);
				$('#cb-template-title').data('kendoComboBox').enable(!status);

            	//원인분석
            	$($('#causeContents').data().kendoEditor.body).prop('contenteditable', !status);

            	//조치결과
            	$($('#resultContents').data().kendoEditor.body).prop('contenteditable', !status);

            	//향후계획
            	$($('#planContents').data().kendoEditor.body).prop('contenteditable', !status);
            },

            //-----------------------------------------------------------------------
            // Description :: 날짜 표시
            //-----------------------------------------------------------------------
            fn_getDate : function(dateVal) {
            	var returnVal = dateVal.substring(0, 4) + "/" + dateVal.substring(4, 6) + "/" + dateVal.substring(6, 8);

            	return returnVal;
            },

            //-----------------------------------------------------------------------
            // Description :: 시간 표시
            //-----------------------------------------------------------------------
            fn_getDateTime : function(dateVal) {
            	var returnVal = dateVal.substring(8, 10) + ":" + dateVal.substring(10, 12);

            	return returnVal;
            },
            /*
            //-----------------------------------------------------------------------
            // Description :: 인터페이스 정보를 세팅한다.
            //-----------------------------------------------------------------------
            fn_setInterfaceInfo : function(interfaceInfo) {

            	mint.common.debugLog("aaaaa : " , interfaceInfo);

            	//기본정보
            	if(interfaceInfo.channel != null) {
            		$(".channelNm").val(mint.common.replaceNull(interfaceInfo.channel.channelNm));
            	}

            	$(".dataPrDirNm").val(mint.common.replaceNull(interfaceInfo.dataPrDirNm));
            	$(".interfaceNm").val(mint.common.replaceNull(interfaceInfo.interfaceNm));
            	$(".appPrMethodNm").val(mint.common.replaceNull(interfaceInfo.appPrMethodNm));
            	$(".interfaceId").val(mint.common.replaceNull(interfaceInfo.interfaceId));
            	$(".dataPrMethodNm").val(mint.common.replaceNull(interfaceInfo.dataPrMethodNm));


            	//연계 시스템
            	if(interfaceInfo.senderSystemInfoList != null) {
            		$.main_detail.fn_setSystemGrid('sendSystem', interfaceInfo.senderSystemInfoList, 'Consumer');
            	} else {
            		$.main_detail.fn_setSystemGrid('sendSystem', [], 'Consumer');
            	}

            	if(interfaceInfo.receiverSystemInfoList != null) {
                    $.main_detail.fn_setSystemGrid('recvSystem', interfaceInfo.receiverSystemInfoList, 'Provider');
                } else {
                	$.main_detail.fn_setSystemGrid('recvSystem', [], 'Provider');
                }

            	//담당자
            	if(interfaceInfo.relUsers != null) {
            		$.main_detail.fn_setAdminInfo(interfaceInfo.relUsers);
            	}
            },
             */
            /* //-----------------------------------------------------------------------
            // Description :: 담당자 정보를 세팅한다.
            //-----------------------------------------------------------------------
            fn_setAdminInfo : function(data) {
            	$("#adminInfo").kendoGrid({
                    dataSource : {
	                    data : data,
	                    schema : {
	                        model : {
	                        	fields : {
		                            roleTypeNm : {type : "string"},
		                            userNm : {type : "string"},
		                            cellPhone : {type : "string"},
		                            phone : {type : "string"},
		                            email : {type : "string"},
                                }
                            }
                        }
                    },
                    sortable : true,
                    scrollable : true,
                    columns : [
                        { field : "roleTypeNm", title : "역할", headerAttributes : {style : "text-align: center"}, attributes : {style : "text-align: center"} }
                        ,{ field : "user.userNm", title : "이름", headerAttributes : {style : "text-align: center"}, attributes : {style : "text-align: center"} }
                        ,{ field : "user.cellPhone", title : "핸드폰", headerAttributes : {style : "text-align: center"}, attributes : {style : "text-align: center"} }
                        ,{ field : "user.phone", title : "전화", headerAttributes : {style : "text-align: center"}, attributes : {style : "text-align: center"} }
                        ,{ field : "user.email", title : "이메일", headerAttributes : {style : "text-align: center"}, attributes : {style : "text-align: center"} }
                    ]

                    });
            }, */
            /*
            //-----------------------------------------------------------------------
            // Description :: 연계정보 Grid 세팅
            //-----------------------------------------------------------------------
            fn_setSystemGrid : function(id, data, title) {
            	$("#" + id).height(300).kendoGrid({
                    dataSource : {
	                    data : data,
	                    schema : {
	                        model : {
	                        	fields : {
	                        	    problemTypeNm : {type : "string"},
	                        	    nodeName : {type : "string"},
	                        	    interfaceNm : {type : "string"},
	                        	    startDate : {type : "string"},
	                        	    endDate : {type : "string"},
	                        	    problemId : {type : "string"},
                                }
                            }
                        },
                        pageSize : mint.ui.getPageSizesS({'currentPage' : true})
                    },
                    sortable : true,
                    scrollable : true,
                    columns : [{
                    	title : title,
                    	headerAttributes : {
                            style : "text-align: center"
                        },
                    	columns : [ {
                            field : "systemNm",
                            title : "시스템명",
                            headerAttributes : {
                                style : "text-align: center"
                            },
                            attributes : {
                                style : "text-align: center"
                            },
                        }
                        ,{
                            field : "resourceNm",
                            title : "리소스",
                            headerAttributes : {
                                style : "text-align: center"
                            },
                            attributes : {
                                style : "text-align: center"
                            },
                        }
                        ,{
                            field : "service",
                            title : "서비스 명",
                            headerAttributes : {
                                style : "text-align: center"
                            },
                            attributes : {
                                style : "text-align: center"
                            },
                        }
                        ]
                    }]

                    });
            },
             */
            //-----------------------------------------------------------------------
            // Description :: 오류/장애  정보를 저장한다.
            //-----------------------------------------------------------------------
            fn_saveProblem : function() {
            	var restUrl = "";

                if($.main_detail.fn_checkParam()) {
                	//첨부파일 있으면 업로드
                	if(0 < $('#file').parent().children('input[type=file]:not(#file)').length) {
                		mint.common.debugLog("첨부파일 존재!!!!");

                        setTimeout(function() {
                            $.main_detail.kendoUploadButton = $(".k-upload-selected");
                            $.main_detail.kendoUploadButton.hide();
                        }, 10);

                        $.main_detail.kendoUploadButton.click();

                    //첨부파일 없으면 바로 등록
                    } else {

                    	if($.main_detail.updateCheck) {
                            //update
                            restUrl = "REST-U11-OP-03-02";
                            mint.callService($.main_detail.fn_setParam(), screenName, restUrl, '$.main_detail.fn_saveComplete', {errorCall : true, params : {problemId : $.main_detail.problemId} });
                        } else {
                            //insert
                            restUrl = "REST-C11-OP-03-02";
                            mint.callService($.main_detail.fn_setParam(), screenName, restUrl, '$.main_detail.fn_saveComplete', {errorCall : true });
                        }
                    }
                }
            },


            //-----------------------------------------------------------------------
            // Description :: 파라미터 세팅
            //-----------------------------------------------------------------------
            fn_setParam : function() {
            	var d = new Date();
            	var problem = new Object();

            	problem.objectType = "ProblemLedger";
            	problem.startDate  = mint.common.getStartTime();
            	problem.type       = $("[name=type]:checked").val();
            	problem.status     = $('#detail-status').val();

            	if($('#detail-status').val() == "2"){
                	if($("#detail-endDate").val() == "") {
                	    problem.endDate = mint.common.getStartTime();
                	} else {
                	    problem.endDate = mint.common.replaceAll($("#detail-endDate").val(), "/", "") + mint.common.replaceAll($("#detail-endDateTime").val(), ":", "") + "00000";;
                	}
            	} else {
            		problem.endDate = "";
            	}

            	if( !mint.common.isEmpty( $('#cb-template-title').val() ) ) {
            		problem.problemSubject = $('#cb-template-title').val();
            	} else {
            		problem.problemSubject = ' ';
            	}

            	problem.classCd = '';
            	problem.importance = ' ';
            	problem.nodeName = ' ';


            	problem.causeContents   = $("#causeContents").data("kendoEditor").value();
            	problem.resultContents  = $("#resultContents").data("kendoEditor").value();
            	problem.planContents    = $("#planContents").data("kendoEditor").value();
            	problem.problemContents = ' ';



            	// 첨부파일
            	var tempArray = [];
            	for(var i= 0; i < $.main_detail.orgAttachFileList.length; i++) {
                    var fileObject = new Object();

                    fileObject.objectType = 'ProblemAttachFile';
                    fileObject.problemId = $.main_detail.orgAttachFileList[i].problemId;
                    fileObject.fileId = $.main_detail.orgAttachFileList[i].fileId;
                    fileObject.fileNm = $.main_detail.orgAttachFileList[i].fileNm;
                    fileObject.filePath = $.main_detail.orgAttachFileList[i].filePath;
                    fileObject.flag = $.main_detail.orgAttachFileList[i].flag;

                    tempArray.push(fileObject);
                }

            	problem.problemAttachFile = tempArray;


            	/*
            	if($.main_detail.searchInterface != "") {
            		problem.interfaceId = $.main_detail.searchInterfaceId;
            	}
            	*/
            	// 오류/장애 인터페이스 목록 설정
            	var selectedNoRegProblemList = [];
				{
					var result = [];
	 				for(var x in $.main_detail.problemInterfaceList) {
	 					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
	 						result.push($.main_detail.problemInterfaceList[x]);
	 					}
	 				}

	 				var idx = 0;
	 				for (var i in result) {
	 					if (result[i].checked == true) {
	 						selectedNoRegProblemList[idx++] = {
	 								interfaceId : result[i].dataItem.interfaceId,
	 								integrationId : result[i].dataItem.integrationId,
	 								interfaceNm : result[i].dataItem.interfaceNm,
	 								seq : result[i].dataItem.seq,
	 								startDate : result[i].dataItem.startDate,
	 								statusNm : result[i].dataItem.statusNm,
	 								flag : result[i].dataItem.flag
	 						};
	 					}
	 					else {
	 						if (result[i].dataItem.flag == "") {
		 						selectedNoRegProblemList[idx++] = {
		 								interfaceId : result[i].dataItem.interfaceId,
		 								integrationId : result[i].dataItem.integrationId,
		 								interfaceNm : result[i].dataItem.interfaceNm,
		 								seq : result[i].dataItem.seq,
		 								startDate : result[i].dataItem.startDate,
		 								statusNm : result[i].dataItem.statusNm,
		 								flag : "D"
		 						};
		 					}
	 					}

	 				}
				}
            	problem.problemInterface = selectedNoRegProblemList;

            	/* console.log("====================================================");
            	console.log("problemSubject : " + problem.problemSubject);
            	console.log("type : " + problem.type);
            	console.log("level1 : " + problem.level1);
            	console.log("level2 : " + problem.level2);
            	console.log("classCd : " + problem.classCd);
            	console.log("status : " + problem.status);
            	console.log("importance : " + problem.importance);
            	console.log("startDate : " + problem.startDate);
            	console.log("endDate : " + problem.endDate);
            	console.log("problemContents : " + problem.problemContents);
            	console.log("causeContents : " + problem.causeContents);
            	console.log("resultContents : " + problem.resultContents);
            	console.log("planContents : " + problem.planContents);
            	console.log("===================================================="); */
            	//console.log(problem);
            	return problem;
            },

            //-----------------------------------------------------------------------
            // Description :: 파라미터 체크
            //-----------------------------------------------------------------------
            fn_checkParam : function() {


				if( mint.common.isFieldEmpty( $("#detail-status"), true, mint.label.getLabel('lb-495') + mint.label.getLabel('lb-473'), $("#detail-status") ) ) {
					return false;
				}


            	if($("#detail-status").val() == "2") {
            		if($("#detail-endDate").val() == "" || $("#detail-endDateTime").val() == "") {
            			mint.common.alert('BW00026', null);
            			return false;
            		}
            	}

            	// 오류/장애 인터페이스 목록 체크
				var tmpNoRegProblemList = [];
				{
					var result = [];
	 				for(var x in $.main_detail.problemInterfaceList) {
	 					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
	 						result.push($.main_detail.problemInterfaceList[x]);
	 					}
	 				}

	 				for (var i in result) {
	 					if (result[i].checked == true) {
	 						tmpNoRegProblemList.push(result[i].dataItem);
	 					}
	 				}
				}
				//console.log(tmpNoRegProblemList);
				if (tmpNoRegProblemList.length <= 0) {
					mint.common.alert('BW00027', null);
					return false;
				}

            	return true;
            },


            //-----------------------------------------------------------------------
            // Description :: 저장이 완료되면 목록으로 보낸다.
            //-----------------------------------------------------------------------
            fn_saveComplete : function() {
            	if($.main_detail.updateCheck) {
            		mint.common.alert('CI00102', null);
            	} else {
            		mint.common.alert('CI00105', null);
            	}

            	$.main_detail.fn_moveList();
            },


            //-----------------------------------------------------------------------
            // Description :: 목록으로 이동
            //-----------------------------------------------------------------------
            fn_moveList : function() {
            	mint.back(null);
            	//mint.move('../sub-op/OP-03-02-001');
            	//$.main.fn_getData();
            	var fn_callback = mint.common.fn_callback('$.main.fn_getData');
            	if( fn_callback ) {
            		fn_callback();
            	}
            },


            //-----------------------------------------------------------------------
            // Description :: 오류/장애 를 삭제한다.
            //-----------------------------------------------------------------------
            fn_deleteProblem : function() {
            	//mint.callService($.main_detail.fn_setParam(), screenName, 'REST-D01-OP-03-02', '$.main_detail.fn_deleteComplete', {errorCall : true, params : {problemId : $.main_detail.problemId} });
            	mint.callService($.main_detail.fn_setParam(), screenName, 'REST-D11-OP-03-02', '$.main_detail.fn_deleteComplete', {errorCall : true, params : {problemId : $.main_detail.problemId} });
            },


            //-----------------------------------------------------------------------
            // Description :: 삭제가 완료되면 목록으로 보낸다.
            //-----------------------------------------------------------------------
            fn_deleteComplete : function() {
            	mint.common.alert('CI00103', null);
            	$.main_detail.fn_moveList();
            },

            //-----------------------------------------------------------------------
            // Description :: 첨부파일 세팅
            //-----------------------------------------------------------------------
            fn_fileUpload : function(fileList) {
            	if("undefined"  == typeof fileList) {
                    fileList = [];
                }
                //첨부파일 - 데이터 세팅
                // kendo upload Drop 영역 비활성
                kendo.ui.Upload.fn._supportsDrop = function() { return false; }

            	$("#file").kendoUpload({
                    files: fileList,
                    remove: $.main_detail.fn_onRemove,
                    async: {
                        saveUrl: mint.baseServiceUrl + "/ut/upload",
                        removeUrl: "remove",
                        autoUpload: false
                    },
                    //multiple: false,
                    localization: {
                        select: mint.label.getLabel('lb-220')
                    },
                    error: function(e) {

                        mint.common.debugLog("Kendo Upload Error Event!!");
                        mint.common.debugLog(e);

                        if("remove" != e.operation) {
                        	$.main_detail.fileUploadError++;
                        }

                        if(0 < $.main_detail.fileUploadTotal && $.main_detail.fileUploadTotal == ($.main_detail.fileUploadError + $.main_detail.fileUploadSucess)) {
							/*
                        	alert('총 카운트 = ' + $.main_detail.fileUploadTotal +
                                      '\n성공 카운트 = ' + $.main_detail.fileUploadSucess +
                                      '\n에러 카운트 = ' + $.main_detail.fileUploadError
                            );
                        	*/
                            $(".k-upload-files.k-reset").find("li").remove();

                            $.main_detail.uploadAttatchFileList =[];
                            $.main_detail.fileUploadTotal = 0;
                            $.main_detail.fileUploadSucess = 0;
                            $.main_detail.fileUploadError = 0;

                            $.main_detail.kendoUploadButton = "";
                        }

                    },
                    success: function(e) {

                    	mint.common.debugLog("Kendo Upload Success Event!!");
                    	mint.common.debugLog(e);

                        var serverResponse = JSON.parse(e.XMLHttpRequest.response);

                        if("undefined"  == typeof serverResponse.errMessage) {
                        	$.main_detail.fileUploadSucess++;

                            var tempObj = new Object();
                            tempObj.fileNm = serverResponse.getOriginalFilename;
                            tempObj.filePath = serverResponse.serverPath;

                            $.main_detail.uploadAttatchFileList.push(tempObj);
                        } else {
                        	$.main_detail.fileUploadError++;
                        }

                        if($.main_detail.fileUploadTotal == $.main_detail.fileUploadSucess) {
//                          alert('총 카운트 = ' + fileUploadTotal +
//                                    '\n성공 카운트 = ' + fileUploadSucess +
//                                    '\n에러 카운트 = ' + fileUploadError
//                          );

                            $.main_detail.fileUploadTotal = 0;
                            $.main_detail.fileUploadSucess = 0;
                            $.main_detail.fileUploadError = 0;

                            //데이터 등록

                            var requestObject = $.main_detail.fn_setParam();

                            var attatchFileList = [];

                            for(var i=0; i<$.main_detail.uploadAttatchFileList.length; i++) {
                                var tempAttatchObj = new Object();
                                tempAttatchObj.objectType = 'ProblemAttachFile';
                                tempAttatchObj.problemId = '';
                                tempAttatchObj.fileId = '';
                                tempAttatchObj.fileNm = $.main_detail.uploadAttatchFileList[i].fileNm;
                                tempAttatchObj.filePath = $.main_detail.uploadAttatchFileList[i].filePath;
                                tempAttatchObj.flag = 'C';

                                if($.main_detail.orgAttachFileList.length <= 0) {
                                    attatchFileList.push(tempAttatchObj);
                                } else {
                                	$.main_detail.orgAttachFileList.push(tempAttatchObj);
                                }
                            }

                            var tempArray = [];

                            if($.main_detail.orgAttachFileList.length <= 0) {
                            	mint.common.debugLog("attach file attatchFileList : " + attatchFileList);

                            	for(var i= 0; i < attatchFileList.length; i++) {
                            		var fileObject = new Object();

                            		fileObject.objectType = 'ProblemAttachFile';
                            		fileObject.problemId = attatchFileList[i].problemId;
                            		fileObject.fileId = attatchFileList[i].fileId;
                            		fileObject.fileNm = attatchFileList[i].fileNm;
                            		fileObject.filePath = attatchFileList[i].filePath;
                            		fileObject.flag = attatchFileList[i].flag;

                            		tempArray.push(fileObject);
                            	}

                                requestObject.problemAttachFile = tempArray;
                            } else {
                            	mint.common.debugLog("attach file orgAttachFileList : " + $.main_detail.orgAttachFileList);


                            	for(var i= 0; i < $.main_detail.orgAttachFileList.length; i++) {
                                    var fileObject = new Object();

                                    fileObject.objectType = 'ProblemAttachFile';
                                    fileObject.problemId = $.main_detail.orgAttachFileList[i].problemId;
                                    fileObject.fileId = $.main_detail.orgAttachFileList[i].fileId;
                                    fileObject.fileNm = $.main_detail.orgAttachFileList[i].fileNm;
                                    fileObject.filePath = $.main_detail.orgAttachFileList[i].filePath;
                                    fileObject.flag = $.main_detail.orgAttachFileList[i].flag;

                                    tempArray.push(fileObject);
                                }

                            	requestObject.problemAttachFile = tempArray;
                            }


                            //debugger;
                            var restUrl = "";

                            if($.main_detail.updateCheck) {
		                        //update
		                        restUrl = "REST-U11-OP-03-02";
		                        //console.log(requestObject);
		                        mint.callService(requestObject, screenName, restUrl, '$.main_detail.fn_saveComplete', {errorCall : true, params : {problemId : $.main_detail.problemId} });
		                    } else {
		                    	restUrl = "REST-C11-OP-03-02";
		                    	mint.callService(requestObject, screenName, restUrl, '$.main_detail.fn_saveComplete', {errorCall : true });
		                    }

                            $.main_detail.kendoUploadButton = "";
                        } else if($.main_detail.fileUploadTotal == ($.main_detail.fileUploadError + $.main_detail.fileUploadSucess)) {
                            $(".k-upload-files.k-reset").find("li").remove();
                            /*
                            alert('총 카운트 = ' + $.main_detail.fileUploadTotal +
                                      '\n성공 카운트 = ' + $.main_detail.fileUploadSucess +
                                      '\n에러 카운트 = ' + $.main_detail.fileUploadError +
                                      '\n 파일을 재등록하여 주세요'
                            );
                            */
                            $.main_detail.uploadAttatchFileList =[];
                            $.main_detail.fileUploadTotal = 0;
                            $.main_detail.fileUploadSucess = 0;
                            $.main_detail.fileUploadError = 0;

                            $.main_detail.kendoUploadButton = "";
                        }
                    },
                    upload: function(e) {
                    	$.main_detail.fileUploadTotal++;
                    },
                    select : function(e) {
                        // 첨부 불가 확장자
                        var extArray = new Array(".php3",".php4",".asp",".jsp",".php",".html",".htm",".inc",".js",".pl",".cgi",".java",".sh",".bash",".exe",".bat",".msi",".xml");
                        // 확장자 체크
                        var notAllowed = false;
                        /* $.each(e.files, function(index, value) {
                            if (extArray.indexOf(value.extension.toLowerCase()) > -1 ) {
                            	mint.common.debugLog(value.extension + " is not allowed Extension!!");
                            //}
                            //if (value.extension !== '.txt') {
                                //alert("not allowed...!  Only Upload .TXT file");
                                alert("첨부 할 수 없는  종류의 파일이 선택 되었습니다. \n 확인 후 다시 첨부하여 주십시오.");
                                notAllowed = true;
                            }
                        }); */
                        var breakPoint = 0;
                        if (notAllowed == true) {
                            e.preventDefault();
                        }

                        // custom button 확용
                        setTimeout(function() {
                            $.main_detail.kendoUploadButton = $(".k-upload-selected");
                            $.main_detail.kendoUploadButton.hide();
                        }, 1);
                    }
                });
            },

            fn_onRemove : function(e) {
            	$.main_detail.fn_setAttachFileFlag($.main_detail.fn_getFileName(e), 'D');

            	var files = e.files;

                for(var i=0; i < $('#file').data("kendoUpload").options.files.length; i++) {

                    if(files[0].uid == $('#file').data("kendoUpload").options.files[i].uid) {
                        $('li.k-file[data-uid="' + files[0].uid + '"]').remove();
                        $('#file').data("kendoUpload").options.files.splice(i, 1);
                        e.preventDefault();
                    }
                }
            } ,

            fn_getFileName : function(e) {
            	return $.map(e.files, function(file) {
                    var info = file.name;

                    return info;
                }).join(", ");
            },

            fn_setAttachFileFlag : function(fileName, flag) {
            	for(var i = 0; i < $.main_detail.orgAttachFileList.length; i++) {

            		if($.main_detail.orgAttachFileList[i].fileNm == fileName) {
            			$.main_detail.orgAttachFileList[i].flag = flag;
            		}
            	}
            },


            //-----------------------------------------------------------------------
            // Description :: 팝업 추가
            //-----------------------------------------------------------------------
            fn_showInfoDialog : function(btnClassName, appUser, changeBtnNm) {
                try {
                    $.ajax({
                        url: "../sub-co/CO-01-00-005.html",
                        success:function(data){
                            $("#infoDialogModal").html('');
                            $("#infoDialogModal").html(data);

                            $('#infoDialog').modal({
                                backdrop: 'static'
                            });

                            $.sub.fn_controlButtonClass(btnClassName, appUser, changeBtnNm);
                        }
                    });
                } catch( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_showInfoDialog"});
                }
            },//end fn_showInfoDialog()

            fn_setDisabled : function() {
            	/* mint.ui.setDropDownList('status', mint.common.commonCodeMap.get("cds").OP02, 3, 'nm', 'cd');
                mint.ui.setDropDownList('importance', mint.common.commonCodeMap.get("cds").OP03, 3, 'nm', 'cd');
                mint.ui.setDropDownList('systemNm', mint.common.commonCodeMap.get("systemCdList"), 0, 'systemNm', 'systemId'); */


                //$("#detail-status").attr("disabled", true);
            	var dropDown = $("#detail-status").data("kendoDropDownList");
            	 dropDown.enable(false);
            },

            //==========================================================모달 팝업====================================================================//
          	//-----------------------------------------------------------------------
            // Description :: 그리드 템플릿 설정
            //-----------------------------------------------------------------------
            fn_initProblemInterfacePopupGrid : function() {
                try{
                    $("#problemInterfacePopupGridForAddDel").kendoGrid({
                        dataSource : {
	                        data : [],
	                        pageSize : mint.ui.getPageSizesS({'currentPage' : true})
                        },
                        sortable : true,
                        pageable : {
                        	refresh : false,
                        	pageSizes : mint.ui.getPageSizesS(),
                        	buttonCount : 5
                        },
                        //selectable : "row",
                        columns : [
									{
     									title : "<input type='checkbox' id='popup-op0302002-list-checkbox-checkAll'>",
    									template : "<input type='checkbox' readonly='readonly' name='popup-op0302002-list-checkbox' class='popup-op0302002-list-checkbox' onclick='$.main_detail.fn_checkProblemInterfacePopupGridRow(this)' >",
    									width : "60px",
    									headerAttributes : {
    										style : "text-align: center; vertical-align:middle;"
    									},
    									attributes : {
    										style : "text-align: center; white-space: nowrap;"
    									}
    									, width : "5%"
    								},
    								/* {
    									field : "systemId",
    		                            hidden : true
    								},
    		                        {
    		                            //field : "nodeName",
    		                            field : "systemNm",
    		                            title : "시스템",
    		                            width : "150px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(systemNm)#'
    		                        },  */
    		                        {
    		                            field : "integrationId",
    		                            title : mint.label.getLabel('lb-154'),
    		                            width : "120px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(integrationId)#'

    		                        },
    		                        {
    		                        	field : "interfaceId",
    		                        	hidden : true
    		                        },
    		                        {
    		                            field : "interfaceNm",
    		                            title : mint.label.getLabel('lb-153'),
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: left"
    		                            },
    		                            template : '#=$.main.fn_replaceNull(interfaceNm)#'

    		                        },
    		                        {
    		                        	field : "seq",
    		                        	hidden : true
    		                        },
    		                        {
    		                            field : "startDate",
    		                            title : mint.label.getLabel('lb-50'),
    		                            width : "160px",
    		                            template : '#=$.main.fn_changeTime(startDate)#',
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            }
    		                        }
    		                        /* ,
    		                        {
    		                            field : "statusNm",
    		                            title : "상태",
    		                            width : "70px",
    		                            headerAttributes : {
    		                                style : "text-align: center"
    		                            },
    		                            attributes : {
    		                                style : "text-align: center"
    		                            }
    		                        } */
                        ],
                        dataBound: function (e) {
							if(1 > $("#problemInterfacePopupGridForAddDel").data().kendoGrid.dataSource.view().length) {
								var gridHeight = window.innerHeight - ($('.navbar-static-top').height() + $('.page-heading').height() + $('.col-lg-12').height());

								$("#problemInterfacePopupGridForAddDel").children(".k-grid-content").height(gridHeight /2.5);
								//$("#problemInterfacePopupGridForAddDel").children(".k-grid-content-locked").height(gridHeight / 2.5);
							} else {
								$("#problemInterfacePopupGridForAddDel").children(".k-grid-content").height('auto');
								//$("#problemInterfacePopupGridForAddDel").children(".k-grid-content-locked").height('auto');
							}
						}
                    });

                } catch ( e ) {
                    mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_initProblemInterfacePopupGrid"});
                }
            },

            fn_checkProblemInterfacePopupGridRow : function(rowObj) {
            	try {

            		var grid = $("#problemInterfacePopupGridForAddDel").data("kendoGrid");
            		var row = $(rowObj).closest("tr");
            		//var checkedDataItem = grid.dataItem(row);

            		//console.log(checkedDataItem);
            		//console.log(rowObj.checked);
            		//$.main_detail.problemInterfaceList[checkedDataItem.uid] = {checked: rowObj.checked, dataItem: checkedDataItem};

            		//console.log($.main.noRegProblemList[checkedDataItem.uid]);

            		if (rowObj.checked) {
				        //-select the row
				        row.addClass("k-state-selected");
				    } else {
				        //-remove selection
				        row.removeClass("k-state-selected");
				    }
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_checkNoRegProblemGridRow"});
            	}
            },

            fn_setProblemInterfacePopupGridData : function(jsonData) {
            	try {
            		//console.log(jsonData);
					var gridData = $.main_detail.fn_getProblemInterfacePopupGridData_custom(jsonData);
					//console.log(gridData);
            		var dataSource = new kendo.data.DataSource({
						  data: gridData
					    , page:1
					    , pageSize: mint.ui.getPageSizesS({'currentPage' : true})
					});

					//데이터 재설정
					$("#problemInterfacePopupGridForAddDel").data("kendoGrid").setDataSource(dataSource);


					$("#modalProblemInterfacePopupForAddDel").modal({
						backdrop: 'static',
						keyboard: false
					});
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_setProblemInterfacePopupGridData"});
            	}
            },

            fn_getProblemInterfacePopupGridData_custom : function (jsonData) {
            	try {
            		var gridData = [];
            		var checkVal = ($.main_detail.problemInterfacePopupMode == "ADD")?true:false;
            		// 기 선택된 인터페이스 목록
            		var selectedProblemInterfaceList = [];
            		{
            			var result = [];
                		{
            				for(var x in $.main_detail.problemInterfaceList) {
            					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
            						result.push($.main_detail.problemInterfaceList[x]);
            					}
            				}
                		}
                		//console.log(jsonData);
                		//console.log(result);

                		for (var i in result) {
                			if (result[i].checked == true) {
                				selectedProblemInterfaceList.push(result[i].dataItem);
                			}
                		}

            		}
            		//console.log(selectedProblemInterfaceList);
            		//console.log(jsonData);
					var selectedNoRegProblemData = {};
					var isSelectedData = true;
            		for (var i in jsonData) {
            			isSelectedData = true;
            			for (var j in selectedProblemInterfaceList) {

            				if (jsonData[i].interfaceId == selectedProblemInterfaceList[j].interfaceId
            						&& jsonData[i].seq == selectedProblemInterfaceList[j].seq
            						&& jsonData[i].startDate == selectedProblemInterfaceList[j].startDate) {

           						isSelectedData = false;

            					//console.log(selectedProblemInterfaceList[j]);
            					break;
            				}
            			}

            			if (isSelectedData == checkVal) {
            				selectedNoRegProblemData = {};

        					selectedNoRegProblemData.interfaceId = jsonData[i].interfaceId;
        					selectedNoRegProblemData.integrationId = jsonData[i].integrationId;
                			selectedNoRegProblemData.interfaceNm = jsonData[i].interfaceNm;
                			selectedNoRegProblemData.seq = jsonData[i].seq;
                			selectedNoRegProblemData.startDate = jsonData[i].startDate;
                			selectedNoRegProblemData.statusNm = jsonData[i].statusNm;

        					gridData.push(selectedNoRegProblemData);
            			}
            		}

            		return gridData;
            	}
            	catch(e) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getProblemInterfacePopupGridData_custom"});
            	}
            },

            //-----------------------------------------------------------------------
            // Description :: 장애 템플릿 목록 조회.
            //-----------------------------------------------------------------------
            fn_getProblemTemplateList : function(channelId) {
            	try {
            		$('#cb-template-title').data("kendoComboBox").value('');
            		mint.ui.setComboBoxWithValue('cb-template-title', [], 0, 'PROBLEM_SUBJECT', 'TMPLATE_ID', '');
            		var requestObject = new Object();
            		requestObject.channelId = channelId;
            		mint.callService(requestObject, screenName, 'REST-R16-OP-03-02', function(jsonData) {
	                   	mint.ui.setComboBoxWithValue('cb-template-title', jsonData, 0, 'PROBLEM_SUBJECT', 'TMPLATE_ID', '');
            		}, {errorCall : true, notificationView:false});
            	} catch( e ) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getProblemTemplateList"});
            	}

            },

            //-----------------------------------------------------------------------
            // Description :: 장애 템플릿 상세 조회.
            //-----------------------------------------------------------------------
            fn_getProblemTemplateDetail : function(channelId, templateId) {
            	try {
            		{
        				$('#causeContents').data('kendoEditor').value('');
        				$('#resultContents').data('kendoEditor').value('');
        				$('#planContents').data('kendoEditor').value('');
            		}

            		var requestObject = new Object();
            		requestObject.channelId  = channelId;
            		requestObject.templateId = templateId;

            		mint.callService(requestObject, screenName, 'REST-R17-OP-03-02', function(jsonData) {
            			if(!mint.common.isEmpty(jsonData) && jsonData.length > 0) {
            				$('#causeContents').data('kendoEditor').value( jsonData[0].CAUSE_CONTENTS);
            				$('#resultContents').data('kendoEditor').value( jsonData[0].RESULT_CONTENTS);
            				$('#planContents').data('kendoEditor').value( jsonData[0].PLAN_CONTENTS);
            			}

            		}, {errorCall : true});
            	} catch( e ) {
            		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_getProblemTemplateDetail"});
            	}

            },
			//-----------------------------------------------------------------------
			// Description :: System 리턴 값
			//-----------------------------------------------------------------------
			fn_returnSystemPopupData : function(rtnSystemData) {
				try {
					if( mint.common.isEmpty(rtnSystemData) ) {
						$('#tf-reg-systemNm').val('');
						$('#tf-reg-systemNm_hidden').val('');
						$('#tf-reg-systemId_hidden').val('');
					} else {
						$('#tf-reg-systemNm').val(rtnSystemData.systemNm + '(' + rtnSystemData.systemCd + ')');
						$('#tf-reg-systemNm_hidden').val(rtnSystemData.systemNm);
						$('#tf-reg-systemId_hidden').val(rtnSystemData.systemId);

						//$.main.fn_setSearchNode('tf-reg-systemNm', 'input');
                        //$.main.fn_getSearchInfo('systemNm', rtnSystemData.systemNm);
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main.fn_returnSystemPopupData"});
				}
			},//end fn_returnSystemPopupData()

			//-----------------------------------------------------------------------
			// Description :: 3-1-2-2. 요건 상태 변경 완료
			//-----------------------------------------------------------------------
			fn_completeApprovalStatus : function(jsonData) {
				try {
					if(null != jsonData) {
						mint.getCommonCode(function() {
							mint.common.alert('BI00001', null);
			            	$.main_detail.fn_moveList();
						}, true);
					}
				} catch( e ) {
					mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "$.main_detail.fn_completeApprovalStatus"});
				}
			},//end fn_completeApprovalStatus()
        }
    });


    //=======================================================================
    // (4) 이벤트 핸들러 정의
    //=======================================================================


    $(document).on('click', function(e) {
        if("OP-03-02-002" == screenName) {
            if('k-filename' == e.target.className) {
                tempCount = 1;
                var uploadElement = $("#file").data("kendoUpload");
                var tempIndex = $(".k-filename").index(e.target);

                //tempJsonData.requirementId;
                //alert(uploadElement.options.files[tempIndex].fileId);

                tempFilePath = uploadElement.options.files[tempIndex].filePath;
                tempFileNm = uploadElement.options.files[tempIndex].fileNm;

                //$(location).attr("href", "/mint/ut/download?filepath=" + tempFilePath + "&filename=" + tempFileNm);
     			$.fileDownload( mint.baseServiceUrl + "/ut/download?filepath=" + tempFilePath + "&filename=" + tempFileNm)
    	        .done(function () {})
    	        .fail(function () { mint.common.alert('File download failed!['+tempFileNm+"]", null); });
                e.stopImmediatePropagation();
            }
        }
    });

 	//-----------------------------------------------------------------------
 	// Description :: 전사솔루션 변경시 event 함수
 	//-----------------------------------------------------------------------
 	$('#cb-template-channelId').change(function(e) {
		try {
	 		var dataItem = $('#cb-template-channelId').data("kendoComboBox").dataItem();

	 		if('undefined' != typeof dataItem) {
	 			$.main_detail.fn_getProblemTemplateList(dataItem.channelId);
	 		}
		} catch( e ) {

		}
 	});

 	//-----------------------------------------------------------------------
 	// Description :: 장애내용 템플릿 타이틀 선택시 event 함수
 	//-----------------------------------------------------------------------
 	$('#cb-template-title').change(function(e) {
		try {
	 		var dataItem = $('#cb-template-title').data("kendoComboBox").dataItem();

	 		if('undefined' != typeof dataItem) {
	 			$.main_detail.fn_getProblemTemplateDetail(dataItem.CHANNEL_ID, dataItem.TEMPLATE_ID);
	 		}
		} catch( e ) {

		}
 	});

  	//-----------------------------------------------------------------------
    //오류/장애 유형 검색 - 팝업
	//-----------------------------------------------------------------------
    $('.detail-problemType').on('click', function() {
    	mint.common.setScreenParam("caller", "CO-00-00-001");
    	$.ajax({
            url : "../sub-co/CO-01-00-011.html",
            success : function(data) {
                $("#infoDialogModal").html('');
                $("#infoDialogModal").html(data);

                $('#pop_problem').modal({
                    backdrop : 'static'
                }).on('hidden.bs.modal', function(event) {
     				$('#infoDialogModal').html('');
     			});
            }
        });
    });

    $('.btn-modify').on('click', function() {
    	$('.btn-modify').hide();
    	//$('.btn-inteface').show();
    	//$('.btn-inteface-add').show();
    	//$('.btn-inteface-del').show();
    	$('.btn-save').show();

    	$.main_detail.fn_changeEnableStatus(false);
    	$('#file').data("kendoUpload").enable();

    	$('#headerTitle').text( mint.label.getLabel('lb-342') );
    	$('#headerLocation').text( mint.label.getLabel('lb-342') );
    });

    $('.btn-save').on('click', function() {
        $.main_detail.fn_saveProblem();
    });

    $('.btn-delete').on('click', function() {
        //$.main_detail.fn_getData();
        if($("#detail-status").val() == 2) {
        	mint.common.alert('BW00028', null);
        	return false;
        }

        if(mint.common.confirm('CI00003')) {
        	$.main_detail.fn_deleteProblem();
        }

    });

    //-----------------------------------------------------------------------
    // Description :: 목록 버튼 클릭 이벤트
    //-----------------------------------------------------------------------
    // - 수정(2015/10/15), dhkim
    //   (1) move 함수에서 back 함수로 변경함으로써 조회 화면 이동시 초기화 되는 문제 조치
    //-----------------------------------------------------------------------
    $('.btn-list').on('click', function() {
    	mint.back('null');
    	//mint.move('../sub-op/OP-03-02-001');
    });


    //오류/장애 보고 버튼 클릭
    $(".btn-approval").on('click', function() {
    	mint.common.setScreenParam("caller", "OP-03-02-002");
    	mint.common.setScreenParam("interfaceId", $.main_detail.searchInterfaceId);
    	mint.common.setScreenParam("approvalItemId", $.main_detail.problemId);
    	mint.common.setScreenParam("channelId", $.main_detail.channelId);

    	$.main_detail.fn_setDisabled();

    	$.ajax({
     		url: "../sub-co/CO-01-00-005.html",
     		success:function(data){
     			$("#infoDialogModal").html('');
         		$("#infoDialogModal").html(data);

         		$('#CO-01-00-005').modal({
    				backdrop: 'static'
    			});
     		}
 		});
    });



    //-----------------------------------------------------------------------
    // Description :: 심의 요청 버튼 Click 이벤트
    //-----------------------------------------------------------------------
/*     $('.btn-problem-review').on('click', function(e) {
        if('D4' == tempJsonData.status || 'D8' == tempJsonData.status || 'F1' == tempJsonData.status || 'F2' == tempJsonData.status) {
            $.main_detail.fn_showInfoDialog('btn-pop-requirement-review', '심의자');
        } else {
            $.main_detail.fn_showInfoDialog('btn-pop-requirement-review', '심의자');
        }

    }); */

    /*
    $('.btn-inteface').on('click', function() {
    	$.ajax({
     		url: "../sub-co/CO-01-00-908.html",
     		success:function(data){
     			$("#searchInterfaceModal").html('');
         		$("#searchInterfaceModal").html(data);

         		$('#srchInterface').modal({
    				backdrop: 'static'
    			});
     		}
 		});
    });
     */
    $('.btn-inteface-add').on('click', function() {
    	try {
    		$.main_detail.problemInterfacePopupMode = "ADD";

    		$(".select-interface-add").show();
    		$(".select-interface-del").hide();

    		$("#modal-header-title").html(mint.label.getLabel('lb-32') + " " + mint.label.getLabel('lb-395') + " " + mint.label.getLabel('lb-365') + " " + mint.label.getLabel('lb-370'));

			var searchObject = {};

     		searchObject.searchMode = "DETAIL_ADD";
     		searchObject.problemId = $.main_detail.problemId;

    		// 미등록 오류/장애 인터페이스 조회
    		mint.callService(searchObject, screenName, 'REST-R12-OP-03-02', '$.main_detail.fn_setProblemInterfacePopupGridData', {errorCall : true });
    	}
    	catch(e) {
    		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "btn-inteface-add.click"});
    	}
    });


     $('.btn-inteface-del').on('click', function() {
     	try {
     		$.main_detail.problemInterfacePopupMode = "DEL";

     		$(".select-interface-add").hide();
     		$(".select-interface-del").show();

     		$("#modal-header-title").html(mint.label.getLabel('lb-32') + " " + mint.label.getLabel('lb-395') + " " + mint.label.getLabel('lb-365') + " " + mint.label.getLabel('lb-343'));

     		var searchObject = {};

     		searchObject.searchMode = "DETAIL_DEL";

     		// 미등록 오류/장애 인터페이스 조회
     		mint.callService(searchObject, screenName, 'REST-R12-OP-03-02', '$.main_detail.fn_setProblemInterfacePopupGridData', {errorCall : true });

     		/*
     		var isDel = false;
 			var checked;
 	 		var row;
 	 		var grid = $("#problemInterfaceGrid").data("kendoGrid");
 	 		var checkedDataItem;
 			$("input[name=op0302002-list-checkbox]:checkbox").each(function() {
 	 			checked = $(this).is(':checked');
 	 			//console.log(checked)
 	 			if (checked) {
 	 				row = $(this).closest("tr"),
 	 				checkedDataItem = grid.dataItem(row);
 	 				//console.log(checkedDataItem);
 	 				checkedDataItem.uid = checkedDataItem.rowKey;
 	 				$.main_detail.problemInterfaceList[checkedDataItem.rowKey] = {'checked':false, 'dataItem':checkedDataItem};
 	 				isDel = true;
 	 			}
 			});


 			// 오류/장애 인터페이스 그리드 새로고침
 			if (isDel == true)
 			{
 				var result = [];
 				for(var x in $.main_detail.problemInterfaceList) {
 					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
 						result.push($.main_detail.problemInterfaceList[x]);
 					}
 				}
 				//console.log(result);
 	            $.main_detail.fn_setProblemInterfaceGrid(result);
 			}
 			else {
 				alert("삭제할 오류/장애 인터페이스 목록을 선택하여 주십시오.");
 			}
 			*/
     	}
     	catch(e) {
     		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "btn-inteface-del.click"});
     	}
     });



     $('.select-interface-add').on('click', function() {
     	try {
     		var isAdd = false;
 			var checked;
 	 		var row;
 	 		var grid = $("#problemInterfacePopupGridForAddDel").data("kendoGrid");
 	 		var checkedDataItem;
 	 		var tmpFlagVal = "";
 	 		var flagVal = "";
 			$("input[name=popup-op0302002-list-checkbox]:checkbox").each(function() {
 	 			checked = $(this).is(':checked');
 	 			//console.log(checked)
 	 			if (checked) {
 	 				row = $(this).closest("tr"),
 	 				checkedDataItem = grid.dataItem(row);
 	 				//console.log(checkedDataItem);


 	 				tmpFlagVal = "";
 	 				flagVal = "";
 	 				if ($.main_detail.updateCheck == true) {
 	 					if ($.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate]) {
 	 						tmpFlagVal = $.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate].dataItem.flag;

 	 						if (tmpFlagVal == "") {
 	 							flagVal = "";
 	 						}
 	 						else {
 	 							flagVal = "C";
 	 						}
 	 					}
 	 					else {
 	 						flagVal = "C";
 	 					}
 	 				}
 	 				else {
 	 					flagVal = "C";
 	 				}


 	 				$.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate] = {
 	 						checked : true,
 	 						dataItem : {
 	 							interfaceId : checkedDataItem.interfaceId,
 	 							integrationId : checkedDataItem.integrationId,
	 	       					interfaceNm : checkedDataItem.interfaceNm,
	 	       					seq : checkedDataItem.seq,
	 	       					startDate : checkedDataItem.startDate,
	 	       					statusNm : checkedDataItem.statusNm,
	 	       					flag : flagVal
 	 						}
 	 				};
 	 				isAdd = true;

 	 			}
 			});
 			/*
 			var result = [];
			for(var x in $.main_detail.problemInterfaceList) {
				if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
					result.push($.main_detail.problemInterfaceList[x]);
				}
			}
			console.log(result);
 			 */
 			// 오류/장애 인터페이스 그리드 새로고침
 			if (isAdd == true)
 			{
 				$('#modalProblemInterfacePopupForAddDel').modal('hide');

 			 	var result = [];
 				for(var x in $.main_detail.problemInterfaceList) {
 					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
 						result.push($.main_detail.problemInterfaceList[x]);
 					}
 				}
 				//console.log(result);
 	            $.main_detail.fn_setProblemInterfaceGrid(result);
 			}
 			else {
 				mint.common.alert('BW00029', null);
 			}


 			$("#popup-op0302002-list-checkbox-checkAll").prop("checked", false);
     	}
     	catch(e) {
     		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "select-interface-add.click"});
     	}
     });



     $('.select-interface-del').on('click', function() {
     	try {
     		var isDel = false;
 			var checked;
 	 		var row;
 	 		var grid = $("#problemInterfacePopupGridForAddDel").data("kendoGrid");
 	 		var checkedDataItem;
 	 		var tmpFlagVal = "";
 	 		var flagVal = "";
 			$("input[name=popup-op0302002-list-checkbox]:checkbox").each(function() {
 	 			checked = $(this).is(':checked');
 	 			//console.log(checked)
 	 			if (checked) {
 	 				row = $(this).closest("tr"),
 	 				checkedDataItem = grid.dataItem(row);
 	 				//console.log(checkedDataItem);


 	 				tmpFlagVal = "";
 	 				flagVal = "";
 	 				if ($.main_detail.updateCheck == true) {
 	 					if ($.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate]) {
 	 						tmpFlagVal = $.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate].dataItem.flag;

 	 						if (tmpFlagVal == "") {
 	 							flagVal = "";
 	 						}
 	 						else {
 	 							flagVal = "D";
 	 						}
 	 					}
 	 					else {
 	 						flagVal = "D";
 	 					}
 	 				}
 	 				else {
 	 					flagVal = "";
 	 				}


 	 				$.main_detail.problemInterfaceList[checkedDataItem.interfaceId + "-" + checkedDataItem.seq + "-" + checkedDataItem.startDate] = {
 	 						checked : false,
 	 						dataItem : {
 	 							interfaceId : checkedDataItem.interfaceId,
 	 							integrationId : checkedDataItem.integrationId,
	 	       					interfaceNm : checkedDataItem.interfaceNm,
	 	       					seq : checkedDataItem.seq,
	 	       					startDate : checkedDataItem.startDate,
	 	       					statusNm : "",
	 	       					flag : flagVal
 	 						}
 	 				};
 	 				isDel = true;
 	 			}
 			});
 			/*
 			var result = [];
			for(var x in $.main_detail.problemInterfaceList) {
				if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
					result.push($.main_detail.problemInterfaceList[x]);
				}
			}
			console.log(result);
 			 */
 			// 오류/장애 인터페이스 그리드 새로고침
 			if (isDel == true)
 			{
 				$('#modalProblemInterfacePopupForAddDel').modal('hide');

 			 	var result = [];
 				for(var x in $.main_detail.problemInterfaceList) {
 					if (Object.prototype.hasOwnProperty.call($.main_detail.problemInterfaceList, x)) {
 						result.push($.main_detail.problemInterfaceList[x]);
 					}
 				}
 				//console.log(result);
 	            $.main_detail.fn_setProblemInterfaceGrid(result);
 			}
 			else {
 				mint.common.alert('BW00030', null);
 			}


 			$("#popup-op0302002-list-checkbox-checkAll").prop("checked", false);
     	}
     	catch(e) {
     		mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "btn-inteface-del.click"});
     	}
     });

     $('#problemInterfaceGrid').on('click', "tr.k-state-selected", function () {

 		try {
 			var entityGrid = $("#problemInterfaceGrid").data("kendoGrid");
	        var selectedItem = entityGrid.dataItem(entityGrid.select());

	        //console.log(selectedItem);
	        if(mint.common.replaceNull(selectedItem.errorMsg) != "") {
        		$("#divErrorMsg").show();
        		$("#errorMsg").val(mint.common.replaceNull(selectedItem.errorMsg));
        	}
 		}
 		catch(e) {
 			mint.common.errorLog(e, {"screenName" : screenName, "fnName" : "problemInterfaceGrid.click"});
 		}

 	});

   /*
     //-----------------------------------------------------------------------
  	// Description :: Problem Interface Add Popup Grid CheckBox Click 이벤트 설정
  	//-----------------------------------------------------------------------
  	$("#op0302002-list-checkbox-checkAll").bind('click', function() {

  		// row별 checked 설정
  		var checked;
  		var row;
  		var grid = $("#problemInterfaceGrid").data("kendoGrid");
  		var dataItem;
  		$("input[name=op0302002-list-checkbox]:checkbox").each(function() {
  			checked = $("#op0302002-list-checkbox-checkAll").is(':checked');
  			$(this).prop("checked", checked);

  			row = $(this).closest("tr");

  		    if (checked) {
  		        //-select the row
  		        row.addClass("k-state-selected");
  		    } else {
  		        //-remove selection
  		        row.removeClass("k-state-selected");
  		    }
  		});

  	});
      */
 	//-----------------------------------------------------------------------
  	// Description :: Problem Interface Add Popup Grid CheckBox Click 이벤트 설정
  	//-----------------------------------------------------------------------
  	$("#popup-op0302002-list-checkbox-checkAll").bind('click', function() {

  		// row별 checked 설정
  		var checked;
  		var row;
  		var grid = $("#problemInterfacePopupGridForAddDel").data("kendoGrid");
  		var dataItem;
  		$("input[name=popup-op0302002-list-checkbox]:checkbox").each(function() {
  			checked = $("#popup-op0302002-list-checkbox-checkAll").is(':checked');
  			$(this).prop("checked", checked);

  			row = $(this).closest("tr");
  		    /*
  		    dataItem = grid.dataItem(row);

  			$.main_detail.problemInterfaceList[dataItem.uid] = {'checked':checked, 'dataItem':dataItem};
  		     */
  		    if (checked) {
  		        //-select the row
  		        row.addClass("k-state-selected");
  		    } else {
  		        //-remove selection
  		        row.removeClass("k-state-selected");
  		    }
  		});

  	});

 	//-----------------------------------------------------------------------
 	// Description :: 시스템명 변경시 event 함수
 	//-----------------------------------------------------------------------
 	$('#tf-reg-systemNm').on('click', function () {
 		//팝업에 필요한 div 를 동적으로 생성하도록 한다.
 		var attachDiv = 'attachSystemSearchPop';
 		$('#' + attachDiv).remove();
 		$('#page-wrapper').append($('<div id="' + attachDiv + '"></div>'));
 		$.ajax({
      		url: "../sub-co/CO-01-00-901.html",
      		success:function(data){
      			$('#' + attachDiv).html('');
          		$('#' + attachDiv).html(data);

          		$('#pop_system_search').modal({
     				backdrop: 'static'
     			}).on('hidden.bs.modal', function(event) {
     				$('#' + attachDiv).html('');
     			});
      		}
  		});
 	});


    //=======================================================================
    // (5) 기타 Function 정의
    //=======================================================================

    tempProblemPopupData = "";
    tempInterfacePopupData = "";
    tempInterfaceCntPopupTitle = "";
    /*
    returnInterfacePopupData = function(interfaceId, interfaceNm) {
    	$.main_detail.searchInterfaceId = interfaceId;
    	mint.callService(null, screenName, 'REST-R02-CO-01-00-008', '$.main_detail.fn_setInterfaceInfo', {errorCall : true, params : {interfaceId : interfaceId} });
    }
     */

    //=======================================================================
    // (6) 화면 로딩시 실행할 항목 기술
    //=======================================================================
    $.main_detail.fn_init();
	mint.label.attachLabel(null);

});
</script>

<style>
	/* 첨부파일 - style customize set */
	.k-filename {
		max-width: 94% !important;
	}
</style>